import{r as l,M as f,j as e,as as h,V as A,T as i,t as m,G as c,H as u,b as d,a3 as v,c1 as S,e as P,cN as b,I as w,D,cq as N,cG as C,S as T,N as I,ax as F}from"./main-CUJEGI8U.js";import{A as p,a as x,b as L}from"./account-settings-sidenav-b3HqyYgG.js";import{u as U,S as z,C as E,T as V,a as O}from"./two-factor-panel-DhBA9v4W.js";import{A as k}from"./access-token-panel-Cg1TeoaK.js";import{I as _}from"./image-selector-GLpYAkj6.js";import{F as g}from"./file-upload-provider-DWaB2xE4.js";import{A as B}from"./AlternateEmail-Dm6HTLWn.js";import{u as R,L as G}from"./localization-panel-CEnNw5HC.js";import{C as H}from"./confirmation-dialog-DVMbD2S1.js";import"./use-all-social-logins-disabled-CojrygKD.js";import"./PhonelinkLock-iQg4dOFb.js";import"./Login-BYgB4hr5.js";import"./list-C96mDrnJ.js";import"./Tablet-DXXjlej2.js";import"./envato-DNf8Um8t.js";import"./google-nUE0mIIg.js";import"./use-social-login-PeP1qq51.js";import"./dialog-footer-jZcc-BBM.js";import"./skeleton-BmWW5Jc-.js";import"./external-link-jlnQ3iTs.js";import"./formatted-date-DzIPJwiH.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./use-clipboard-CQvDhy4G.js";import"./use-active-upload-BwzDBsep.js";import"./open-upload-window-CboR35vP.js";import"./uploaded-file-ksxfN_l-.js";import"./extension-from-filename-O0XMuZye.js";import"./AddAPhoto-y5pGVyq2.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./traditional-BcYcLesO.js";import"./combobox-BECNHGKY.js";import"./combobox-end-adornment-B0xReOuL.js";import"./select-Z9R0wV6S.js";import"./countries-0u-1JqGJ.js";function M({user:s}){const a=l.useId(),t=f({defaultValues:{name:s.name||"",image:s.image}});j(s.id);const r=R(s.id,t);return e.jsx(p,{id:x.AccountDetails,title:e.jsx(i,{message:"Update name and profile image"}),actions:e.jsx(m,{type:"submit",variant:"flat",color:"primary",form:a,disabled:r.isPending||!t.formState.isValid||!t.formState.isDirty,children:e.jsx(i,{message:"Save"})}),children:e.jsxs(h,{form:t,className:"flex flex-col items-center gap-40 md:flex-row md:gap-60",onSubmit:n=>{r.mutate(n,{onSuccess:()=>{t.reset({...t.getValues(),...n})}})},id:a,children:[e.jsx(g,{children:e.jsx($,{user:s})}),e.jsxs("div",{className:"w-full flex-auto",children:[e.jsxs("div",{className:"mb-16 flex items-center gap-4 text-muted",children:[e.jsx(B,{size:"sm"}),s.email]}),e.jsx(A,{name:"name",label:e.jsx(i,{message:"Name"})})]})]})})}function $({user:s}){const[a,t]=l.useState(s.image),r=j(s.id);return e.jsx(g,{children:e.jsx(_,{value:a,uploadType:v.avatars,variant:"avatar",stretchPreview:!0,previewSize:"w-90 h-90",placeholderIcon:e.jsx(S,{label:s.name,size:"w-full h-full text-2xl",circle:!0}),showRemoveButton:!0,onChange:(n,o)=>{t(o==null?void 0:o.url),r.mutate({image:(o==null?void 0:o.url)??null,image_entry_id:(o==null?void 0:o.id)??null})}})})}function j(s){return c({mutationFn:a=>d.put(`users/${s}`,a).then(t=>t.data),onError:a=>u(a)})}function q(){const{user:s}=P(),a=b();return c({mutationFn:()=>Y(s.id),onSuccess:()=>{w("Account deleted"),a.mutate()},onError:t=>u(t)})}function Y(s){return d.delete(`users/${s}`,{params:{deleteCurrentUser:!0}}).then(a=>a.data)}function Z(){const s=q(),{withConfirmedPassword:a,isLoading:t}=U(),[r,n]=l.useState(!1);return e.jsxs(p,{id:x.DeleteAccount,title:e.jsx(i,{message:"Danger zone"}),children:[e.jsx(D,{type:"modal",isOpen:r,onOpenChange:n,onClose:o=>{o&&s.mutate()},children:e.jsx(H,{isDanger:!0,title:e.jsx(i,{message:"Delete account?"}),body:e.jsx(i,{message:"Your account will be deleted immediately and permanently. Once deleted, accounts can not be restored."}),confirm:e.jsx(i,{message:"Delete"})})}),e.jsx(m,{variant:"flat",color:"danger",disabled:t||s.isPending,onClick:()=>{a(()=>{n(!0)})},children:e.jsx(i,{message:"Delete account"})})]})}function Fe({panels:s,sidenavItems:a}){const{data:t,isLoading:r}=N("me",{with:["roles","social_profiles","tokens"]});return e.jsx(C,{children:e.jsxs("div",{className:"min-h-screen bg",children:[e.jsx(T,{children:e.jsx(i,{message:"Account Settings"})}),e.jsx(I,{menuPosition:"account-settings-page",color:"bg",className:"sticky top-0 z-10"}),e.jsx("div",{children:e.jsxs("div",{className:"container mx-auto px-24 py-24",children:[e.jsx("h1",{className:"text-3xl",children:e.jsx(i,{message:"Account settings"})}),e.jsx("div",{className:"mb-40 text-base text-muted",children:e.jsx(i,{message:"View and update your account details, profile and more."})}),r||!t?e.jsx(F,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsxs("div",{className:"flex items-start gap-24",children:[e.jsx(L,{items:a}),e.jsxs("main",{className:"flex-auto",children:[s?s(t.user):null,e.jsx(M,{user:t.user}),e.jsx(z,{user:t.user}),e.jsx(E,{}),e.jsx(V,{user:t.user}),e.jsx(O,{}),e.jsx(G,{user:t.user}),e.jsx(k,{user:t.user}),e.jsx(Z,{})]})]})]})})]})})}export{Fe as AccountSettingsPage};
