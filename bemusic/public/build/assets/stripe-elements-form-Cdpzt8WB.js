import{e as v,c as R,r,x as D,u as g,b as N,j as t,d as M,t as w}from"./main-CUJEGI8U.js";import{l as P}from"./index-U9JJOqTM.js";import{S as j}from"./skeleton-BmWW5Jc-.js";function C({type:n,productId:c,priceId:o}){var I,_;const{user:a}=v(),b=R(),m=r.useRef(!1),i=r.useRef(null),{localeCode:l}=D(),[E,p]=r.useState(null),[h,x]=r.useState(null),[k,y]=r.useState(null),{branding:{site_name:d},billing:e}=g();return r.useEffect(()=>{var f;!((f=e==null?void 0:e.stripe)!=null&&f.enable)||!(e!=null&&e.stripe_public_key)||m.current||(Promise.all([P(e.stripe_public_key,{locale:l}),n==="createSetupIntent"?F():L(c,o)]).then(([u,S])=>{if(u&&i.current){const s=u.elements({clientSecret:S.clientSecret,appearance:{theme:b?"night":"stripe"}});s.create("payment",{business:{name:d},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:a==null?void 0:a.email}}}).mount(i.current),p(u),x(s),y(S.subscriptionId??null)}}),m.current=!0)},[c,e==null?void 0:e.stripe_public_key,(I=e==null?void 0:e.stripe)==null?void 0:I.enable,b,l,d,n,a==null?void 0:a.email]),{stripe:E,elements:h,paymentElementRef:i,stripeIsEnabled:(e==null?void 0:e.stripe_public_key)!=null&&((_=e==null?void 0:e.stripe)==null?void 0:_.enable),subscriptionId:k}}function F(){return N.post("billing/stripe/create-setup-intent").then(n=>n.data)}function L(n,c){return N.post("billing/stripe/create-partial-subscription",{product_id:n,price_id:c}).then(o=>o.data)}function q({productId:n,priceId:c,confirmType:o,createType:a,submitLabel:b,returnUrl:m}){const{stripe:i,elements:l,paymentElementRef:E,stripeIsEnabled:p,subscriptionId:h}=C({type:a==="setupIntent"?"createSetupIntent":"createSubscription",productId:n,priceId:c}),[x,k]=r.useState(null),[y,d]=r.useState(!1),e=!p||l!=null&&i!=null,I=async _=>{var u,S;if(_.preventDefault(),!i||!l)return;d(!0);let f=m;if(h){const s=new URL(m);s.searchParams.set("subscriptionId",h),f=s.href}try{const s=await i[o]({elements:l,confirmParams:{return_url:f}});((u=s.error)==null?void 0:u.type)!=="validation_error"&&((S=s.error)!=null&&S.message)&&k(s.error.message)}catch{}d(!1)};return t.jsxs("form",{onSubmit:I,children:[t.jsx("div",{ref:E,className:M("min-h-[303px]",!p&&"hidden"),children:p&&t.jsx(U,{})}),x&&!y&&t.jsx("div",{className:"mt-20 text-danger",children:x}),t.jsx(w,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:y||!e,children:b})]})}function U(){return t.jsxs(r.Fragment,{children:[t.jsx(j,{className:"mb-20 h-30"}),t.jsx(j,{className:"mb-20 h-30"}),t.jsx(j,{className:"mb-20 h-30"}),t.jsx(j,{className:"h-30"})]})}export{q as S};
