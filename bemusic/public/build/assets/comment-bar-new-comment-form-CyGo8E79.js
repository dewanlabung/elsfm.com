import{ct as L,j as e,t as j,T as c,J as p,u as B,d as m,a8 as b,D as w,r as d,aa as S,a as z,b as N,af as A,G as q,H as E,cn as Q,I as H,z as K,e as F,av as V,b8 as W,c1 as $,ar as O}from"./main-CUJEGI8U.js";import{A as J}from"./album-context-dialog-C5eIuCxr.js";import{u as U,a as X,b as Y}from"./toggle-in-library-menu-button-CqmQ1GOD.js";import{u as T}from"./use-auth-click-capture-B9wu-BP4.js";import{F as M,a as Z}from"./FavoriteBorder-D1CUmnAo.js";import{u as G,a as ee}from"./toggle-repost-menu-button-DAsBpr-F.js";import{R as D}from"./Repeat-DTFydNM6.js";import{S as se}from"./share-media-button-Dw3JV4C-.js";import{T as te}from"./track-context-dialog-DU1dwrB2.js";import{P as ae}from"./play-arrow-filled-BrHo1wfG.js";import{F as k}from"./formatted-number-gsF1qEbc.js";import{M as ne}from"./MoreHoriz-RUUnngeG.js";import{S as re}from"./Share-C8wHCu8Q.js";function oe({likeable:s,radius:t="rounded-full",disabled:a,...n}){const r=T(),o=U(),l=X(),x=Y(h=>h.has(s)),i=o.isPending||l.isPending,f=L(),v=ie(s),u=a||i||f;return x?e.jsx(j,{...n,variant:"outline",radius:t,startIcon:e.jsx(M,{className:"text-primary"}),disabled:u,onClickCapture:r,onClick:()=>{l.mutate({likeables:[s]})},children:e.jsx(c,{...v.removeLike})}):e.jsx(j,{...n,variant:"outline",radius:t,startIcon:e.jsx(Z,{}),disabled:u,onClickCapture:r,onClick:()=>{o.mutate({likeables:[s]})},children:e.jsx(c,{...v.like})})}function ie(s){switch(s.model_type){case"artist":return{like:p("Follow"),removeLike:p("Following")};default:return{like:p("Like"),removeLike:p("Liked")}}}function le({item:s,className:t,size:a="xs",radius:n,disabled:r}){const o=T(),{player:l}=B(),x=G(),i=ee(u=>u.has(s)),f=L(),v=r||x.isPending||f;return l!=null&&l.enable_repost?e.jsx(j,{className:t,variant:"outline",size:a,radius:n,startIcon:e.jsx(D,{className:m(i&&"text-primary")}),disabled:v,onClickCapture:o,onClick:()=>x.mutate({repostable:s}),children:i?e.jsx(c,{message:"Reposted"}):e.jsx(c,{message:"Repost"})}):null}function ce({item:s,className:t,showPlays:a=!0}){return e.jsxs("div",{className:m("flex items-center gap-20 text-sm text-muted",t),children:[a&&e.jsx(ue,{item:s}),e.jsx(me,{item:s}),s.model_type!=="artist"&&e.jsx(de,{item:s})]})}function ue({item:s}){if(!s.plays)return null;const t=e.jsx(k,{compactDisplay:"short",notation:"compact",value:s.plays});return e.jsx(b,{label:e.jsx(c,{message:":count plays",values:{count:t}}),children:e.jsxs("div",{children:[e.jsx(ae,{size:"xs",className:"mr-4"}),t]})})}function me({item:s}){if(!s.likes_count)return null;const t=e.jsx(k,{value:s.likes_count});return e.jsx(b,{label:e.jsx(c,{message:":count likes",values:{count:t}}),children:e.jsxs("div",{children:[e.jsx(M,{size:"xs",className:"mr-4"}),t]})})}function de({item:s}){if(!s.reposts_count)return null;const t=e.jsx(k,{value:s.reposts_count});return e.jsx(b,{label:e.jsx(c,{message:":count reposts",values:{count:t}}),children:e.jsxs("div",{children:[e.jsx(D,{size:"xs",className:"mr-4"}),t]})})}function De({item:s,managesItem:t,buttonClassName:a,buttonGap:n="mr-8",buttonSize:r="xs",children:o,className:l}){return e.jsxs("div",{className:m("flex flex-col items-center justify-center gap-24 overflow-hidden @container md:flex-row md:justify-between",l),children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-y-24",children:[o,e.jsx(oe,{size:r,likeable:s,className:m(n,a,"max-md:hidden"),disabled:t}),e.jsx(le,{item:s,size:r,disabled:t,className:m(n,a,"hidden @[840px]:inline-flex")}),e.jsxs(w,{type:"modal",children:[e.jsx(j,{size:r,variant:"outline",startIcon:e.jsx(re,{}),className:m(n,a,"hidden @[660px]:inline-flex"),children:e.jsx(c,{message:"Share"})}),e.jsx(se,{item:s})]}),e.jsxs(w,{type:"popover",mobileType:"tray",children:[e.jsx(j,{variant:"outline",size:r,startIcon:e.jsx(ne,{}),className:m(n,a),children:e.jsx(c,{message:"More"})}),e.jsx(xe,{item:s})]})]}),e.jsx(ce,{item:s})]})}function xe({item:s}){return s.model_type==="track"?e.jsx(te,{tracks:[s]}):e.jsx(J,{album:s})}const P=d.createContext(null);function Pe({children:s,disableCommenting:t=!1}){const[a,n]=d.useState(!1),r=d.useRef(null),o=d.useRef(0),l=d.useMemo(()=>({newCommentInputRef:r,newCommentPositionRef:o,markerIsVisible:a,setMarkerIsVisible:n,disableCommenting:t}),[a,t]);return e.jsx(P.Provider,{value:l,children:s})}function _(s){return["tracks",+s,"wave-data"]}function fe(s){S.invalidateQueries({queryKey:_(s)})}function _e(s,{enabled:t}={}){return z({queryKey:_(s),queryFn:()=>pe(s),enabled:t})}function pe(s){return N.get(`tracks/${s}/wave`).then(t=>t.data)}function je(){const s=A();return q({mutationFn:t=>ve(t),onSuccess:async(t,a)=>{await s.invalidateQueries({queryKey:Q.commentable(a.commentable).invalidateKey}),H(p("Comment posted"))},onError:t=>E(t)})}function ve({commentable:s,content:t,inReplyTo:a,...n}){const r={commentable_id:s.id,commentable_type:s.model_type,content:t,inReplyTo:a,...n};return N.post("comment",r).then(o=>o.data)}function ye({commentable:s,inReplyTo:t,onSuccess:a,className:n,autoFocus:r,payload:o,...l}){const{trans:x}=K(),{user:i}=F(),f=je(),v=V(),u=W(l.inputRef),[h,g]=d.useState(!1),[y,I]=d.useState(""),R=()=>{g(!1),u.current&&(u.current.blur(),I(""))};return e.jsxs("form",{className:m("flex gap-24 py-6",n),onSubmit:C=>{C.preventDefault(),y&&!f.isPending&&f.mutate({...o,commentable:s,content:y,inReplyTo:t},{onSuccess:()=>{R(),a==null||a()}})},children:[e.jsx($,{size:v?"lg":"xl",circle:!0,src:i==null?void 0:i.image,label:i==null?void 0:i.name}),e.jsxs("div",{className:"flex-auto",children:[e.jsx("div",{className:"mb-10 text-xs text-muted",children:e.jsx(c,{message:"Comment as :name",values:{name:e.jsx("span",{className:"font-medium text",children:i==null?void 0:i.name})}})}),e.jsx(O,{inputRef:u,autoFocus:r,inputElementType:"textarea",inputClassName:"resize-none",value:y,onChange:C=>I(C.target.value),onFocus:()=>g(!0),onBlur:()=>{y||g(!1)},minLength:3,rows:h?3:1,placeholder:x(t?p("Write a reply"):p("Leave a comment"))}),h&&e.jsxs("div",{className:"mt-12 flex items-center justify-end gap-12",children:[e.jsx(j,{variant:"outline",onClick:()=>R(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(j,{variant:"outline",color:"primary",type:"submit",disabled:f.isPending||y.length<3,children:e.jsx(c,{message:"Comment"})})]})]})]})}function Be({commentable:s,className:t}){const{isLoggedIn:a}=F(),{newCommentInputRef:n,newCommentPositionRef:r,setMarkerIsVisible:o}=d.useContext(P);return a?e.jsx(ye,{inputRef:n,className:t,commentable:s,payload:{position:r.current},onSuccess:()=>{o(!1),fe(s.id)}}):null}export{Pe as C,oe as L,ce as M,ye as N,De as T,P as a,Be as b,_e as u};
