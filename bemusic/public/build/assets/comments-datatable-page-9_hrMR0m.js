import{j as e,D as U,t as g,T as i,G as D,H as S,I as F,J as n,b as P,aa as y,cn as C,r as d,d as L,U as R,c1 as _,co as I,ar as q,a6 as A,v as B,c8 as O,S as H,cj as Q,cp as z}from"./main-CUJEGI8U.js";import{u as K}from"./use-delete-comments-Gq9uGbac.js";import{C as M}from"./confirmation-dialog-DVMbD2S1.js";import{L as V}from"./external-link-jlnQ3iTs.js";import{C as G}from"./checkbox-suk8vW77.js";import{F as f,d as v,u as J,a as W,G as Z,D as $,b as X,c as Y}from"./use-datatable-query-D9uebfzx.js";import{U as ee}from"./user-D6GCMJ6c.js";import{c as te,u as se,F as ae}from"./timestamp-filters-DydeeDDl.js";import{D as re}from"./datatable-page-with-header-layout-C4e5sJMc.js";import"./dialog-footer-jZcc-BBM.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./use-normalized-models-ClA2DWxP.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./formatted-date-DzIPJwiH.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-current-date-time-BhbL04rR.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./normalized-model-field-8T9JWy8W.js";import"./Edit-BRVJ8AkN.js";import"./skeleton-BmWW5Jc-.js";import"./formatted-number-gsF1qEbc.js";import"./dashboard-layout-context-DeTNv3yG.js";function k({commentIds:t,variant:s="outline",size:a="xs",onDelete:m}){const l=K();return e.jsxs(U,{type:"modal",onClose:o=>{o&&l.mutate({commentIds:t},{onSuccess:()=>m()})},children:[e.jsx(g,{variant:s,size:a,color:"danger",className:"mr-10",disabled:l.isPending,children:e.jsx(i,{message:"Delete"})}),e.jsx(M,{isDanger:!0,title:e.jsx(i,{message:"Delete [one comment|other :count comments]",values:{count:t.length}}),body:t.length>1?e.jsx(i,{message:"Are you sure you want to delete selected comments?"}):e.jsx(i,{message:"Are you sure you want to delete this comment?"}),confirm:e.jsx(i,{message:"Delete"})})]})}function ie(){return D({mutationFn:t=>oe(t),onSuccess:(t,s)=>{F(n("Restored [one 1 comment|other :count comments]",{values:{count:s.commentIds.length}}))},onError:t=>S(t)})}function oe({commentIds:t}){return P.post("comment/restore",{commentIds:t}).then(s=>s.data)}function ne({commentIds:t,variant:s="outline",size:a="xs"}){const m=ie();return e.jsx(g,{variant:s,size:a,className:"mr-10",disabled:m.isPending,color:"primary",onClick:()=>{m.mutate({commentIds:t},{onSuccess:()=>{y.invalidateQueries({queryKey:C.invalidateKey})}})},children:e.jsx(i,{message:"Restore"})})}function le(){return D({mutationFn:t=>me(t),onSuccess:()=>{F(n("Comment updated")),y.invalidateQueries({queryKey:C.invalidateKey})},onError:t=>S(t)})}function me({commentId:t,content:s}){return P.put(`comment/${t}`,{content:s}).then(a=>a.data)}function de({comment:t,isSelected:s,onToggle:a,onDelete:m}){const[l,o]=d.useState(!1);return e.jsxs("div",{className:L("border-b p-14",t.deleted&&"bg-danger/6"),children:[t.commentable&&e.jsx(ce,{isSelected:s,onToggle:a,commentable:t.commentable}),e.jsxs("div",{className:"flex items-start gap-10 pt-14 md:pl-20",children:[t.user?e.jsx(R,{className:"flex-shrink-0",user:t.user,size:"md"}):e.jsx(_,{className:"flex-shrink-0",label:"User"}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(ue,{comment:t}),l?e.jsx(xe,{comment:t,onClose:j=>{o(!1),j&&y.invalidateQueries({queryKey:["comment"]})}}):e.jsxs(d.Fragment,{children:[e.jsx("div",{className:"my-14 text-sm",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between gap-24",children:[e.jsxs("div",{children:[t.deleted?e.jsx(ne,{commentIds:[t.id]}):e.jsx(k,{commentIds:[t.id],onDelete:m}),e.jsx(g,{variant:"outline",size:"xs",onClick:()=>{o(!0)},children:e.jsx(i,{message:"Edit"})})]}),e.jsx("div",{className:"text-xs text-danger",children:e.jsx(i,{message:"Reported [one 1 time|other :count times]",values:{count:t.reports_count}})})]})]})]})]})]})}function ce({isSelected:t,onToggle:s,commentable:a}){return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-14",children:e.jsx(G,{checked:t,onChange:()=>s()})}),a.image&&e.jsx("img",{className:"mr-6 h-20 w-20 overflow-hidden rounded object-cover",src:a.image,alt:""}),e.jsx("div",{className:"mr-4 text-sm",children:a.name}),e.jsxs("div",{className:"text-xs text-muted",children:["(",a.model_type,")"]})]})}function ue({comment:t}){return e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("div",{children:t.user&&e.jsx(N,{user:t.user,show:"name"})}),e.jsx("div",{children:"â€¢"}),e.jsx("time",{children:e.jsx(I,{date:t.created_at})}),t.user&&e.jsx("div",{className:"ml-auto hidden md:block",children:e.jsx(N,{user:t.user,show:"email"})})]})}function xe({comment:t,onClose:s}){const[a,m]=d.useState(t.content),l=le();return e.jsxs("form",{onSubmit:o=>{o.preventDefault(),l.mutate({commentId:t.id,content:a},{onSuccess:()=>s(!0)})},children:[e.jsx(q,{autoFocus:!0,inputElementType:"textarea",className:"my-14",rows:2,value:a,onChange:o=>m(o.target.value)}),e.jsx(g,{size:"xs",variant:"outline",color:"primary",type:"submit",className:"mr-6",disabled:l.isPending,children:e.jsx(i,{message:"Save edit"})}),e.jsx(g,{size:"xs",variant:"outline",className:"mr-6",onClick:o=>s(!1),disabled:l.isPending,children:e.jsx(i,{message:"Cancel"})})]})}function N({user:t,show:s}){const{auth:a}=d.useContext(A);return a!=null&&a.getUserProfileLink?e.jsx(B,{to:a.getUserProfileLink(t),className:V,target:"_blank",children:t[s]}):e.jsx("div",{className:"text-muted",children:t[s]})}const pe=[{key:"deleted",label:n("Status"),description:n("Whether comment is active or deleted"),defaultOperator:v.eq,control:{type:f.Select,defaultValue:"01",options:[{key:"01",label:n("Active"),value:!1},{key:"02",label:n("Deleted"),value:!0}]}},{key:"reports",label:n("Reported"),description:n("Show only reported comments"),defaultOperator:v.has,control:{type:f.BooleanToggle,defaultValue:"*"}},{key:"user_id",label:n("User"),description:n("User comment was created by"),defaultOperator:v.eq,control:{type:f.SelectModel,model:ee}},te({description:n("Date comment was created")}),se({description:n("Date comment was last updated")})],ge=""+new URL("public-discussion-BOWfRJsZ.svg",import.meta.url).href;function Ye({hideTitle:t,commentable:s}){var b;const a=d.useMemo(()=>pe.filter(r=>r.key!=="commentable_id"||!s),[s]),{encodedFilters:m}=O(a),{searchParams:l,mergeIntoSearchParams:o,setSearchQuery:j,isFiltering:w}=J(z),[x,h]=d.useState([]),c=W(C.index({...l,with:"commentable",withCount:"reports",filters:m,commentable_type:s==null?void 0:s.model_type,commentable_id:s==null?void 0:s.id,loader:"commentDatatablePage"})),T=d.useCallback(r=>{const p=[...x];if(!p.includes(r))p.push(r);else{const E=p.indexOf(r);p.splice(E,1)}h(p)},[x,h]),u=(b=c.data)==null?void 0:b.pagination;return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs(d.Fragment,{children:[e.jsx(H,{children:e.jsx(i,{message:"Comments"})}),e.jsx(Z,{query:c}),!t&&e.jsx(re,{title:e.jsx(i,{message:"Comments"}),showSidebarToggleButton:!0})]}),e.jsxs("div",{className:"flex-auto overflow-y-auto p-12 md:p-24",children:[e.jsx($,{filters:a,searchValue:l.query,onSearchChange:j,selectedItems:x,selectedActions:e.jsx(k,{size:"sm",variant:"flat",commentIds:x,onDelete:()=>h([])})}),e.jsx(ae,{className:"mb-14",filters:a}),c.isLoading?e.jsx(Q,{className:"min-h-200"}):e.jsx("div",{className:"rounded border-x border-t",children:u==null?void 0:u.data.map(r=>e.jsx(de,{comment:r,isSelected:x.includes(r.id),onToggle:()=>T(r.id),onDelete:()=>h([])},r.id))}),(c.isFetched||c.isPlaceholderData)&&!(u!=null&&u.data.length)?e.jsx(X,{className:"pt-50",isFiltering:w,image:ge,title:e.jsx(i,{message:"No comments have been created yet"}),filteringTitle:e.jsx(i,{message:"No matching comments"})}):void 0,e.jsx(Y,{className:"mt-10",query:c,onPageChange:r=>o({page:r.toString()}),onPerPageChange:r=>o({perPage:r.toString()})})]})]})}export{Ye as Component};
