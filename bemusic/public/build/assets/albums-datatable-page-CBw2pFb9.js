import{j as e,T as a,W as p,v as g,J as r,z as C,G as y,H as f,I as D,aa as A,b as S,M as P,$ as w,a0 as _,a1 as L,a2 as E,as as N,V as B,t as x,r as k,at as I,S as M,ab as H,D as T,u as O,ae as q,a8 as R}from"./main-CUJEGI8U.js";import{A as W}from"./album-image-CkUJpPZs.js";import{A as z}from"./album-link-DwfnHHp7.js";import{S as Q}from"./small-artist-image-BqXmK0zy.js";import{A as G}from"./artist-link-XkkvBaYk.js";import{F as h}from"./formatted-date-DzIPJwiH.js";import{F as b}from"./formatted-number-gsF1qEbc.js";import{B as $}from"./BarChart-BpaNOmqn.js";import{E as K}from"./Edit-BRVJ8AkN.js";import{F as u,d as c,A as V,u as U,a as J,G as X,D as Y,b as Z,c as ee}from"./use-datatable-query-D9uebfzx.js";import{c as te,u as ae}from"./timestamp-filters-DydeeDDl.js";import{A as se}from"./artist-C2fP4kQS.js";import{D as re}from"./dialog-footer-jZcc-BBM.js";import{A as oe}from"./album-C9ItuPVf.js";import{D as ie}from"./paginated-resources-BDxg6DLi.js";import{D as le}from"./data-table-add-item-button-_qDHIKil.js";import{D as ne}from"./datatable-filters-DFYg3QEK.js";import{a as me,D as de,b as ue,c as ce}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as pe}from"./table-CgoYghfp.js";import{P as ge}from"./Publish-wob_XvAQ.js";import{C as xe}from"./confirmation-dialog-DVMbD2S1.js";import{G as he}from"./music-Bh2SQVZ2.js";import"./Album-pwm22nnR.js";import"./Mic-DAPkQZuC.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./use-normalized-models-ClA2DWxP.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-current-date-time-BhbL04rR.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./normalized-model-field-8T9JWy8W.js";import"./skeleton-BmWW5Jc-.js";import"./Add-B3RL66ee.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";const be=[{key:"name",allowsSorting:!0,header:()=>e.jsx(a,{message:"Album"}),width:"flex-3",visibleInMode:"all",body:t=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(W,{album:t,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),e.jsx(z,{album:t,target:"_blank"})]})},{key:"artist",allowsSorting:!1,header:()=>e.jsx(a,{message:"Artist"}),width:"flex-2",body:t=>{var s;return(s=t.artists)!=null&&s[0]?e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(Q,{artist:t.artists[0],className:"flex-shrink-0 rounded",size:"w-34 h-34"}),e.jsx(G,{artist:t.artists[0]})]}):null}},{key:"release_date",allowsSorting:!0,minWidth:"min-w-100",header:()=>e.jsx(a,{message:"Release date"}),body:t=>t.release_date?e.jsx(h,{date:t.release_date}):null},{key:"track_count",allowsSorting:!1,minWidth:"min-w-70",header:()=>e.jsx(a,{message:"Track count"}),body:t=>t.tracks_count?e.jsx(b,{value:t.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>e.jsx(a,{message:"Plays"}),minWidth:"min-w-70",body:t=>t.plays?e.jsx(b,{value:t.plays}):null},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>t.updated_at?e.jsx(h,{date:t.updated_at}):""},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,visibleInMode:"all",align:"end",width:"w-84 flex-shrink-0",body:t=>e.jsxs("div",{className:"text-muted",children:[e.jsx(p,{size:"md",elementType:g,to:`${t.id}/insights`,children:e.jsx($,{})}),e.jsx(p,{size:"md",elementType:g,to:`${t.id}/edit`,children:e.jsx(K,{})})]})}],j=[{key:"image",label:r("Artwork"),description:r("Whether album has any artwork uploaded"),defaultOperator:c.eq,control:{type:u.Select,defaultValue:"02",options:[{key:"01",label:r("Has artwork"),value:!1},{key:"02",label:r("Does not have artwork"),value:!0}]}},{key:"plays",label:r("Plays count"),description:r("Number of times this album was played"),defaultOperator:c.gte,operators:V,control:{type:u.Input,inputType:"number",defaultValue:100}},te({description:r("Date album was created")}),ae({description:r("Date album was last updated")}),{defaultOperator:c.has,key:"artists",label:r("Artist"),description:r("Artist this album belongs to"),control:{type:u.SelectModel,model:se}}];function je(){const{trans:t}=C();return y({mutationFn:s=>ye(s),onSuccess:()=>{D(t(r("Album imported"))),A.invalidateQueries({queryKey:ie("albums")})},onError:s=>f(s)})}function ye(t){return S.post("import-media/single-item",{modelType:oe,spotifyId:t.spotifyId}).then(s=>s.data)}function fe(){const t=P(),{formId:s,close:o}=w(),i=je();return e.jsxs(_,{children:[e.jsx(L,{children:e.jsx(a,{message:"Import album"})}),e.jsx(E,{children:e.jsx(N,{id:s,form:t,onSubmit:l=>{i.mutate(l,{onSuccess:m=>{o(m.album)}})},children:e.jsx(B,{autoFocus:!0,required:!0,name:"spotifyId",minLength:22,maxLength:22,label:e.jsx(a,{message:"Spotify ID"}),description:e.jsx(a,{message:"This will also import all artists that collaborated on this album and any tracks that it contains."})})})}),e.jsxs(re,{children:[e.jsx(x,{onClick:()=>o(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(x,{form:s,variant:"flat",color:"primary",type:"submit",disabled:i.isPending,children:e.jsx(a,{message:"Import"})})]})]})}function kt(){const[t,s]=k.useState([]),{searchParams:o,sortDescriptor:i,mergeIntoSearchParams:l,setSearchQuery:m,isFiltering:v}=U(H),n=J(I.albums.index({...o,withCount:"tracks"})),F=e.jsxs(T,{type:"modal",children:[e.jsx(x,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Ae,{selectedIds:t,onDelete:()=>s([])})]});return e.jsxs(me,{children:[e.jsx(X,{query:n}),e.jsx(M,{children:e.jsx(a,{message:"Albums"})}),e.jsx(de,{title:e.jsx(a,{message:"Albums"}),showSidebarToggleButton:!0}),e.jsxs(ue,{children:[e.jsx(Y,{searchValue:o.query,onSearchChange:m,actions:e.jsx(De,{}),selectedItems:t,selectedActions:F,filters:j}),e.jsx(ne,{filters:j}),e.jsxs(ce,{children:[e.jsx(pe,{columns:be,data:n.items,sortDescriptor:i,onSortChange:l,enableSelection:!0,selectedRows:t,onSelectionChange:s}),n.isEmpty&&e.jsx(Z,{isFiltering:v,image:he,title:e.jsx(a,{message:"No albums have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching albums"})}),e.jsx(ee,{query:n,onPageChange:d=>l({page:d}),onPerPageChange:d=>l({perPage:d})})]})]})]})}function De(){const{spotify_is_setup:t}=O(),s=q();return e.jsxs(k.Fragment,{children:[t&&e.jsxs(T,{type:"modal",onClose:o=>{o&&s(`/admin/albums/${o.id}/edit`)},children:[e.jsx(R,{label:e.jsx(a,{message:"Import by spotify ID"}),children:e.jsx(p,{variant:"outline",color:"primary",className:"flex-shrink-0",size:"sm",children:e.jsx(ge,{})})}),e.jsx(fe,{})]}),e.jsx(le,{elementType:g,to:"new",children:e.jsx(a,{message:"Add new album"})})]})}function Ae({selectedIds:t,onDelete:s}){const{close:o}=w(),i=y({mutationFn:()=>S.delete(`albums/${t.join(",")}`),onSuccess:async()=>{await A.invalidateQueries({queryKey:I.albums.invalidateKey}),D(r("Albums deleted")),s(),o()},onError:l=>f(l)});return e.jsx(xe,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete albums"}),body:e.jsx(a,{message:"Are you sure you want to delete selected albums?",values:{count:t.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{kt as Component};
