import{r as g,c7 as z,j as s,z as D,Q as b,T as x,av as y,D as I,b7 as T,am as B,aC as P,J as h,P as E,_ as V,V as L,c1 as $,c8 as N,$ as w,a0 as W,a1 as H,a2 as _,t as k,M as K,as as O,d as C,W as v,A as Q,ar as q,ao as G,b4 as U,c9 as S,K as J,X,ai as Y,aj as Z,a as ee}from"./main-CUJEGI8U.js";import{F as se}from"./FilterAlt-Cw-mRuQp.js";import{F as ae}from"./form-normalized-model-chip-field-R33Z1aXc.js";import{F as te}from"./form-chip-field-ehb7ckkp.js";import{A as ne,a as oe}from"./accordion-BALGWyw-.js";import{C as re}from"./checkbox-suk8vW77.js";import{A as le}from"./ArrowRightAlt-iO8zeT1U.js";import{D as ce}from"./DateRange-Bhvye4F9.js";import{D as ie,a as A}from"./use-base-date-picker-state-DaWG2IMs.js";import{u as de,b as ue}from"./use-date-range-picker-state-CSWp3d1-.js";import{F as R,S as me}from"./select-Z9R0wV6S.js";import{F as he}from"./normalized-model-field-8T9JWy8W.js";import{K as ge}from"./KeyboardArrowRight-CjTKdvdU.js";function ss({query:e}){const[a]=g.useState(()=>new z),t=e.isFetching;return g.useEffect(()=>(t?a.show():a.hide(),()=>{t||a.hide()}),[t,a]),null}function xe({filter:e}){return s.jsx(pe,{filter:e,name:`${e.key}.value`})}function pe({filter:e,name:a,size:t="sm"}){var o;const{trans:n}=D();return e.control.autocompleteEndpoint?s.jsx(ae,{name:a,size:t,placeholder:e.control.placeholder?n(e.control.placeholder):void 0,endpoint:e.control.autocompleteEndpoint}):s.jsx(te,{size:t,name:a,valueKey:"id",allowCustomValue:!1,showDropdownArrow:!0,isAsync:!0,placeholder:e.control.placeholder?n(e.control.placeholder):void 0,displayWith:r=>{var l;const d=(l=e.control.options)==null?void 0:l.find(i=>i.key===r.id);if(d)return typeof d.label=="string"?d.label:d.label.message},suggestions:(o=e.control.options)==null?void 0:o.map(r=>({id:r.key,name:typeof r.label=="string"?r.label:r.label.message})),children:r=>s.jsx(b,{value:r.id,children:s.jsx(x,{message:r.name})},r.id)})}var p=(e=>(e.Select="select",e.DateRangePicker="dateRangePicker",e.SelectModel="selectModel",e.Input="input",e.BooleanToggle="booleanToggle",e.ChipField="chipField",e.Custom="custom",e))(p||{}),je=(e=>(e.eq="=",e.ne="!=",e.gt=">",e.gte=">=",e.lt="<",e.lte="<=",e.has="has",e.notNull="notNull",e.contains="contains",e.notContains="notContains",e.startsWith="startsWith",e.endsWith="endsWith",e.hasAll="hasAll",e.doesntHave="doesntHave",e.between="between",e))(je||{});const as=["=","!=",">",">=","<","<=","notNull"];function fe({filter:e}){return null}function be(e){var f,F;const{granularity:a,closeDialogOnSelection:t,...n}=e,o=de(e),r=g.useRef(null),l=y()&&a!=="day",i=s.jsx(I,{offset:8,placement:"bottom-start",isOpen:o.calendarIsOpen,onOpenChange:o.setCalendarIsOpen,type:"popover",triggerRef:r,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsx(ue,{state:o})}),c={onClick:j=>{j.stopPropagation(),j.preventDefault(),ye(j)?o.setCalendarIsOpen(!1):o.setCalendarIsOpen(!0)}},m=o.selectedValue,u=o.setSelectedValue;return s.jsxs(g.Fragment,{children:[s.jsxs(ie,{ref:r,wrapperProps:c,endAdornment:l?void 0:s.jsx(ce,{}),...n,children:[s.jsx(A,{isPlaceholder:(f=o.isPlaceholder)==null?void 0:f.start,state:o,segmentProps:c,value:m.start,onChange:j=>{u({start:j,end:m.end})}}),s.jsx(le,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(A,{isPlaceholder:(F=o.isPlaceholder)==null?void 0:F.end,state:o,segmentProps:c,value:m.end,onChange:j=>{u({start:m.start,end:j})}})]}),i]})}function ye(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}function ke(e){const{field:{onChange:a,onBlur:t,value:n,ref:o},fieldState:{invalid:r,error:d}}=T({name:e.name}),l={onChange:i=>{a(i?De(i):null)},onBlur:t,value:ve(n),invalid:r,errorMessage:d==null?void 0:d.message,inputRef:o};return s.jsx(be,{...B(l,e)})}function ve(e){const{start:a,end:t,preset:n}=e||{},o={preset:n};try{a&&(o.start=typeof a=="string"?P(a):a),t&&(o.end=typeof t=="string"?P(t):t)}catch{}return o}function De({start:e,end:a,preset:t}={}){const n={preset:t};return e&&(n.start=e.toAbsoluteString()),a&&(n.end=a.toAbsoluteString()),n}function Fe({filter:e,name:a,size:t="sm"}){return s.jsx(ke,{min:e.control.min,max:e.control.max,size:t,name:a,granularity:"day",closeDialogOnSelection:!0})}function Pe({filter:e}){return s.jsx(Fe,{filter:e,name:`${e.key}.value`})}const Se={"=":h("is"),"!=":h("is not"),">":h("is greater than"),">=":h("is greater than or equal to"),"<":h("is less than"),"<=":h("is less than or equal to"),notNull:h("is not empty"),contains:h("contains"),notContains:h("does not contain"),startsWith:h("starts with"),endsWith:h("ends with"),has:h("Include"),doesntHave:h("Do not include"),between:h("Is between"),hasAll:h("Include all")};function Ae({filter:e}){var n,o;const a=E(),t=V({control:a.control,name:`${e.key}.operator`});return s.jsxs(g.Fragment,{children:[(n=e.operators)!=null&&n.length?s.jsx(R,{selectionMode:"single",name:`${e.key}.operator`,className:"mb-14",size:"sm",children:(o=e.operators)==null?void 0:o.map(r=>s.jsx(b,{value:r,children:s.jsx(x,{...Se[r]})},r))}):null,t==="notNull"?null:s.jsx(Ie,{filter:e,name:`${e.key}.value`})]})}function Ie({filter:e,name:a,size:t="sm"}){const n=e.control;return s.jsx(L,{size:t,name:a,type:e.control.inputType,min:"minValue"in n?n.minValue:void 0,max:"maxValue"in n?n.maxValue:void 0,minLength:"minLength"in n?n.minLength:void 0,maxLength:"maxLength"in n?n.maxLength:void 0})}function Ne({filter:e}){return s.jsx(we,{filter:e,name:`${e.key}.value`})}function we({filter:e,name:a,size:t="sm"}){return s.jsx(he,{name:a,size:t,endpoint:e.control.endpoint?e.control.endpoint:`normalized-models/${e.control.model}`})}function Ce({filter:e}){return s.jsx(Re,{filter:e,name:`${e.key}.value`})}function Re({filter:e,name:a,size:t="sm"}){const{trans:n}=D();return s.jsx(R,{size:t,name:a,selectionMode:"single",showSearchField:e.control.showSearchField,placeholder:e.control.placeholder?n(e.control.placeholder):void 0,searchPlaceholder:e.control.searchPlaceholder?n(e.control.searchPlaceholder):void 0,children:e.control.options.map(o=>s.jsx(b,{value:o.key,startIcon:e.control.showAvatar?s.jsx($,{size:"sm",src:o.image,label:typeof o.label=="object"?o.label.message:o.label}):null,children:typeof o.label=="string"?o.label:s.jsx(x,{...o.label})},o.key))})}function Me({filters:e}){const{decodedFilters:a}=N(e),{formId:t}=w(),[n,o]=g.useState(()=>a.map(l=>l.key)),r=s.jsx(k,{size:"xs",variant:"outline",className:"mr-auto",onClick:()=>{o([])},children:s.jsx(x,{message:"Clear"})}),d=s.jsx(k,{size:"xs",variant:"flat",color:"primary",className:"ml-auto",type:"submit",form:t,children:s.jsx(x,{message:"Apply"})});return s.jsxs(W,{className:"min-w-[300px]",maxWidth:"max-w-400",size:"auto",children:[s.jsx(H,{padding:"px-14 py-10",leftAdornment:r,rightAdornment:d,children:s.jsx(x,{message:"Filter"})}),s.jsx(_,{padding:"p-0",children:s.jsx(ze,{filters:e,expandedFilters:n,setExpandedFilters:o})})]})}function ze({filters:e,expandedFilters:a,setExpandedFilters:t}){const{decodedFilters:n,replaceAll:o}=N(e),r={};e.forEach(c=>{const m=n.find(u=>u.key===c.key);r[c.key]=(m==null?void 0:m.value)!==void 0?m:{value:c.control.defaultValue,operator:c.defaultOperator}});const d=K({defaultValues:r}),{formId:l,close:i}=w();return s.jsx(O,{form:d,id:l,onSubmit:c=>{const m=Object.entries(c).filter(([u,f])=>a.includes(u)&&f!==void 0).map(([u,f])=>({key:u,...f}));o(m),i()},children:s.jsx(ne,{size:"md",mode:"multiple",expandedValues:a,onExpandedChange:t,children:e.map(c=>s.jsxs(oe,{startIcon:s.jsx(re,{checked:a.includes(c.key)}),value:c.key,label:s.jsx(x,{...c.label}),bodyClassName:"max-h-288 overflow-y-auto compact-scrollbar",children:[c.description&&s.jsx("div",{className:C("text-xs text-muted",c.control.type!==p.BooleanToggle&&"mb-14"),children:s.jsx(x,{...c.description})}),s.jsx(Te,{filter:c})]},c.key))})})}function Te({filter:e}){switch(e.control.type){case p.Select:return s.jsx(Ce,{filter:e});case p.ChipField:return s.jsx(xe,{filter:e});case p.DateRangePicker:return s.jsx(Pe,{filter:e});case p.SelectModel:return s.jsx(Ne,{filter:e});case p.Input:return s.jsx(Ae,{filter:e});case p.BooleanToggle:return s.jsx(fe,{filter:e});case"custom":const a=e.control.panel;return s.jsx(a,{filter:e});default:return null}}function Be({filters:e,icon:a=s.jsx(se,{}),color:t="primary",variant:n="outline",size:o="sm",disabled:r,className:d}){const l=y(),i=s.jsx(k,{variant:n,color:t,startIcon:a,disabled:r,size:o,className:d,children:s.jsx(x,{message:"Filter"})}),c=s.jsx(v,{color:t,size:"sm",variant:n,disabled:r,className:d,children:a});return s.jsxs(I,{type:"popover",children:[l?c:i,s.jsx(Me,{filters:e})]})}function ts(e){var a;return s.jsx(Q,{initial:!1,mode:"wait",children:(a=e.selectedItems)!=null&&a.length?g.createElement(Ve,{...e,key:"selected"}):g.createElement(Ee,{...e,key:"default"})})}function Ee({searchPlaceholder:e=h("Type to search..."),searchValue:a,onSearchChange:t,actions:n,filters:o,filtersLoading:r}){const{trans:d}=D();return s.jsxs(M,{children:[s.jsx(q,{size:"sm",className:"mr-auto min-w-180 max-w-440 flex-auto",inputWrapperClassName:"mr-24 md:mr-0",placeholder:d(e),startAdornment:s.jsx(G,{size:"sm"}),value:a,onChange:l=>{t(l.target.value)}}),o&&s.jsx(Be,{filters:o,disabled:r}),n]})}function Ve({selectedActions:e,selectedItems:a}){return s.jsxs(M,{"data-testid":"datatable-selected-header",children:[s.jsx("div",{className:"mr-auto font-medium",children:s.jsx(x,{message:"[one 1 item|other :count items] selected",values:{count:(a==null?void 0:a.length)||1}})}),e]})}function M({children:e,...a}){return s.jsx("div",{className:"hidden-scrollbar relative mb-24 flex h-42 flex-shrink-0 items-center gap-8 overflow-x-auto md:gap-12",...a,children:e})}const Le=15,$e=[{key:15},{key:30},{key:60},{key:100}];function ns({query:e,onPerPageChange:a,onPageChange:t,hideIfOnlyOnePage:n,className:o}){var m;const r=y(),d=U(),l=(m=e.data)==null?void 0:m.pagination,i=l!=null&&l.current_page?+l.current_page:1;if(!l||n&&i==1&&!S(l))return null;const c=a?s.jsx(me,{selectionMode:"single",minWidth:"min-w-auto",disabled:e.isLoading,labelPosition:"side",size:"xs",label:s.jsx(x,{message:"Items per page"}),selectedValue:l.per_page?+l.per_page:Le,onSelectionChange:u=>a(u),children:$e.map(u=>s.jsx(b,{value:u.key,children:u.key},u.key))}):null;return s.jsxs("div",{className:C("flex h-54 select-none items-center justify-end gap-20 px-20",o),children:[!r&&c,l.from&&l.to&&"total"in l?s.jsx("div",{className:"text-sm",children:s.jsx(x,{message:":from - :to of :total",values:{from:l.from,to:l.to,total:d.format(l.total)}})}):null,s.jsxs("div",{className:"text-muted",children:[s.jsx(v,{disabled:e.isFetching||i<2,onClick:()=>{t==null||t(i-1)},children:s.jsx(J,{})}),s.jsx(v,{disabled:e.isFetching||!S(l),onClick:()=>{t==null||t(i+1)},children:s.jsx(ge,{})})]})]})}function os(e){const[a,t]=X(),n=g.useMemo(()=>e?e(Object.fromEntries(a)):Object.fromEntries(a),[a,e]),o=g.useCallback(l=>{const i={...Object.fromEntries(a),...l},c=e?e(i):i;t(m=>{for(const u in c)c[u]===""||u==="page"&&c[u]=="1"||u==="perPage"&&c[u]=="15"?m.delete(u):m.set(u,c[u]);return m},{replace:!0})},[e,a,t]),r=g.useCallback(l=>{t(i=>(i.delete("page"),i.delete("perPage"),l?i.set("query",l):i.delete("query"),i),{replace:!0})},[t]),d=g.useMemo(()=>({orderBy:n.orderBy,orderDir:n.orderDir}),[n]);return{searchParams:n,mergeIntoSearchParams:o,setSearchQuery:r,sortDescriptor:d,isFiltering:!!(n.query||n.filters)}}function rs(e){const a=y(),{isFiltering:t,title:n,filteringTitle:o,image:r,icon:d,className:l}=e;let i=e.size;return i||(i=a?"sm":"md"),s.jsx(Y,{className:l,size:i,imageHeight:d?"h-auto":void 0,image:r?s.jsx(Z,{src:r}):g.cloneElement(d,{size:d.props.size||"xl",className:"text-muted"}),title:t&&o?o:n,description:s.jsx(We,{...e})})}function We({isFiltering:e,filteringTitle:a,description:t}){return e?a?s.jsx(x,{message:"Try another search query or different filters"}):void 0:t}function ls(e){var t,n;const a=ee(e);return{...a,items:((t=a.data)==null?void 0:t.pagination.data)??[],isEmpty:(a.isFetched||a.isPlaceholderData||e.enabled===!1)&&!((n=a.data)!=null&&n.pagination.data.length)}}export{as as A,xe as C,ts as D,p as F,ss as G,Ae as I,Ne as N,Ce as S,ls as a,rs as b,ns as c,je as d,Se as e,Pe as f,De as g,os as u};
