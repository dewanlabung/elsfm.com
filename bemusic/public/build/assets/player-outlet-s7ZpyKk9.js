const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./hls-provider-5_8bYa_W.js","./main-CUJEGI8U.js","./main-CjleJaCk.css","./use-player-store-BWFGgN3k.js","./is-ctrl-or-shift-pressed-Bx-mqgCW.js","./middleware-BLXTWOs6.js","./traditional-BcYcLesO.js","./share-media-button-Dw3JV4C-.js","./offline-media-items-Dlxt2ETB.js","./extension-from-filename-O0XMuZye.js","./play-arrow-filled-BrHo1wfG.js","./Pause-B4fj-x54.js","./create-playlist-dialog-DeyZkjsM.js","./image-selector-GLpYAkj6.js","./file-upload-provider-DWaB2xE4.js","./uploaded-file-ksxfN_l-.js","./pretty-bytes-bO14ePu9.js","./use-active-upload-BwzDBsep.js","./open-upload-window-CboR35vP.js","./AddAPhoto-y5pGVyq2.js","./file-input-config-DrcTpI3-.js","./switch-4KDjemPX.js","./Image-DWFqsH18.js","./dialog-footer-jZcc-BBM.js","./use-auth-click-capture-B9wu-BP4.js","./Add-B3RL66ee.js","./KeyboardArrowRight-CjTKdvdU.js","./FavoriteBorder-D1CUmnAo.js","./use-previous-BgqS7ski.js","./album-image-CkUJpPZs.js","./Album-pwm22nnR.js","./album-link-DwfnHHp7.js","./small-artist-image-BqXmK0zy.js","./Mic-DAPkQZuC.js","./artist-link-XkkvBaYk.js","./playlist-image-zogte8rn.js","./PlaylistPlay-DcgxbGJx.js","./playlist-link-CLw6NzkW.js","./share-media-buttons-DtF-m4-I.js","./Share-C8wHCu8Q.js","./track-image-B3DSRXTB.js","./MusicNote-SjrQa4Nt.js","./track-link-D8mIwI0F.js","./tabs-BVjOaE7L.js","./tab-panels-BNEb_18b.js","./use-clipboard-CQvDhy4G.js","./useGlobalListeners-BeXr-yG1.js","./dash-provider-CxFozJUD.js"])))=>i.map(i=>d[i]);
import{l as q,a as z}from"./share-media-button-Dw3JV4C-.js";import{bK as H,bL as K,aa as C,b as R,aF as S,I as W,J,j as m,d as G,r as d,R as $,ai as X,T as I,aB as N}from"./main-CUJEGI8U.js";import{u as y,a as h,b as Z}from"./use-player-store-BWFGgN3k.js";import{$ as Y}from"./useGlobalListeners-BeXr-yG1.js";const ee=H()(K((e,t)=>({isMaximized:!1,isQueueOpen:!1,open:()=>{e(n=>{n.isMaximized=!0,n.isQueueOpen=!1})},toggle:()=>{e(n=>{n.isMaximized=!n.isMaximized,n.isQueueOpen=!1})},toggleQueue:()=>{e(n=>{n.isQueueOpen=!n.isQueueOpen})}}))),te=ee.getState(),U=e=>{var n,r,a,o,s;const t=((r=(n=e.artists)==null?void 0:n[0])==null?void 0:r.name)||((s=(o=(a=e.album)==null?void 0:a.artists)==null?void 0:o[0])==null?void 0:s.name);return`search/audio/${e.id}/${j(t)}/${j(e.name)}`};let D=!1;async function re(e,t){const n={queryKey:[U(e)],queryFn:async()=>ae(e,t),staleTime:1/0};let r;try{r=C.getQueryData(n.queryKey)??await C.fetchQuery(n)}catch{}return D=!1,(r==null?void 0:r.results)||[]}function ae(e,t){return D=!0,R.get(U(e),{cancelToken:t==null?void 0:t.token}).then(n=>n.data)}function j(e){return encodeURIComponent(encodeURIComponent(e))}var g=(e=>(e.Play="playVideo",e.Pause="pauseVideo",e.Stop="stopVideo",e.Seek="seekTo",e.Cue="cueVideoById",e.CueAndPlay="loadVideoById",e.Mute="mute",e.Unmute="unMute",e.SetVolume="setVolume",e.SetPlaybackRate="setPlaybackRate",e.SetPlaybackQuality="setPlaybackQuality",e))(g||{}),b=(e=>(e[e.Unstarted=-1]="Unstarted",e[e.Ended=0]="Ended",e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Buffering=3]="Buffering",e[e.Cued=5]="Cued",e))(b||{});const P=new Set,M=" ",O=new Set;let x=0;async function L(e){var r;const t=await re(e.meta),n=(r=t==null?void 0:t.find(a=>!O.has(`${a.id}`)))==null?void 0:r.id;return{...e,src:n||M}}function ne(e){var t,n,r,a;if("mediaSession"in navigator){const o=e.meta;if(!o)return;const s=o.image||((t=o.album)==null?void 0:t.image);navigator.mediaSession.metadata=new MediaMetadata({title:o.name,artist:(r=(n=o.artists)==null?void 0:n[0])==null?void 0:r.name,album:(a=o.album)==null?void 0:a.name,artwork:s?[{src:s,sizes:"300x300",type:"image/jpg"}]:void 0})}}var A;const Ie={persistQueueInLocalStorage:!0,defaultVolume:(A=S().settings.player)==null?void 0:A.default_volume,setMediaSessionMetadata:ne,youtube:{srcResolver:L,onStateChange:e=>{e===b.Playing&&(x=0)}},onBeforePlay:()=>{var t;const e=S().settings.player;if((t=e==null?void 0:e.mobile)!=null&&t.auto_open_overlay&&window.matchMedia("(max-width: 768px)").matches)return te.open(),new Promise(n=>setTimeout(()=>n(),151))},loadMoreMediaItems:async e=>{var n;const t=(n=e==null?void 0:e.groupId)==null?void 0:n.toString();if(e&&t&&!t.includes("libraryDownloadedTracks")){const r=await q(t,e.meta);return await z(r)}},listeners:{cued:({state:{cuedMedia:e}})=>{var a,o;if(!e)return;const t=S().settings.branding.site_name;let n=`${e.meta.name}`;const r=(o=(a=e.meta.artists)==null?void 0:a[0])==null?void 0:o.name;r?n=`${n} - ${r} - ${t}`:n=`${n} - ${t}`,document.title=n},play:({state:{cuedMedia:e,pause:t}})=>{if(!oe()){W.danger(J("Your current plan does not allow music playback.")),t();return}e&&!P.has(e.meta.id)&&(P.add(e.meta.id),R.post(`tracks/plays/${e.meta.id}/log`,{queueId:e.groupId}))},playbackEnd:({state:{cuedMedia:e}})=>{e&&P.delete(e.meta.id)},error:async({sourceEvent:e,state:{cuedMedia:t,providerApi:n,providerName:r,emit:a}})=>{const o=e;if(r==="youtube"&&n){se(o),o.videoId&&O.add(`${o.videoId}`);const s=t?await L(t):null;s!=null&&s.src&&(s==null?void 0:s.src)!==M?(await n.internalProviderApi.loadVideoById(s.src),n.play()):(x++,x<=2&&a("playbackEnd"))}else x=0}},onDestroy:()=>{x=0}};function se(e){const t=e==null?void 0:e.code;!e||!e.videoId||R.post("youtube/log-client-error",{code:t,videoUrl:e.videoId})}function oe(){const e=S().user,t=S().guest_role,n=(e==null?void 0:e.permissions)||(t==null?void 0:t.permissions);return(n==null?void 0:n.find(r=>r.name==="music.play"||r.name==="admin"))!=null}function je({className:e,hideDuringPlayback:t=!0,fallback:n,...r}){const a=y(s=>s.posterUrl),o=y(s=>t&&s.playbackStarted&&s.providerName!=="htmlAudio");return!a&&!n?null:m.jsx("div",{...r,className:G("pointer-events-none flex max-h-full w-full items-center justify-center bg-black transition-opacity",o?"opacity-0":"opacity-100",e),children:a?m.jsx("img",{loading:"lazy",src:a,alt:"",className:"max-h-full w-full flex-shrink-0 object-cover"}):n})}function _({ref:e,internalState:t,toggleTextTrackModes:n}){const r=d.useContext(h);return d.useMemo(()=>({play:async()=>{var a;try{await((a=e.current)==null?void 0:a.play())}catch(o){r.getState().emit("error",{sourceEvent:o})}t.current.timeRafLoop.start()},pause:()=>{var a;(a=e.current)==null||a.pause(),t.current.timeRafLoop.stop()},stop:()=>{e.current&&(e.current.pause(),e.current.currentTime=0)},seek:a=>{a!==t.current.currentTime&&e.current&&(e.current.currentTime=a)},setVolume:a=>{e.current&&(e.current.volume=a/100)},setMuted:a=>{e.current&&(e.current.muted=a)},setPlaybackRate:a=>{e.current&&(e.current.playbackRate=a)},setTextTrackVisibility:a=>{n(r.getState().currentTextTrack,a)},setCurrentTextTrack:a=>{n(a,r.getState().textTrackIsVisible)},getCurrentTime:()=>t.current.currentTime,getSrc:()=>{var a;return(a=e.current)==null?void 0:a.src}}),[e,r,t,n])}const ie=[.25,.5,.75,1,1.25,1.5,1.75,2];function F({ref:e,updateCurrentTime:t,updateBuffered:n,internalState:r}){const a=d.useContext(h),o=d.useCallback(()=>{if(!e.current)return;const s=Array.from(e.current.textTracks).filter(l=>l.label&&(l.kind==="subtitles"||l.kind==="captions"));let i=-1;for(let l=0;l<s.length;l+=1)if(s[l].mode==="hidden")i=l;else if(s[l].mode==="showing"){i=l;break}const c=i!==-1&&s[i].mode==="showing";a.getState().emit("currentTextTrackChange",{trackId:i}),a.getState().emit("textTrackVisibilityChange",{isVisible:c}),a.getState().emit("textTracks",{tracks:s})},[e,a]);return d.useEffect(()=>{const s=e.current;return()=>{s==null||s.textTracks.removeEventListener("change",o)}},[e,o]),d.useMemo(()=>{const s=a.getState().emit;return{autoPlay:!1,onContextMenu:i=>i.preventDefault(),controlsList:"nodownload",preload:"metadata","x-webkit-airplay":"allow",onEnded:()=>{s("playbackEnd"),t(),r.current.timeRafLoop.stop()},onStalled:i=>{i.currentTarget.readyState<3&&s("buffering",{isBuffering:!0})},onWaiting:()=>{s("buffering",{isBuffering:!0})},onPlaying:()=>{s("play"),s("buffering",{isBuffering:!1})},onPause:i=>{s("pause"),s("buffering",{isBuffering:!1}),r.current.timeRafLoop.stop()},onSuspend:()=>{s("buffering",{isBuffering:!1})},onSeeking:()=>{t()},onSeeked:()=>{t()},onTimeUpdate:()=>{t()},onError:i=>{s("error",{sourceEvent:i})},onDurationChange:i=>{t(),s("durationChange",{duration:i.currentTarget.duration})},onRateChange:i=>{s("playbackRateChange",{rate:i.currentTarget.playbackRate})},onLoadedMetadata:i=>{r.current.playbackReady||(s("providerReady",{el:i.currentTarget}),r.current.playbackReady=!0,n(),o(),i.currentTarget.textTracks.addEventListener("change",()=>{o()})),s("cued"),s("playbackRates",{rates:ie})}}},[r,a,t,o,n])}function ce(e){let t;function n(){V(t)&&r()}function r(){t=window.requestAnimationFrame(function(){V(t)||(e(),r())})}function a(){ue(t)&&window.cancelAnimationFrame(t),t=void 0}return{start:n,stop:a}}function V(e){return typeof e>"u"}function ue(e){return typeof e=="number"&&!Number.isNaN(e)}function Q(e){const t=d.useContext(h),n=y(i=>i.cuedMedia),r=d.useRef({currentTime:0,buffered:0,isMediaWaiting:!1,playbackReady:!1,timeRafLoop:ce(()=>{o(),a()})}),a=d.useCallback(()=>{var l;const i=(l=e.current)==null?void 0:l.buffered,c=!i||i.length===0?0:i.end(i.length-1);r.current.buffered!==c&&(t.getState().emit("buffered",{seconds:c}),r.current.buffered=c)},[e,t]),o=d.useCallback(()=>{var c;const i=((c=e.current)==null?void 0:c.currentTime)||0;r.current.currentTime!==i&&!t.getState().isSeeking&&(t.getState().emit("progress",{currentTime:i}),r.current.currentTime=i)},[r,t,e]),s=d.useCallback((i,c)=>{if(!e.current)return;const{textTracks:l}=e.current;if(i===-1)Array.from(l).forEach(f=>{f.mode="disabled"});else{const f=l[t.getState().currentTextTrack];f&&(f.mode="disabled")}const u=l[i];u&&(u.mode=c?"showing":"hidden"),t.getState().emit("currentTextTrackChange",{trackId:c?i:-1}),t.getState().emit("textTrackVisibilityChange",{isVisible:c})},[e,t]);return d.useEffect(()=>{const i=r.current.timeRafLoop;return()=>{i.stop()}},[]),d.useEffect(()=>{var i;(i=e.current)==null||i.load()},[n==null?void 0:n.src,e]),{ref:e,internalState:r,updateCurrentTime:o,toggleTextTrackModes:s,updateBuffered:a}}function le(){const e=d.useRef(null),t=y(l=>l.options.autoPlay),n=y(l=>l.muted),r=y(l=>l.cuedMedia),a=d.useContext(h),o=Q(e),s=F(o),i=_(o);d.useEffect(()=>{a.setState({providerApi:i})},[a,i]);let c=r==null?void 0:r.src;return c&&(r!=null&&r.initialTime)&&(c=`${c}#t=${r.initialTime}`),m.jsx("audio",{className:"h-full w-full",ref:e,src:c,autoPlay:t,muted:n,...s})}function de(){var l;const e=d.useRef(null),t=y(u=>u.options.autoPlay),n=y(u=>u.muted),r=y(u=>u.cuedMedia),a=d.useContext(h),o=Q(e),s=F(o),i=_(o);d.useEffect(()=>{a.setState({providerApi:i})},[a,i]);let c=r==null?void 0:r.src;return c&&(r!=null&&r.initialTime)&&(c=`${c}#t=${r.initialTime}`),m.jsx("video",{className:"h-full w-full",ref:e,src:c,playsInline:!0,poster:(r==null?void 0:r.poster)??void 0,autoPlay:t,muted:n,...s,children:(l=r==null?void 0:r.captions)==null?void 0:l.map((u,f)=>m.jsx("track",{label:u.label,kind:"subtitles",srcLang:u.language||"en",src:u.src,default:f===0},u.id))})}const w=(e,t=1)=>new Promise((n,r)=>{const a=new Image,o=()=>{delete a.onload,delete a.onerror,a.naturalWidth>=t?n(a):r("Could not load youtube image")};Object.assign(a,{onload:o,onerror:o,src:e})}),E=new Map;async function fe(e){if(!e)return;if(E.has(e))return E.get(e);const t=n=>`https://i.ytimg.com/vi/${e}/${n}.jpg`;return w(t("maxresdefault"),121).catch(()=>w(t("sddefault"),121)).catch(()=>w(t("hqdefault"),121)).catch(()=>{}).then(n=>{if(!n)return;const r=n.src;return E.set(e,r),r})}function k(e){return typeof e=="number"&&!Number.isNaN(e)}function me(e,t,n,r){var c,l;const o=(typeof e.data=="string"?JSON.parse(e.data):e.data).info,s=t.current,i=r.getState().emit;if(o){if((c=o.videoData)!=null&&c.video_id&&(s.videoId=o.videoData.video_id),(l=o.videoData)!=null&&l.errorCode){const u={code:o.videoData.errorCode,videoId:s.videoId};i("error",{sourceEvent:u})}if(k(o.duration)&&o.duration!==s.duration&&(s.duration=o.duration,i("durationChange",{duration:s.duration})),k(o.currentTime)&&o.currentTime!==s.currentTime&&(s.currentTime=o.currentTime,r.getState().isSeeking||i("progress",{currentTime:s.currentTime})),k(o.currentTimeLastUpdated)&&(s.lastTimeUpdate=o.currentTimeLastUpdated),k(o.playbackRate)&&(s.playbackRate!==o.playbackRate&&i("playbackRateChange",{rate:o.playbackRate}),s.playbackRate=o.playbackRate),k(o.videoLoadedFraction)){const u=o.videoLoadedFraction*s.duration;s.buffered!==u&&i("buffered",{seconds:o.videoLoadedFraction*s.duration}),s.buffered=u}Array.isArray(o.availablePlaybackRates)&&i("playbackRates",{rates:o.availablePlaybackRates}),k(o.playerState)&&(pe(o,t,n,r),s.state=o.playerState)}}function pe(e,t,n,r){const a=r.getState().emit,o=e.playerState,s=async()=>{var i,c;if((i=e.videoData)!=null&&i.video_id&&!((c=r.getState().cuedMedia)!=null&&c.poster)){const l=await fe(e.videoData.video_id);l&&r.getState().emit("posterLoaded",{url:l})}t.current.playbackReady||(a("providerReady",{el:n.current}),t.current.playbackReady=!0),a("cued")};switch(a("youtubeStateChange",{state:o}),a("buffering",{isBuffering:o===b.Buffering}),o!==b.Ended&&(t.current.firedPlaybackEnd=!1),o){case b.Unstarted:s();break;case b.Ended:t.current.firedPlaybackEnd||(a("playbackEnd"),t.current.firedPlaybackEnd=!0);break;case b.Playing:s(),a("play");break;case b.Paused:a("pause");break;case b.Cued:s();break}}function B(e){var t;return(t=e.match(/((?:\w|-){11})/))==null?void 0:t[0]}const ye="&controls=0&disablekb=1&enablejsapi=1&iv_load_policy=3&modestbranding=1&playsinline=1&rel=0&showinfo=0";function ge(e){var l;const{getState:t,emit:n}=Z(),r=y(u=>u.options),a=y(u=>u.cuedMedia),o=(l=r.youtube)!=null&&l.useCookies?"https://www.youtube.com":"https://www.youtube-nocookie.com",[s,i]=d.useState(()=>{if(a!=null&&a.src&&a.src!=="resolve")return B(a.src)}),c=d.useCallback(u=>{const f=B(u);f&&i(p=>p?(e(f),p):f)},[e]);return d.useEffect(()=>{var u,f;a!=null&&a.src&&a.src!=="resolve"?c(a.src):a&&(n("buffering",{isBuffering:!0}),(f=(u=r.youtube)==null?void 0:u.srcResolver)==null||f.call(u,a).then(p=>{var v;p!=null&&p.src&&((v=t().cuedMedia)==null?void 0:v.id)===p.id&&c(p.src)}))},[r,c,a==null?void 0:a.id]),{initialVideoUrl:s?`${o}/embed/${s}?${ye}&autoplay=${r.autoPlay?"1":"0"}&mute=${t().muted?"1":"0"}&start=${(a==null?void 0:a.initialTime)??0}`:void 0,origin:o}}function be(){const{addGlobalListener:e,removeAllGlobalListeners:t}=Y(),n=d.useRef(null),r=d.useCallback((u,f)=>{var p,v;return(v=(p=n.current)==null?void 0:p.contentWindow)==null?void 0:v.postMessage(JSON.stringify({event:"command",func:u,args:f?[f]:void 0}),"*")},[]),a=d.useCallback(u=>{r(g.CueAndPlay,u)},[r]),{initialVideoUrl:o,origin:s}=ge(a),i=d.useContext(h),c=d.useRef({duration:0,currentTime:0,lastTimeUpdate:0,playbackRate:1,state:-1,playbackReady:!1,buffered:0,firedPlaybackEnd:!1}),l=d.useCallback(()=>{const u={loadVideoById:a};i.setState({providerApi:{play:()=>{r(g.Play)},pause:()=>{r(g.Pause)},stop:()=>{r(g.Stop)},seek:f=>{f!==c.current.currentTime&&r(g.Seek,f)},setVolume:f=>{r(g.SetVolume,f)},setMuted:f=>{r(f?g.Mute:g.Unmute)},setPlaybackRate:f=>{r(g.SetPlaybackRate,f)},setPlaybackQuality:f=>{r(g.SetPlaybackQuality,f)},getCurrentTime:()=>c.current.currentTime,getSrc:()=>c.current.videoId,internalProviderApi:u}})},[i,a,r]);return d.useEffect(()=>(e(window,"message",u=>{var p;const f=u;f.origin===s&&f.source===((p=n.current)==null?void 0:p.contentWindow)&&me(f,c,n,i)}),l(),()=>{t()}),[e,t,i,s,l]),o?m.jsx("iframe",{className:"h-full w-full",ref:n,src:o,allowFullScreen:!0,allow:"autoplay; encrypted-media; picture-in-picture;",referrerPolicy:"strict-origin-when-cross-origin",onLoad:()=>{setTimeout(()=>{var u,f;(f=(u=n.current)==null?void 0:u.contentWindow)==null||f.postMessage(JSON.stringify({event:"listening"}),"*"),l()})}}):null}const he=d.createContext(null),T={didCatch:!1,error:null};class ke extends d.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=T}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,r,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];(n=(r=this.props).onReset)===null||n===void 0||n.call(r,{args:o,reason:"imperative-api"}),this.setState(T)}}componentDidCatch(t,n){var r,a;(r=(a=this.props).onError)===null||r===void 0||r.call(a,t,n)}componentDidUpdate(t,n){const{didCatch:r}=this.state,{resetKeys:a}=this.props;if(r&&n.error!==null&&ve(t.resetKeys,a)){var o,s;(o=(s=this.props).onReset)===null||o===void 0||o.call(s,{next:a,prev:t.resetKeys,reason:"keys"}),this.setState(T)}}render(){const{children:t,fallbackRender:n,FallbackComponent:r,fallback:a}=this.props,{didCatch:o,error:s}=this.state;let i=t;if(o){const c={error:s,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")i=n(c);else if(r)i=d.createElement(r,c);else if(a!==void 0)i=a;else throw s}return d.createElement(he.Provider,{value:{didCatch:o,error:s,resetErrorBoundary:this.resetErrorBoundary}},i)}}function ve(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,r)=>!Object.is(n,t[r]))}const xe=$.lazy(()=>N(()=>import("./hls-provider-5_8bYa_W.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]),import.meta.url)),Se=$.lazy(()=>N(()=>import("./dash-provider-CxFozJUD.js"),__vite__mapDeps([47,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]),import.meta.url)),Le=d.memo(({className:e})=>{const{getState:t}=d.useContext(h);return d.useEffect(()=>(t().init(),t().destroy),[t]),m.jsx("div",{className:e,children:m.jsx(ke,{fallback:m.jsx(we,{}),children:m.jsx(Pe,{})})})});function Pe(){switch(y(t=>t.providerName)){case"youtube":return m.jsx(be,{});case"htmlVideo":return m.jsx(de,{});case"htmlAudio":return m.jsx(le,{});case"hls":return m.jsx(d.Suspense,{children:m.jsx(xe,{})});case"dash":return m.jsx(d.Suspense,{children:m.jsx(Se,{})});default:return null}}function we(){return m.jsx(X,{title:m.jsx(I,{message:"There was an issue loading the player"}),description:m.jsx(I,{message:"Please try again later"})})}export{je as P,Le as a,te as b,Q as c,F as d,_ as e,D as i,Ie as p,ee as u};
