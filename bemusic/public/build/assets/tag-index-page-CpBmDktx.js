import{r as d,a6 as x,j as e,as as B,V as T,T as s,Q as M,z as S,G as j,ag as C,I as w,J as l,aa as y,aq as F,b as h,$ as f,M as v,a0 as P,a1 as I,a2 as E,t as c,d1 as k,ab as _,D as p,W as K,H as U}from"./main-CUJEGI8U.js";import{F as V,d as L,u as G,a as R,G as W,D as $,b as z,c as O}from"./use-datatable-query-D9uebfzx.js";import{D as J}from"./datatable-filters-DFYg3QEK.js";import{a as X,D as Y,b as Z,c as ee}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as ae}from"./table-CgoYghfp.js";import{F as te}from"./formatted-date-DzIPJwiH.js";import{E as se}from"./Edit-BRVJ8AkN.js";import{C as re}from"./confirmation-dialog-DVMbD2S1.js";import{D as oe}from"./data-table-add-item-button-_qDHIKil.js";import{F as ne}from"./select-Z9R0wV6S.js";import{D as N}from"./dialog-footer-jZcc-BBM.js";import{D as q}from"./paginated-resources-BDxg6DLi.js";import{s as ie}from"./software-engineer-BiXKysY-.js";import{c as me,u as le}from"./timestamp-filters-DydeeDDl.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./use-normalized-models-ClA2DWxP.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-current-date-time-BhbL04rR.js";import"./normalized-model-field-8T9JWy8W.js";import"./skeleton-BmWW5Jc-.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";import"./Add-B3RL66ee.js";import"./combobox-end-adornment-B0xReOuL.js";import"./formatted-number-gsF1qEbc.js";function Q({form:a,onSubmit:t,formId:r}){const{tags:{types:o}}=d.useContext(x),n=a.watch("type"),m=!!o.find(i=>i.name===n&&i.system),u=o.filter(i=>!i.system);return e.jsxs(B,{id:r,form:a,onSubmit:t,children:[e.jsx(T,{name:"name",label:e.jsx(s,{message:"Name"}),description:e.jsx(s,{message:"Unique tag identifier."}),className:"mb-20",required:!0,autoFocus:!0}),e.jsx(T,{name:"display_name",label:e.jsx(s,{message:"Display name"}),description:e.jsx(s,{message:"User friendly tag name."}),className:"mb-20"}),u.length>1&&e.jsx(ne,{label:e.jsx(s,{message:"Type"}),name:"type",selectionMode:"single",disabled:m,children:u.map(i=>e.jsx(M,{value:i.name,children:e.jsx(s,{message:i.name})},i.name))})]})}function de(a){const{trans:t}=S();return j({mutationFn:r=>ce(r),onSuccess:()=>{w(t(l("Tag created"))),y.invalidateQueries({queryKey:q("tags")})},onError:r=>C(r,a)})}function ce(a){return a.name=F(a.name),h.post("tags",a).then(t=>t.data)}function ue(){const{close:a,formId:t}=f(),{tags:{types:r}}=d.useContext(x),o=v({defaultValues:{type:r[0].name}}),n=de(o);return e.jsxs(P,{children:[e.jsx(I,{children:e.jsx(s,{message:"Add new tag"})}),e.jsx(E,{children:e.jsx(Q,{formId:t,form:o,onSubmit:m=>{n.mutate(m,{onSuccess:()=>{a()}})}})}),e.jsxs(N,{children:[e.jsx(c,{onClick:()=>{a()},children:e.jsx(s,{message:"Cancel"})}),e.jsx(c,{form:t,disabled:n.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(s,{message:"Save"})})]})]})}const ge=a=>[{key:"type",label:l("Type"),description:l("Type of the tag"),defaultOperator:L.ne,control:{type:V.Select,defaultValue:a[0].name,options:a.map(t=>({key:t.name,label:l(t.name),value:t.name}))}},me({description:l("Date tag was created")}),le({description:l("Date tag was last updated")})];function pe(a){const{trans:t}=S();return j({mutationFn:r=>xe(r),onSuccess:()=>{w(t(l("Tag updated"))),y.invalidateQueries({queryKey:q("tags")})},onError:r=>C(r,a)})}function xe({id:a,...t}){return t.name&&(t.name=F(t.name)),h.put(`tags/${a}`,t).then(r=>r.data)}function je({tag:a}){const{close:t,formId:r}=f(),o=v({defaultValues:{id:a.id,name:a.name,display_name:a.display_name,type:a.type}}),n=pe(o);return e.jsxs(P,{children:[e.jsx(I,{children:e.jsx(s,{message:"Update “:name“ tag",values:{name:a.name}})}),e.jsx(E,{children:e.jsx(Q,{formId:r,form:o,onSubmit:m=>{n.mutate(m,{onSuccess:()=>{t()}})}})}),e.jsxs(N,{children:[e.jsx(c,{onClick:()=>{t()},children:e.jsx(s,{message:"Cancel"})}),e.jsx(c,{form:r,disabled:n.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(s,{message:"Save"})})]})]})}const ye=[{key:"name",allowsSorting:!0,visibleInMode:"all",width:"flex-3 min-w-200",header:()=>e.jsx(s,{message:"Name"}),body:a=>a.name},{key:"type",allowsSorting:!0,header:()=>e.jsx(s,{message:"Type"}),body:a=>a.type},{key:"display_name",allowsSorting:!0,header:()=>e.jsx(s,{message:"Display name"}),body:a=>a.display_name},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx(te,{date:a.updated_at})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),hideHeader:!0,align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:a=>e.jsxs(p,{type:"modal",children:[e.jsx(K,{size:"md",className:"text-muted",children:e.jsx(se,{})}),e.jsx(je,{tag:a})]})}];function ca(){const[a,t]=d.useState([]),{searchParams:r,sortDescriptor:o,mergeIntoSearchParams:n,setSearchQuery:m,isFiltering:u}=G(_),i=R({...k.tags.index({...r})}),{tags:b}=d.useContext(x),D=d.useMemo(()=>ge(b.types),[b.types]),A=e.jsxs(p,{type:"modal",children:[e.jsx(c,{variant:"flat",color:"danger",children:e.jsx(s,{message:"Delete"})}),e.jsx(he,{selectedIds:a,onDelete:()=>t([])})]}),H=e.jsxs(p,{type:"modal",children:[e.jsx(oe,{children:e.jsx(s,{message:"Add new tag"})}),e.jsx(ue,{})]});return e.jsxs(X,{children:[e.jsx(W,{query:i}),e.jsx(Y,{title:e.jsx(s,{message:"Tags"}),showSidebarToggleButton:!0}),e.jsxs(Z,{children:[e.jsx($,{searchValue:r.query,onSearchChange:m,actions:H,selectedItems:a,selectedActions:A,filters:D}),e.jsx(J,{filters:D}),e.jsxs(ee,{children:[e.jsx(ae,{columns:ye,data:i.items,sortDescriptor:o,onSortChange:n,enableSelection:!0,selectedRows:a,onSelectionChange:t}),i.isEmpty?e.jsx(z,{image:ie,isFiltering:u,title:e.jsx(s,{message:"No tags have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching tags"})}):null,e.jsx(O,{query:i,onPageChange:g=>n({page:g}),onPerPageChange:g=>n({perPage:g})})]})]})]})}function he({selectedIds:a,onDelete:t}){const{close:r}=f(),o=j({mutationFn:()=>h.delete(`tags/${a.join(",")}`),onSuccess:()=>{y.invalidateQueries({queryKey:k.tags.invalidateKey}),t(),r()},onError:n=>U(n)});return e.jsx(re,{isDanger:!0,title:e.jsx(s,{message:"Delete tags"}),body:e.jsx(s,{message:"Are you sure you want to delete selected tags?"}),confirm:e.jsx(s,{message:"Delete"}),isLoading:o.isPending,onConfirm:()=>{o.mutate()}})}export{ca as Component};
