var j=Object.defineProperty;var K=(n,e,l)=>e in n?j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l;var $=(n,e,l)=>K(n,typeof e!="symbol"?e+"":e,l);import{m as P,c6 as G,bt as J,bL as X,s as Y,r as w,j as Z}from"./main-CUJEGI8U.js";import{a as z}from"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import{s as ee}from"./middleware-BLXTWOs6.js";import{u as re}from"./traditional-BcYcLesO.js";const E=typeof window<"u";var W;const ne=E?(W=window.navigator)==null?void 0:W.userAgent.toLowerCase():"",Te=/iphone|ipad|ipod|ios|CriOS|FxiOS/.test(ne);var _;const g=E&&/(iPhone|iPod)/gi.test((_=window.navigator)==null?void 0:_.platform);function te(n,e){var l;["input","textarea"].includes((l=n.target)==null?void 0:l.tagName.toLowerCase())||((n.key===" "||n.key==="k")&&(n.preventDefault(),e().isPlaying?e().pause():e().play()),n.key==="ArrowLeft"&&(n.preventDefault(),z(n)?e().playPrevious():e().seek(e().getCurrentTime()-10)),n.key==="ArrowRight"&&(n.preventDefault(),z(n)?e().playNext():e().seek(e().getCurrentTime()+10)))}function ie(n){const e=()=>n().cuedMedia&&n().shuffledQueue.findIndex(p=>{var f;return p.id===((f=n().cuedMedia)==null?void 0:f.id)})||0;return{getPointer:e,getCurrent:()=>n().shuffledQueue[e()],getFirst:()=>n().shuffledQueue[0],getLast:()=>n().shuffledQueue[n().shuffledQueue.length-1],getNext:()=>n().shuffledQueue[e()+1],getPrevious:()=>n().shuffledQueue[e()-1],isLast:()=>e()===n().originalQueue.length-1}}class ue{constructor(){$(this,"currentLock")}async lock(e="landscape"){if(!(!this.canOrientScreen()||this.currentLock))try{await screen.orientation.lock(e),this.currentLock=e}catch{}}async unlock(){!this.canOrientScreen()||!this.currentLock||await screen.orientation.unlock()}canOrientScreen(){return screen.orientation!=null&&!!screen.orientation.lock&&!!screen.orientation.unlock}}var v={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},D=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],H=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],U=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],y=typeof window<"u"&&typeof window.document<"u"?window.document:{},m="fullscreenEnabled"in y&&Object.keys(v)||D[0]in y&&D||H[0]in y&&H||U[0]in y&&U||[],b={requestFullscreen:function(n){return n[m[v.requestFullscreen]]()},requestFullscreenFunction:function(n){return n[m[v.requestFullscreen]]},get exitFullscreen(){return y[m[v.exitFullscreen]].bind(y)},get fullscreenPseudoClass(){return":"+m[v.fullscreen]},addEventListener:function(n,e,l){return y.addEventListener(m[v[n]],e,l)},removeEventListener:function(n,e,l){return y.removeEventListener(m[v[n]],e,l)},get fullscreenEnabled(){return!!y[m[v.fullscreenEnabled]]},set fullscreenEnabled(n){},get fullscreenElement(){return y[m[v.fullscreenElement]]},set fullscreenElement(n){},get onfullscreenchange(){return y[("on"+m[v.fullscreenchange]).toLowerCase()]},set onfullscreenchange(n){return y[("on"+m[v.fullscreenchange]).toLowerCase()]=n},get onfullscreenerror(){return y[("on"+m[v.fullscreenerror]).toLowerCase()]},set onfullscreenerror(n){return y[("on"+m[v.fullscreenerror]).toLowerCase()]=n}};function le(n,e){return n=n.closest(".fullscreen-host")??n,{isFullscreen:()=>{if(b.fullscreenElement===n)return!0;try{return n.matches(b.fullscreenPseudoClass)}catch{return!1}},canFullScreen:()=>b.fullscreenEnabled,enter:()=>b.requestFullscreen(n),exit:()=>b.exitFullscreen(),bindEvents:()=>{b.addEventListener("fullscreenchange",e),b.addEventListener("fullscreenerror",e)},unbindEvents:()=>{b.removeEventListener("fullscreenchange",e),b.removeEventListener("fullscreenerror",e)}}}function ae(n,e){return{isFullscreen:()=>n.webkitPresentationMode==="fullscreen",canFullScreen:()=>g&&typeof n.webkitSetPresentationMode=="function"&&(n.webkitSupportsFullscreen??!1),enter:()=>{var l;return(l=n.webkitSetPresentationMode)==null?void 0:l.call(n,"fullscreen")},exit:()=>{var l;return(l=n.webkitSetPresentationMode)==null?void 0:l.call(n,"inline")},bindEvents:()=>{n.removeEventListener("webkitpresentationmodechanged",e)},unbindEvents:()=>{n.addEventListener("webkitpresentationmodechanged",e)}}}const se=["youtube"],ce=(n,e)=>{let l;const s=new ue;let u;const t=async()=>{const c=u==null?void 0:u.isFullscreen();c?s.lock():s.unlock(),n({isFullscreen:c})},o=()=>g&&se.includes(e().providerName)?!1:(u==null?void 0:u.canFullScreen())??!1;return{isFullscreen:!1,canFullscreen:!1,enterFullscreen:()=>{if(!(!o()||u!=null&&u.isFullscreen()))return e().isPip&&e().exitPip(),u==null?void 0:u.enter()},exitFullscreen:()=>{if(u!=null&&u.isFullscreen())return u.exit()},toggleFullscreen:()=>{e().isFullscreen?e().exitFullscreen():e().enterFullscreen()},initFullscreen:()=>{l=e().subscribe({providerReady:({el:c})=>{u==null||u.unbindEvents(),e().isFullscreen&&(u==null||u.exit()),u=g?ae(c,t):le(c,t);const p=o();n({canFullscreen:p}),p&&u.bindEvents()}})},destroyFullscreen:()=>{e().exitFullscreen(),l==null||l()}}},oe=(n,e)=>({isSupported:()=>x(),isPip:()=>n===document.pictureInPictureElement,enter:()=>{if(x())return n.requestPictureInPicture()},exit:()=>{if(x())return document.exitPictureInPicture()},bindEvents:()=>{x()&&(n.addEventListener("enterpictureinpicture",e),n.addEventListener("leavepictureinpicture",e))},unbindEvents:()=>{x()&&(n.removeEventListener("enterpictureinpicture",e),n.removeEventListener("leavepictureinpicture",e))}});let C;const x=()=>{if(!E)return!1;if(C==null){const n=document.createElement("video");C=!!document.pictureInPictureEnabled&&!n.disablePictureInPicture}return C},de=(n,e)=>({isSupported:()=>F(),isPip:()=>n.webkitPresentationMode==="picture-in-picture",enter:()=>{var l;if(F())return(l=n.webkitSetPresentationMode)==null?void 0:l.call(n,"picture-in-picture")},exit:()=>{var l;if(F())return(l=n.webkitSetPresentationMode)==null?void 0:l.call(n,"inline")},bindEvents:()=>{F()&&n.addEventListener("webkitpresentationmodechanged",e)},unbindEvents:()=>{F()&&n.removeEventListener("webkitpresentationmodechanged",e)}});let h;const F=()=>{if(!E)return!1;const n=document.createElement("video");return h==null&&(h=!!n.webkitSupportsPresentationMode&&!!n.webkitSetPresentationMode&&!g),h},fe=[oe,de],pe=(n,e)=>{let l,s=[];const u=()=>{n({isPip:s.some(o=>o.isPip())})},t=()=>e().providerName!=="htmlVideo"?!1:s.some(o=>o.isSupported());return{isPip:!1,canPip:!1,enterPip:async()=>{var o;e().isPip||!t()||await((o=s.find(c=>c.isSupported()))==null?void 0:o.enter())},exitPip:async()=>{var o;e().isPip&&await((o=s.find(c=>c.isSupported()))==null?void 0:o.exit())},togglePip:()=>{e().isPip?e().exitPip():e().enterPip()},initPip:()=>{l=e().subscribe({providerReady:({el:o})=>{s.every(p=>p.unbindEvents()),e().isPip&&s.every(p=>p.exit()),s=fe.map(p=>p(o,u));const c=t();c&&s.every(p=>p.bindEvents()),n({canPip:c})}})},destroyPip:()=>{e().exitPip(),l==null||l()}}};function ye(n,e){var l;if("mediaSession"in navigator){const s={play:()=>n().play(),pause:()=>n().pause(),previoustrack:()=>n().playPrevious(),nexttrack:()=>n().playNext(),stop:()=>n().stop(),seekbackward:()=>n().seek(n().getCurrentTime()-10),seekforward:()=>n().seek(n().getCurrentTime()+10),seekto:t=>n().seek(t.seekTime||0)};for(const t in s)try{navigator.mediaSession.setActionHandler(t,s[t])}catch{}const u=n().cuedMedia;u&&((l=e.setMediaSessionMetadata)==null||l.call(e,u))}}function M(n,e){return!n||!e?!1:n.id===e.id&&n.groupId===e.groupId}function ke(n,e){const l=(e==null?void 0:e.defaultVolume)||30;return{state:{muted:P(`player.${n}.muted`)??!1,repeat:P(`player.${n}.repeat`)??"all",shuffling:P(`player.${n}.shuffling`)??!1,volume:P(`player.${n}.volume`)??l},queue:P(`player.${n}.queue`,[]),cuedMediaId:P(`player.${n}.cuedMediaId`)}}function ve(){"mediaSession"in navigator&&(["play","pause","previoustrack","nexttrack","stop","seekbackward","seekforward","seekto"].forEach(e=>navigator.mediaSession.setActionHandler(e,null)),navigator.mediaSession.metadata=null,navigator.mediaSession.playbackState="none")}function B(n,e,l=0){const s=[...n],u=s.splice(l+1);return[...s,...e,...u]}function T(n,e=!1){const l=e?n.shift():null;let s=n.length,u,t;for(;s!==0;)t=Math.floor(Math.random()*s),s-=1,u=n[s],n[s]=n[t],n[t]=u;return l&&n.unshift(l),[...n]}const me=(n,e)=>{const l=G(ke(n,e),e.initialData||{}),s=(u,t)=>{Y(`player.${n}.${u}`,t)};return J()(ee(X((u,t,o)=>{var A,R,N,V,q;const c=new Set,p={play:()=>{u(r=>{r.isPlaying=!0,r.playbackStarted=!0})},pause:()=>{u(r=>{r.isPlaying=!1,r.controlsVisible=!0})},error:r=>{u(i=>{r!=null&&r.fatal&&(i.isPlaying=!1)})},durationChange:r=>{u({mediaDuration:r.duration})},streamTypeChange:r=>{u({streamType:r.streamType})},buffered:r=>{},playbackRateChange:r=>{u({playbackRate:r.rate})},playbackRates:({rates:r})=>{u({playbackRates:r})},playbackQualities:({qualities:r})=>{u({playbackQualities:r})},audioTracks:({tracks:r})=>{u({audioTracks:r})},currentAudioTrackChange:({trackId:r})=>{u({currentAudioTrack:r})},playbackQualityChange:({quality:r})=>{u({playbackQuality:r})},textTracks:({tracks:r})=>{u({textTracks:r})},currentTextTrackChange:({trackId:r})=>{u({currentTextTrack:r})},textTrackVisibilityChange:({isVisible:r})=>{u({textTrackIsVisible:r})},buffering:({isBuffering:r})=>{u({isBuffering:r})},playbackEnd:async()=>{const r=t().cuedMedia;if(!t().isSeeking){if(f.isLast()&&e.loadMoreMediaItems){const i=await e.loadMoreMediaItems(r);i!=null&&i.length&&t().appendToQueue(i)}t().playNext()}},posterLoaded:({url:r})=>{u({posterUrl:r})},providerReady:()=>{const r=t().providerApi;r&&(r.setVolume(t().volume),r.setMuted(t().muted),e.autoPlay&&r.play(),u({providerReady:!0}))}},f=ie(t),I=r=>{te(r,t)},Q=l.queue||[];return{options:e,...ce(u,t),...pe(u,t),originalQueue:Q,shuffledQueue:(A=l.state)!=null&&A.shuffling?T(Q):Q,isPlaying:!1,isBuffering:!1,streamType:null,playbackStarted:!1,providerReady:!1,pauseWhileSeeking:e.pauseWhileSeeking??!0,isSeeking:!1,setIsSeeking:r=>{u({isSeeking:r})},controlsVisible:!0,setControlsVisible:r=>{u(i=>{i.controlsVisible=r})},volume:((R=l.state)==null?void 0:R.volume)??30,setVolume:r=>{var i;(i=t().providerApi)==null||i.setVolume(r),u(a=>{a.volume=r}),s("volume",r)},muted:((N=l.state)==null?void 0:N.muted)??!1,setMuted:r=>{var i;(i=t().providerApi)==null||i.setMuted(r),u(a=>{a.muted=r}),s("muted",r)},playbackRates:[],playbackRate:1,setPlaybackRate:r=>{var i;(i=t().providerApi)==null||i.setPlaybackRate(r)},playbackQuality:"auto",setPlaybackQuality:r=>{var i,a;(a=(i=t().providerApi)==null?void 0:i.setPlaybackQuality)==null||a.call(i,r)},playbackQualities:[],repeat:((V=l.state)==null?void 0:V.repeat)??"all",toggleRepeatMode:()=>{let r="all";const i=t().repeat;i==="all"?r="one":i==="one"&&(r=!1),u({repeat:r}),s("repeat",r)},shuffling:((q=l.state)==null?void 0:q.shuffling)??!1,toggleShuffling:()=>{let r=[];t().shuffling?r=t().originalQueue:r=T([...t().shuffledQueue]),u(i=>{i.shuffling=!i.shuffling,i.shuffledQueue=r})},mediaDuration:0,seek:r=>{var a;const i=`${r}`;i.startsWith("+")?r=t().getCurrentTime()+Number(r):i.startsWith("-")?r=t().getCurrentTime()-Number(i.replace("-","")):r=Number(r),(a=t().providerApi)==null||a.seek(r),t().emit("seek",{time:r})},getCurrentTime:()=>{var r;return((r=t().providerApi)==null?void 0:r.getCurrentTime())||0},play:async r=>{var i,a;if(r?await t().cue(r):r=t().cuedMedia||f.getCurrent(),!r){t().stop();return}await((i=e.onBeforePlay)==null?void 0:i.call(e)),await((a=t().providerApi)==null?void 0:a.play())},pause:()=>{var r;(r=t().providerApi)==null||r.pause()},stop:()=>{t().isPlaying&&(t().pause(),t().seek(0))},playNext:async()=>{var i;t().stop();let r=f.getCurrent();if(f.isLast()&&e.loadMoreMediaItems){const a=await e.loadMoreMediaItems(r);a!=null&&a.length&&t().appendToQueue(a)}t().repeat==="all"&&f.isLast()?r=f.getFirst():t().repeat!=="one"&&(r=f.getNext()),t().repeat==="one"&&t().providerName==="youtube"&&await new Promise(a=>setTimeout(a,50)),!((i=e.onBeforePlayNext)!=null&&i.call(e,r))&&(r?await t().play(r):(t().seek(0),t().play()))},playPrevious:async()=>{var i;t().stop();let r=f.getCurrent();t().repeat==="all"&&f.getPointer()===0?r=f.getLast():t().repeat!=="one"&&(r=f.getPrevious()),!((i=e.onBeforePlayPrevious)!=null&&i.call(e,r))&&(r?await t().play(r):(t().seek(0),t().play()))},cue:async r=>{if(!M(r,t().cuedMedia))return t().emit("beforeCued",{previous:t().cuedMedia}),new Promise((i,a)=>{var O;const d=t().providerName,k=setTimeout(()=>{S(),i()},3e3),S=t().subscribe({cued:()=>{clearTimeout(k),S(),i()},error:be=>{clearTimeout(k),S(),a("Could not cue media")}});u({cuedMedia:r,posterUrl:r.poster,providerName:r.provider,providerReady:d===r.provider,streamType:"streamType"in r?r.streamType:null}),r&&((O=e.setMediaSessionMetadata)==null||O.call(e,r)),e.persistQueueInLocalStorage&&s("cuedMediaId",r.id)})},async overrideQueue(r,i=0){if(!(r!=null&&r.length))return;const a=[...r];u(k=>{k.shuffledQueue=t().shuffling?T(a,!0):a,k.originalQueue=a}),e.persistQueueInLocalStorage&&s("queue",t().originalQueue.slice(0,15));const d=i>-1?r[i]:f.getCurrent();if(d)return t().cue(d)},appendToQueue:(r,i=!0)=>{const a=t().shuffling?T([...r]):[...r],d=i?f.getPointer():0;u(k=>{k.shuffledQueue=B(k.shuffledQueue,a,d),k.originalQueue=B(k.originalQueue,r,d)}),e.persistQueueInLocalStorage&&s("queue",t().originalQueue.slice(0,15))},removeFromQueue:r=>{u(i=>{i.shuffledQueue=i.shuffledQueue.filter(a=>!r.find(d=>M(d,a))),i.originalQueue=i.originalQueue.filter(a=>!r.find(d=>M(d,a)))}),e.persistQueueInLocalStorage&&s("queue",t().originalQueue.slice(0,15))},textTracks:[],currentTextTrack:-1,setCurrentTextTrack:r=>{var i,a;(a=(i=t().providerApi)==null?void 0:i.setCurrentTextTrack)==null||a.call(i,r)},textTrackIsVisible:!1,setTextTrackVisibility:r=>{var i,a;(a=(i=t().providerApi)==null?void 0:i.setTextTrackVisibility)==null||a.call(i,r)},audioTracks:[],currentAudioTrack:-1,setCurrentAudioTrack:r=>{var i,a;(a=(i=t().providerApi)==null?void 0:i.setCurrentAudioTrack)==null||a.call(i,r)},destroy:()=>{var r;t().destroyFullscreen(),t().destroyPip(),(r=e==null?void 0:e.onDestroy)==null||r.call(e),ve(),c.clear(),document.removeEventListener("keydown",I)},init:async()=>{var a,d,k;t().initFullscreen(),c.add(p),e.listeners&&c.add(e.listeners);const r=l.cuedMediaId||((d=(a=l.queue)==null?void 0:a[0])==null?void 0:d.id),i=(k=l.queue)==null?void 0:k.find(S=>S.id===r);i&&await t().cue(i),ye(t,e),document.addEventListener("keydown",I)},subscribe:r=>(c.add(r),()=>c.delete(r)),emit(r,i){c.forEach(a=>{var d;return(d=a[r])==null?void 0:d.call(a,{state:t(),...i})})}}})))},L=w.createContext(null);function ge({children:n,id:e,options:l}){const[s]=w.useState(()=>me(e,l));return Z.jsx(L.Provider,{value:s,children:n})}function Ee(){const n=w.use(L);return w.useMemo(()=>{const e=n.getState(),l=async(s,u)=>(e.stop(),await e.overrideQueue(s,u),e.play());return{play:e.play,playNext:e.playNext,playPrevious:e.playPrevious,pause:e.pause,subscribe:e.subscribe,emit:e.emit,getCurrentTime:e.getCurrentTime,seek:e.seek,toggleRepeatMode:e.toggleRepeatMode,toggleShuffling:e.toggleShuffling,getState:n.getState,setVolume:e.setVolume,setMuted:e.setMuted,appendToQueue:e.appendToQueue,removeFromQueue:e.removeFromQueue,enterFullscreen:e.enterFullscreen,exitFullscreen:e.exitFullscreen,toggleFullscreen:e.toggleFullscreen,enterPip:e.enterPip,exitPip:e.exitPip,setTextTrackVisibility:e.setTextTrackVisibility,setCurrentTextTrack:e.setCurrentTextTrack,setCurrentAudioTrack:e.setCurrentAudioTrack,setIsSeeking:e.setIsSeeking,setControlsVisible:e.setControlsVisible,cue:e.cue,overrideQueueAndPlay:l,overrideQueue:e.overrideQueue,setPlaybackRate:e.setPlaybackRate,setPlaybackQuality:e.setPlaybackQuality}},[n])}const Qe=(n,e)=>{const l=w.useContext(L);return re(l,n,e)};export{Te as I,ge as P,L as a,Ee as b,b as f,Qe as u};
