import{bK as X,aF as Y,cs as Z,aa as v,b as L,c as ee,j as t,d as V,r as f,W as se,t as g,T as u,G as ae,H as te,I as R,J as _,at as q,ct as K,a as ie,e as ne,$ as j,o as le,ac as F,q as oe,a0 as U,a2 as H,A as re,v as de,a1 as ce,ar as z,av as ue}from"./main-CUJEGI8U.js";import{o as b,a as h,b as I,d as fe}from"./offline-media-items-Dlxt2ETB.js";import{P as me}from"./play-arrow-filled-BrHo1wfG.js";import{I as pe,u as O,b as ye}from"./use-player-store-BWFGgN3k.js";import{P as xe}from"./Pause-B4fj-x54.js";import{C as he}from"./create-playlist-dialog-DeyZkjsM.js";import{u as Ie}from"./use-auth-click-capture-B9wu-BP4.js";import{A as be}from"./Add-B3RL66ee.js";import{K as we}from"./KeyboardArrowRight-CjTKdvdU.js";import{K as ge}from"./FavoriteBorder-D1CUmnAo.js";import{u as je}from"./use-previous-BgqS7ski.js";import{A as Pe}from"./album-image-CkUJpPZs.js";import{g as Te}from"./album-link-DwfnHHp7.js";import{S as ve}from"./small-artist-image-BqXmK0zy.js";import{g as ke}from"./artist-link-XkkvBaYk.js";import{P as Ae}from"./playlist-image-zogte8rn.js";import{g as Se}from"./playlist-link-CLw6NzkW.js";import{S as Ce}from"./share-media-buttons-DtF-m4-I.js";import{T as Me}from"./track-image-B3DSRXTB.js";import{g as Qe}from"./track-link-D8mIwI0F.js";import{D as Oe}from"./dialog-footer-jZcc-BBM.js";import{T as Be,a as Ne,b as B}from"./tabs-BVjOaE7L.js";import{T as Ee,a as N}from"./tab-panels-BNEb_18b.js";import{u as $e}from"./use-clipboard-CQvDhy4G.js";let E=!1;const W=X()((e,a)=>({offlineToastVisible:!1,offlinedTrackIds:new Set,offlinedPlaylistIds:new Set,offlinedAlbumIds:new Set,offlineQueue:new Set,init:async()=>{if(!E){h.listen("onItemUpdated",s=>{if(!a().offlineQueue.has(s.id)){const i=new Set(a().offlineQueue).add(s.id);e({offlineQueue:i})}}),h.listen("onItemDeleted",s=>{const i=new Set(a().offlineQueue);i.delete(s.id),e({offlineQueue:i,offlineToastVisible:i.size===0?!1:a().offlineToastVisible})}),b.listen("onItemUpdated",s=>{if(!a().offlinedTrackIds.has(s.id)&&s.isDownloaded){const i=new Set(a().offlinedTrackIds);i.add(s.id),e({offlinedTrackIds:i})}}),b.listen("onItemDeleted",s=>{if(a().offlinedTrackIds.has(s.id)){const i=new Set(a().offlinedTrackIds);i.delete(s.id),e({offlinedTrackIds:i})}}),I.listen("onItemUpdated",s=>{if(s.type==="playlist"){if(!a().offlinedPlaylistIds.has(s.id)){const i=new Set(a().offlinedPlaylistIds);i.add(s.id),e({offlinedPlaylistIds:i})}}else if(!a().offlinedAlbumIds.has(s.id)){const i=new Set(a().offlinedAlbumIds);i.add(s.id),e({offlinedAlbumIds:i})}}),I.listen("onItemDeleted",s=>{if(s.type==="playlist"){if(a().offlinedPlaylistIds.has(s.id)){const i=new Set(a().offlinedPlaylistIds);i.delete(s.id),e({offlinedPlaylistIds:i})}}else if(a().offlinedAlbumIds.has(s.id)){const i=new Set(a().offlinedAlbumIds);i.delete(s.id),e({offlinedAlbumIds:i})}});try{const s=await b.getAllTrackIds({downloadedOnly:!0}),i=await I.getAllPlaylistIds(),l=await I.getAllAlbumIds(),n=await h.getQueuedTracks();h.runQueue(),e({offlinedTrackIds:new Set(s),offlinedPlaylistIds:new Set(i),offlinedAlbumIds:new Set(l),offlineToastVisible:n.length>0,offlineQueue:new Set(n.map(d=>d.id))})}catch{}E=!0}},setOfflineToastVisible:s=>{e({offlineToastVisible:s})},offlineMediaItem:async s=>{I.addItem(s),e({offlineToastVisible:!0})},deleteOfflinedMediaItem:async s=>{await I.delete(s),(await h.getQueuedTracks()).length||e({offlineToastVisible:!1})},offlineTracks:async(s,i)=>{h.addTracks(s,i),e({offlineToastVisible:!0})},deleteOfflinedTracks:async(s,i)=>{for(const n of s)b.deleteTrack(n.id,i).catch();(await h.getQueuedTracks()).length||e({offlineToastVisible:!1})},isTrackOfflined:s=>a().offlinedTrackIds.has(s)})),k=W.getState;var D;(D=Y().settings.player)!=null&&D.enable_offlining&&W.getState().init();function As(e,a="*",s){let i=`${e.model_type}.${e.id}.${a}`;return s!=null&&s.orderBy&&(s!=null&&s.orderDir)&&(i+=`.${s.orderBy.replace(".","^")}|${s.orderDir}`),i}function De(e){const[a,s,i,l]=e.split(".");if(!a||!s||!i)return{};let n;if(l){const[d,o]=l.split("|");n={orderBy:d,orderDir:o}}return{modelType:a,modelId:+s,kind:i,sortDescriptor:n}}async function Le(e,a,s=30){if(!Z.isOnline()){const{modelType:l,modelId:n}=De(e);if(n&&(l==="album"&&k().offlinedAlbumIds.has(n)||l==="playlist"&&k().offlinedPlaylistIds.has(n)))return(await b.getTracksOfflinedBy({id:n,model_type:l})).map(d=>d.data)}const i={queryKey:["player/tracks",{queueId:e,trackId:a==null?void 0:a.id,perPage:s}],queryFn:async()=>L.post("player/tracks",{queueId:e,lastTrack:a,perPage:s}).then(l=>l.data),staleTime:1/0};try{const l=v.getQueryData(i.queryKey)??await v.fetchQuery(i);return(l==null?void 0:l.tracks)||[]}catch{return[]}}const Ve=/\.(m3u8)($|\?)/i,Re=/\.(mpd)($|\?)/i,_e=/\.(m4a|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx|flac)($|\?)/i,qe=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/,Ke=/^((?:\w|-){11})$/;function Fe(e){return qe.test(e)||Ke.test(e)?"youtube":_e.test(e)?"htmlAudio":Ve.test(e)?pe?"htmlVideo":"hls":Re.test(e)?"dash":"htmlVideo"}async function Ue(e,a){const s=e.src?Fe(e.src):"youtube";if(k().isTrackOfflined(e.id)){const i=await fe.getByTrackId(e.id);if(i)return{id:e.id,provider:"htmlAudio",src:`stream/offlined-media/${e.id}.${i.extension}`,meta:e,poster:e.image,groupId:a}}return!e.src||s==="youtube"?{id:e.id,provider:"youtube",meta:e,src:e.src?e.src:"resolve",groupId:a}:{id:e.id,src:e.src,provider:s,meta:e,poster:e.image,groupId:a}}async function He(e,a,s){return Promise.all(e.map(i=>(s&&!i.album&&(i={...i,album:{...s}},delete i.album.tracks),Ue(i,a))))}const ze=""+new URL("equalizer-white-Bwp1kg-f.gif",import.meta.url).href,We=""+new URL("equalizer-black-BL5Bv7xE.gif",import.meta.url).href;function Ge({className:e,color:a}){const s=ee();return a||(a=s?"white":"black"),t.jsx("div",{className:V("flex h-20 w-20 items-center justify-center",e),children:t.jsx("img",{src:a==="white"?ze:We,alt:"",className:"h-12 w-12","aria-hidden":!0})})}function Ss({queueId:e,track:a,tracks:s,radius:i,variant:l,color:n,disabled:d,className:o,buttonType:r,equalizerColor:p=r==="text"?"white":"black",size:m}){const[y,x]=f.useState(!1),S=O(c=>!!(c.cuedMedia&&e&&c.cuedMedia.groupId===e||c.cuedMedia&&a&&c.cuedMedia.meta.id===a.id)),P=O(c=>c.isPlaying)&&S,T=ye(),C=P?y?t.jsx(xe,{}):t.jsx(Ge,{color:p}):t.jsx(me,{}),M={disabled:d,onPointerEnter:()=>{x(!0)},onPointerLeave:()=>{x(!1)},onClick:async()=>{if(P)T.pause();else if(S)await T.play();else{let c=[],Q=0;s?(c=[...s],Q=a?s.findIndex(J=>J.id===a.id):0):a?c=[a]:e&&(c=await Le(e)),c.length&&await T.overrideQueueAndPlay(await He(c,e),Q)}}};return r==="icon"?t.jsx(se,{...M,variant:l,color:n,radius:i,size:m,className:o,children:C}):t.jsx(g,{...M,variant:l||"flat",color:n||"primary",radius:i||"rounded-full",startIcon:C,size:m,className:o,children:P?t.jsx(u,{message:"Pause"}):t.jsx(u,{message:"Play"})})}function Je(){return ae({mutationFn:e=>Xe(e),onSuccess:(e,{tracks:a})=>{R(_("Added [one 1 track|other :count tracks] to playlist",{values:{count:a.length}})),v.invalidateQueries({queryKey:q.playlists.show(e.playlist.id).invalidateKey})},onError:e=>te(e)})}function Xe(e){const a={ids:e.tracks.map(s=>s.id)};return L.post(`playlists/${e.playlistId}/tracks/add`,a).then(s=>s.data)}function Ye(){const{data:e}=ie(q.playlists.compactAuthUserPlaylists()),{user:a}=ne(),{close:s}=j(),{loadTracks:i,setPlaylistPanelIsActive:l}=f.useContext(A),n=Je(),d=f.useMemo(()=>e.filter(o=>o.owner_id===(a==null?void 0:a.id)||o.collaborative),[e,a]);return t.jsxs(le.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"-100%",opacity:0},transition:{type:"tween",duration:.14},children:[t.jsx("div",{className:"my-10 border-b px-10 pb-10",children:t.jsx(g,{startIcon:t.jsx(ge,{}),onClick:()=>l(!1),children:t.jsx(u,{message:"Back"})})}),t.jsxs("ul",{className:"max-h-350 overflow-y-auto overflow-x-hidden",children:[t.jsx(w,{startIcon:t.jsx(be,{}),onClick:async()=>{s();const[o,r]=await Promise.all([F(he),i()]);r.length&&o&&n.mutate({playlistId:o.id,tracks:r})},className:"text-primary",children:t.jsx(u,{message:"New playlist"})}),d.map(o=>t.jsx(w,{onClick:async()=>{s();const r=await i();r!=null&&r.length&&!n.isPending?n.mutate({playlistId:o.id,tracks:r}):R(_("This item does not have tracks yet"))},children:o.name},o.id))]})]})}function Cs(){const e=Ie(),{playlistPanelIsActive:a,setPlaylistPanelIsActive:s}=f.useContext(A),i=K();return t.jsx(w,{disabled:i,endIcon:t.jsx(we,{}),onClickCapture:e,onClick:()=>{s(!a)},children:t.jsx(u,{message:"Add to playlist"})})}const A=f.createContext(null);function Ms({image:e,title:a,description:s,children:i,loadTracks:l}){const[n,d]=f.useState(!1),{close:o}=j(),r=f.useMemo(()=>({playlistPanelIsActive:n,setPlaylistPanelIsActive:d,loadTracks:l}),[n,l]),{pathname:p}=oe(),m=je(p);f.useEffect(()=>{m&&m!==p&&o()},[p,m,o]);const y=e||a?t.jsxs("div",{className:"mb-10 flex items-center gap-14 border-b p-14",children:[e&&f.cloneElement(e,{className:"w-44 h-44 rounded"}),t.jsxs("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:[a,s&&t.jsx("div",{className:"text-xs text-muted",children:s})]})]}):null;return t.jsx(A.Provider,{value:r,children:t.jsx(U,{size:"xs",children:t.jsx(H,{padding:"p-0",onContextMenu:x=>{x.preventDefault(),x.stopPropagation()},children:t.jsxs("div",{className:"pb-10",children:[y,t.jsx(re,{initial:!1,mode:"wait",children:n?t.jsx(Ye,{},"playlist-panel"):t.jsx("ul",{className:"text-base md:text-sm",children:i},"menu")})]})})})})}const w=f.forwardRef(({children:e,endIcon:a,startIcon:s,className:i,type:l="button",to:n,disabled:d,enableWhileOffline:o=!1,...r},p)=>{const m=K(),y=d||m&&!o,x=l==="button"||y?"button":de;return t.jsx("li",{children:t.jsxs(x,{...r,disabled:y,to:y?void 0:n,ref:p,className:V("flex w-full cursor-pointer items-center gap-12 px-20 py-12 text-left outline-none hover:bg-hover focus-visible:ring focus-visible:ring-inset disabled:pointer-events-none disabled:opacity-50",i),children:[s,t.jsx("span",{className:"mr-auto min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e}),a]})})});function Ze({item:e}){const{close:a}=j();return t.jsxs(U,{size:"xl",children:[t.jsx(ce,{children:t.jsx(u,{message:"Share :name",values:{name:e.name}})}),t.jsx(H,{children:e.model_type==="artist"||e.model_type==="playlist"?t.jsx($,{item:e}):t.jsxs(Be,{children:[t.jsxs(Ne,{children:[t.jsx(B,{children:t.jsx(u,{message:"Share"})}),t.jsx(B,{children:t.jsx(u,{message:"Embed"})})]}),t.jsxs(Ee,{className:"pt-20",children:[t.jsx(N,{children:t.jsx($,{item:e})}),t.jsx(N,{children:t.jsx(es,{item:e})})]})]})}),t.jsx(Oe,{children:t.jsx(g,{onClick:()=>a(),children:t.jsx(u,{message:"Close"})})})]})}function es({item:e}){const a=ue(),s=`${G(e)}/embed`,i=e.model_type==="track"?174:384,l=`<iframe width="100%" height="${i}" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" src="${s}"></iframe>`;return t.jsxs("div",{children:[!a&&t.jsx("iframe",{src:s,width:"100%",height:i,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0}),t.jsx(z,{className:"mt-20",inputElementType:"textarea",readOnly:!0,value:l,rows:3,onClick:n=>{n.currentTarget.focus(),n.currentTarget.select()}})]})}function $({item:e}){const a=G(e),s=f.useRef(null),[i,l]=$e(a,{successDuration:600});return t.jsxs("div",{className:"flex items-center gap-14",children:[t.jsx(ss,{item:e,size:"w-128 h-128",className:"flex-shrink-0 rounded object-cover max-md:hidden"}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:"mb-8 text-xl",children:e.name}),t.jsx(z,{className:"mb-8",inputRef:s,readOnly:!0,onClick:n=>{n.currentTarget.focus(),n.currentTarget.select()},value:a,endAppend:t.jsx(g,{variant:"flat",color:"primary",onClick:()=>{var n;(n=s.current)==null||n.select(),l()},children:i?t.jsx(u,{message:"Copied!"}):t.jsx(u,{message:"Copy"})})}),t.jsx(Ce,{link:a,image:"image"in e?e.image:e.image_small,name:e.name})]})]})}function ss({item:e,className:a,size:s}){switch(e.model_type){case"artist":return t.jsx(ve,{size:s,className:a,wrapperClassName:"max-md:hidden",artist:e});case"album":return t.jsx(Pe,{size:s,className:a,album:e});case"track":return t.jsx(Me,{size:s,className:a,track:e});case"playlist":return t.jsx(Ae,{size:s,className:a,playlist:e})}}function G(e){switch(e.model_type){case"artist":return ke(e,{absolute:!0});case"album":return Te(e,{absolute:!0});case"track":return Qe(e,{absolute:!0});case"playlist":return Se(e,{absolute:!0})}}function Qs({item:e}){const{close:a}=j();return t.jsx(w,{enableWhileOffline:!0,onClick:()=>{a(),F(Ze,{item:e})},children:t.jsx(u,{message:"Share"})})}export{Ms as C,Ge as E,Ss as P,Ze as S,He as a,Cs as b,w as c,Qs as d,Le as l,k as o,As as q,Ue as t,W as u};
