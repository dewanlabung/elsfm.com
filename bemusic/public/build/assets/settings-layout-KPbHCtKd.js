import{af as f,r as u,bq as S,br as y,bs as j,j as r,bt as w,G as D,ag as C,I as F,J as A,aa as I,b as M,bu as E,D as P,T as c,d as R,av as T,as as W,t as k,q as B,ae as V,a4 as L,W as N,bv as q,a5 as Q,Q as O,bw as U}from"./main-CUJEGI8U.js";import{D as H}from"./settings-links-6v3CjZ6H.js";import{s as z}from"./middleware-BLXTWOs6.js";import{u as J}from"./use-admin-settings-page-nav-config-C00ols9x.js";import{D as K}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{F as Y}from"./file-upload-provider-DWaB2xE4.js";import{C as G}from"./confirmation-dialog-DVMbD2S1.js";function _(t,n){const s=f(n);return $({filters:{...t,status:"pending"}},s).length}function m(t,n){return t.findAll(n.filters).map(s=>n.select?n.select(s):s.state)}function $(t={},n){const s=f(n).getMutationCache(),i=u.useRef(t),e=u.useRef(null);return e.current===null&&(e.current=m(s,t)),u.useEffect(()=>{i.current=t}),u.useSyncExternalStore(u.useCallback(a=>s.subscribe(()=>{const o=S(e.current,m(s,i.current));e.current!==o&&(e.current=o,y.schedule(a))}),[s]),()=>e.current,()=>e.current)}const g="admin-settings-form",fe="f7fy8bxf0e18",X=({defaultRoute:t,availableRoutes:n})=>w()(z((s,i)=>({isFullScreen:!1,setIsFullScreen:e=>{s({isFullScreen:e})},previewRoute:t??null,availableRoutes:n??{},setPreviewRoute:e=>{s({previewRoute:e??null})},iframeWindow:null,isDirty:!1,setIsDirty:e=>{s(()=>({isDirty:e}))},setIframeWindow:e=>{s({iframeWindow:e}),e&&e.addEventListener("message",a=>{a.data.source==="be-settings-preview"&&a.data.type==="appLoaded"&&b()})},preview:{setValues:(e,a)=>{a.merge=a.merge??!0;const o=i().iframeWindow;d(o,{type:"setValues",values:e,options:a})},setThemeFont:e=>{const a=i().iframeWindow;d(a,{type:"setThemeFont",value:e})},setThemeValue:(e,a)=>{const o=i().iframeWindow;d(o,{type:"setThemeValue",name:e,value:a})},setActiveTheme:e=>{const a=i().iframeWindow;d(a,{type:"setActiveTheme",themeId:e})},setCustomCode:(e,a)=>{const o=i().iframeWindow;d(o,{type:"setCustomCode",mode:e,value:a})},setHighlight:e=>{var l;let a=null;const o=(l=i().iframeWindow)==null?void 0:l.document;o&&e&&(a=o.querySelector(e)),a&&requestAnimationFrame(()=>{a&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}}}))),p=u.createContext(null);function Z({children:t,defaultRoute:n,availableRoutes:s}){const[i]=u.useState(()=>X({defaultRoute:n,availableRoutes:s}));return r.jsx(p.Provider,{value:i,children:t})}function x(t){const n=u.useContext(p);return j(n,t)}let b=()=>{};new Promise(t=>b=t);function d(t,n){t&&t.postMessage({source:"be-settings-editor",...n},"*")}function ee(t){return D({mutationKey:["submitAdminSettings"],mutationFn:n=>te(n),onSuccess:n=>(F(A("Settings updated")),I.setQueryData(["fetchAdminSettings"],n)),onError:n=>C(n,t)})}function te({files:t,...n}){const s=new FormData;Object.entries(t||{}).forEach(([i,e])=>{s.set(i,e)});for(const i in n)s.set(i,JSON.stringify(n[i]));return M.post("settings",s,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>i.data)}function se({shouldBlock:t,allowNavigation:n}){const s=u.useRef(t);s.current=t;const{state:i,reset:e,proceed:a}=E(o=>(typeof s.current=="boolean"?s.current:s.current())&&(!n||!n(o)));return u.useEffect(()=>{const o=l=>{(typeof s.current=="boolean"?s.current:s.current())&&(l.preventDefault(),l.returnValue=!0)};return window.addEventListener("beforeunload",o),()=>window.removeEventListener("beforeunload",o)},[]),r.jsx(P,{type:"modal",isOpen:i==="blocked",onClose:o=>{i==="blocked"&&(o?a():e())},children:r.jsx(G,{isDanger:!0,title:r.jsx(c,{message:"You have unsaved changes"}),body:r.jsx(c,{message:"Your changes will be lost if you continue. Are you sure you want to discard them?"}),close:r.jsx(c,{message:"Stay here"}),confirm:r.jsx(c,{message:"Discard changes"})})})}function ge({title:t,form:n,children:s,padding:i="p-12 md:p-24",tabs:e,docsLink:a}){return r.jsx(Z,{children:r.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel relative flex flex-auto flex-col",children:[r.jsx(ne,{title:t,tabs:e,docsLink:a}),r.jsx("div",{className:"flex-auto overflow-y-auto",children:r.jsx("div",{className:R("mx-auto @container/settings-form lg:max-w-[1440px]",i),children:r.jsx(re,{form:n,children:s})})})]})})}function ne({title:t,className:n,tabs:s,allowNavigation:i,docsLink:e}){const a=x(v=>v.isDirty),o=T(),l=_({mutationKey:["submitAdminSettings"]})>0,h=r.jsx(k,{type:"submit",form:g,variant:"flat",color:"primary",size:"xs",disabled:l||!a,className:"min-w-84",children:o?r.jsx(c,{message:"Save"}):r.jsx(c,{message:"Save changes"})});return r.jsxs(u.Fragment,{children:[r.jsx(K,{className:n,title:t,showSidebarToggleButton:!!o,border:s?"border-none":void 0,rightContent:r.jsxs(u.Fragment,{children:[o&&r.jsx(ae,{}),e?r.jsx(H,{link:e,variant:"button",size:"xs",buttonVariant:o?"icon":"text",children:r.jsx(c,{message:"Learn more"})}):null,h]})}),s,r.jsx(se,{shouldBlock:a,allowNavigation:i})]})}function re({form:t,children:n}){const s=x(e=>e.setIsDirty),i=ee(t);return u.useEffect(()=>(s(t.formState.isDirty),()=>s(!1)),[t.formState.isDirty,s]),r.jsx(Y,{children:r.jsx(W,{id:g,form:t,disableNativeValidation:!0,onBeforeSubmit:()=>{const e=t.formState.errors,a=Object.keys(e).filter(o=>o.endsWith("_group"));t.clearErrors(a)},onSubmit:e=>{i.mutate(e,{onSuccess:()=>{t.reset(e),s(!1)}})},children:n})})}function ae(){const{pathname:t}=B(),n=V(),s=t.split("/").pop(),i=J();return r.jsxs(L,{selectionMode:"single",selectedValue:s,onSelectionChange:e=>{e=U(e)?e:`/admin/settings/${e}`,n(e,{state:{prevPath:t}})},children:[r.jsx(N,{children:r.jsx(q,{})}),r.jsx(Q,{children:i.map(e=>r.jsx(O,{value:e.to,children:r.jsx(c,{...e.label})},e.to))})]})}export{ge as A,se as B,Z as S,ne as a,re as b,fe as s,x as u};
