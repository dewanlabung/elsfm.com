import{j as t,r as m,T as f,c1 as F,cA as M,D as I,t as A,bX as N,a3 as E,G as Q,H as _,aa as $,at as v,b as H,am as G,R as O,cH as L,z,ar as U,ax as K,J as V,ao as J}from"./main-CUJEGI8U.js";import{M as X}from"./media-page-no-results-message--OHhXdwX.js";import{P as W}from"./player-page-header-gradient-B98PHS1w.js";import{P as Y}from"./player-page-suspsense-nQjKTdHX.js";import{u as Z}from"./use-player-page-pagination-params-CqCYHeWu.js";import{A as tt,O as et}from"./avatar-group-DBzfgZws.js";import{B as rt}from"./bullet-separated-items-DSt8aXIS.js";import{M as st,a as P}from"./media-page-header-layout-B2pd5UBI.js";import{P as at,q as T,o as ot}from"./share-media-button-Dw3JV4C-.js";import{F as it,P as nt,u as lt}from"./playlist-context-dialog-DH_eECE6.js";import{P as mt}from"./playlist-image-zogte8rn.js";import{u as pt}from"./update-playlist-dialog-D3q_Y3lO.js";import{I as ct}from"./image-selector-GLpYAkj6.js";import{F as ut}from"./file-upload-provider-DWaB2xE4.js";import{F as dt}from"./formatted-duration-2_MIaPa4.js";import{M as ft}from"./MusicNote-SjrQa4Nt.js";import{b as gt,o as xt}from"./offline-media-items-Dlxt2ETB.js";import{P as yt,T as w}from"./track-table-CY1bAvY-.js";import{u as k}from"./use-required-params-Cp5Jywbp.js";import{a as D}from"./table-CgoYghfp.js";import{D as jt}from"./drag-preview-C1yWSaDk.js";import{u as ht}from"./use-sortable-imA7wH2m.js";import{u as Pt}from"./is-touch-device-CISsFyfT.js";import{V as B}from"./virtual-table-body-DQGnEfcL.js";import{A as b}from"./ad-host-3MKQnMjM.js";import{P as vt}from"./page-meta-tags-CEAowLoU.js";import{u as kt}from"./use-flat-infinite-query-items-3ilhvvhN.js";import{u as bt}from"./useSuspenseQuery-13TuSADp.js";import{u as It}from"./useSuspenseInfiniteQuery-Vh8v-EaZ.js";import"./add-to-queue-menu-button-AYv4MHMe.js";import"./use-player-store-BWFGgN3k.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./middleware-BLXTWOs6.js";import"./traditional-BcYcLesO.js";import"./check-circle-filled-BwqtgJPU.js";import"./Download-rbsKggzM.js";import"./play-arrow-filled-BrHo1wfG.js";import"./Pause-B4fj-x54.js";import"./create-playlist-dialog-DeyZkjsM.js";import"./switch-4KDjemPX.js";import"./Image-DWFqsH18.js";import"./dialog-footer-jZcc-BBM.js";import"./use-auth-click-capture-B9wu-BP4.js";import"./Add-B3RL66ee.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./FavoriteBorder-D1CUmnAo.js";import"./use-previous-BgqS7ski.js";import"./album-image-CkUJpPZs.js";import"./Album-pwm22nnR.js";import"./album-link-DwfnHHp7.js";import"./small-artist-image-BqXmK0zy.js";import"./Mic-DAPkQZuC.js";import"./artist-link-XkkvBaYk.js";import"./playlist-link-CLw6NzkW.js";import"./share-media-buttons-DtF-m4-I.js";import"./Share-C8wHCu8Q.js";import"./track-image-B3DSRXTB.js";import"./track-link-D8mIwI0F.js";import"./tabs-BVjOaE7L.js";import"./tab-panels-BNEb_18b.js";import"./use-clipboard-CQvDhy4G.js";import"./entitiy-offline-indicator-icon-B5v2rY9X.js";import"./playable-grid-item-Cb5d38jQ.js";import"./track-BCLqLBLk.js";import"./MoreHoriz-RUUnngeG.js";import"./confirmation-dialog-DVMbD2S1.js";import"./PlaylistPlay-DcgxbGJx.js";import"./use-active-upload-BwzDBsep.js";import"./open-upload-window-CboR35vP.js";import"./uploaded-file-ksxfN_l-.js";import"./extension-from-filename-O0XMuZye.js";import"./AddAPhoto-y5pGVyq2.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./use-current-date-time-BhbL04rR.js";import"./track-context-dialog-DU1dwrB2.js";import"./artist-links-YW81uP4U.js";import"./toggle-in-library-menu-button-CqmQ1GOD.js";import"./toggle-repost-menu-button-DAsBpr-F.js";import"./use-should-show-radio-button-CEtJUckB.js";import"./use-track-permissions-ChTh4jJA.js";import"./download-file-from-url-BVaKcxRP.js";import"./skeleton-BmWW5Jc-.js";import"./like-icon-button-ppQBH-Cs.js";import"./MoreVert-BiULonS7.js";import"./Schedule-D2nn-qO3.js";import"./TrendingUp-hWFiGDg8.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";import"./getScrollParent--OCc5gFh.js";import"./infinite-scroll-sentinel-Br7e5Kqx.js";import"./index-B5ww1iWt.js";import"./default-meta-tags-Cim_8kSD.js";import"./infiniteQueryObserver-CQEL_EnT.js";function R({playlist:e,totalDuration:r,queueId:a}){return t.jsx(m.Fragment,{children:t.jsx(st,{image:t.jsx(Tt,{playlist:e}),title:e.name,subtitle:t.jsx(tt,{children:e.editors.map(s=>t.jsx(F,{circle:!0,src:s.image,label:s.name,link:M(s)},s.id))}),description:t.jsxs(m.Fragment,{children:[e.description,e.tracks_count?t.jsxs(rt,{className:"mt-14 text-sm text-muted justify-center md:justify-start",children:[t.jsx(f,{message:"[one 1 track|other :count tracks]",values:{count:e.tracks_count}}),t.jsx(dt,{ms:r,verbose:!0}),e.collaborative&&t.jsx(f,{message:"Collaborative"})]}):null]}),actionsBar:t.jsx(wt,{playlist:e,hasTracks:r>0,queueId:a})})})}function Tt({playlist:e,size:r,className:a}){const s=pt(),{canEdit:i}=lt(e);return i?t.jsx(ut,{children:t.jsx(ct,{uploadType:E.artwork,variant:"square",previewSize:r,previewRadius:"rounded-panel",className:a,value:e.image,onChange:o=>{s.mutate({image:o})},placeholderIcon:t.jsx(ft,{size:"xl"}),stretchPreview:!0})}):t.jsx(mt,{className:`${r} ${a} rounded-panel object-cover`,playlist:e})}function wt({playlist:e,hasTracks:r,queueId:a}){return t.jsxs("div",{className:"text-center md:text-start",children:[t.jsx(at,{disabled:!r,buttonType:"text",queueId:a,className:P({isFirst:!0})}),t.jsx(et,{className:"mr-8",item:e,totalTracksCount:e.tracks_count??0}),t.jsx(it,{buttonType:"text",playlist:e,className:P()}),t.jsxs(I,{type:"popover",mobileType:"tray",children:[t.jsx(A,{variant:"outline",radius:"rounded-full",endIcon:t.jsx(N,{}),className:P(),children:t.jsx(f,{message:"More"})}),t.jsx(nt,{playlist:e})]})]})}function Dt(e,r,a){const s=Array.isArray(r)?r:[r],i=e[a+(a<s[0]?0:1)],o=s.map(n=>e[n]),c=[];for(let n=0;n<e.length;){const l=e[n];o.indexOf(l)>=0?(c.push(l),e.splice(n,1)):++n}let p=e.indexOf(i);return p<0&&(p=e.length),e.splice(p,0,...c),e}function Bt(){const{playlistId:e}=k(["playlistId"]);return Q({mutationFn:r=>Rt(e,r),onSuccess:()=>{$.invalidateQueries({queryKey:v.playlists.show(e).invalidateKey})},onError:r=>_(r)})}function Rt(e,{tracks:r,oldIndexes:a,newIndex:s}){const i=r.map(o=>o.id);return Dt(i,a,s),H.post(`playlists/${e}/tracks/order`,{ids:i}).then(o=>o.data)}function S({item:e,children:r,className:a,...s}){const i=Pt(),{data:o,selectRow:c,selectedRows:p,sortDescriptor:n,meta:l}=m.useContext(D),u=m.useRef(null),g=m.useRef(null),d=Bt(),x=l==null?void 0:l.playlist,{sortableProps:j}=ht({ref:u,disabled:(i??!1)||d.isPending||(n==null?void 0:n.orderBy)!=="position",item:e,items:o,type:"playlistTrack",preview:g,strategy:"line",onDragEnd:()=>{c(null)},onSortStart:()=>{p.includes(e.id)||c(e)},onSortEnd:(y,h)=>{d.mutate({tracks:o,oldIndexes:p.length>1?p.map(q=>o.findIndex(C=>C.id===q)):y,newIndex:h})}});return t.jsxs(m.Fragment,{children:[t.jsxs(I,{type:"popover",triggerOnContextMenu:!0,placement:"bottom-start",children:[t.jsx("div",{className:a,ref:u,...G(j,s),children:r}),t.jsx(yt,{playlist:x})]}),!e.isPlaceholder&&t.jsx(St,{track:e,ref:g})]})}const St=O.forwardRef(({track:e},r)=>{var i,o;const{selectedRows:a}=m.useContext(D),s=a.length>1?t.jsx(f,{message:":count tracks",values:{count:a.length}}):`${e.name} - ${(o=(i=e.artists)==null?void 0:i[0])==null?void 0:o.name}`;return t.jsx(jt,{ref:r,children:()=>t.jsx("div",{className:"rounded bg-chip p-8 text-base shadow",role:"presentation",children:s})})});function qt(){const[e,r]=m.useState(null),[a,s]=m.useState(!0),{playlistId:i}=k(["playlistId"]);if(m.useEffect(()=>{Ct(+i).then(r).finally(()=>s(!1))},[i]),e){const o=T(e.playlist);return t.jsxs("div",{children:[t.jsx(R,{playlist:e.playlist,totalDuration:e.totalDuration,queueId:o}),t.jsx(w,{queueGroupId:o,tracks:e.tracks.data,renderRowAs:S,playlist:e.playlist,tableBody:t.jsx(B,{query:null,totalItems:e.tracks.data.length})})]})}return a?null:t.jsx(L,{})}async function Ct(e){if(!ot().offlinedPlaylistIds.has(e))return null;const r=await gt.getPlaylistById(e),a=r==null?void 0:r.data;if(!a)return null;const s=(await xt.getTracksOfflinedBy(a)).map(i=>i.data);return s.length?{loader:"playlistPage",playlist:a,tracks:{current_page:1,per_page:s.length,from:1,to:s.length,total:s.length,data:s},totalDuration:s.reduce((i,o)=>i+(o.duration||0),0)}:null}const Ft={orderBy:"position",orderDir:"asc"};function wr(){return t.jsx(Y,{offlineFallback:t.jsx(qt,{}),children:t.jsx(Mt,{})})}function Mt(){const{trans:e}=z(),{playlistId:r}=k(["playlistId"]),a=bt(v.playlists.show(r).playlist("playlistPage")),s=a.data.playlist,{searchQuery:i,setSearchQuery:o,sortDescriptor:c,setSortDescriptor:p,isDefferedLoading:n,queryParams:l}=Z(Ft),u=m.useRef(l).current,g=u.query===l.query&&u.orderBy===l.orderBy&&u.orderDir===l.orderDir?a.data.tracks:void 0,d=It(v.playlists.show(r).tracks(l,g)),x=kt(d),j=s.tracks_count||0,y=T(a.data.playlist,"*",c);return t.jsxs(t.Fragment,{children:[t.jsx(vt,{query:a}),s.image&&t.jsx(W,{image:s.image}),t.jsxs("div",{className:"relative",children:[t.jsx(b,{slot:"general_top",className:"mb-44"}),t.jsx(R,{playlist:s,totalDuration:a.data.totalDuration,queueId:y}),t.jsx(U,{onChange:h=>o(h.target.value),className:"mb-44 max-w-512 md:mb-24",size:"sm",startAdornment:t.jsx(J,{}),placeholder:e(V("Search within playlist")),endAdornment:n?t.jsx(K,{size:"xs",isIndeterminate:!0}):null}),t.jsx(w,{queueGroupId:y,tracks:x,sortDescriptor:c,onSortChange:p,renderRowAs:S,playlist:s,tableBody:t.jsx(B,{query:d,totalItems:j})}),x.length?null:t.jsx(X,{className:"mt-34",searchQuery:i,description:t.jsx(f,{message:"This playlist does not have any tracks yet"})}),t.jsx(b,{slot:"general_bottom",className:"mt-44"})]})]})}export{wr as Component};
