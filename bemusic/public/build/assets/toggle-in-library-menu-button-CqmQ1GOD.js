import{$ as k,j as o,I as y,J as n,aF as p,bK as _,bL as v,G as f,H as C,aa as g,b as h,T as c}from"./main-CUJEGI8U.js";import{c as m}from"./share-media-button-Dw3JV4C-.js";import{u as x}from"./use-clipboard-CQvDhy4G.js";import{u as j}from"./use-auth-click-capture-B9wu-BP4.js";function q({link:r,children:e}){const{close:t}=k(),[,i]=x(r);return o.jsx(m,{enableWhileOffline:!0,onClick:()=>{i(),t(),y(n("Copied link to clipboard"))},children:e})}function A(r){const e=r==="reposts"?p().reposts:p().likes;return _()(v((t,i)=>({track:(e==null?void 0:e.track)||{},album:(e==null?void 0:e.album)||{},artist:(e==null?void 0:e.artist)||{},has:s=>(Array.isArray(s)?s:[s]).every(a=>i()[a.model_type][a.id]),add:s=>{const l=s[0].model_type;t(a=>{s.forEach(u=>{a[l][u.id]=!0})})},remove:s=>{const l=s[0].model_type;t(a=>{s.forEach(u=>{delete a[l][u.id]})})}})))}const L=A("likes"),d=L.getState;function M(){return f({mutationFn:r=>T(r),onSuccess:(r,e)=>{y(F(e.likeables[0])),d().add(e.likeables),g.invalidateQueries({queryKey:[`${e.likeables[0].model_type}s`,"liked"]})},onError:r=>C(r)})}function T(r){const e=r.likeables.filter(t=>!d().has(t)).map(t=>({likeable_id:t.id,likeable_type:t.model_type}));return h.post("users/me/add-to-library",{likeables:e}).then(t=>t.data)}function F(r){switch(r.model_type){case"artist":return n("Added to your artists");case"album":return n("Added to your albums");case"track":return n("Added to your liked songs")}}function E(){return f({mutationFn:r=>I(r),onSuccess:(r,e)=>{y(R(e.likeables[0])),d().remove(e.likeables),g.invalidateQueries({queryKey:[`${e.likeables[0].model_type}s`,"library"]})},onError:r=>C(r)})}function I(r){const e=r.likeables.filter(t=>d().has(t)).map(t=>({likeable_id:t.id,likeable_type:t.model_type}));return h.post("users/me/remove-from-library",{likeables:e}).then(t=>t.data)}function R(r){switch(r.model_type){case"artist":return n("Removed from your artists");case"album":return n("Removed from your albums");case"track":return n("Removed from your liked songs")}}function H({items:r,modelType:e}){const t=j(),{close:i}=k(),s=M(),l=E();if(L(b=>b.has(r))){const b=e==="artist"?o.jsx(c,{message:"Following"}):o.jsx(c,{message:"Remove from library"});return o.jsx(m,{onClickCapture:t,onClick:()=>{i(),l.mutate({likeables:r})},children:b})}const u=e==="artist"?o.jsx(c,{message:"Follow"}):o.jsx(c,{message:"Add to library"});return o.jsx(m,{onClickCapture:t,onClick:()=>{i(),s.mutate({likeables:r})},children:u})}export{q as C,H as T,E as a,L as b,A as c,M as u};
