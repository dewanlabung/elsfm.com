import{G as b,ag as q,I as y,J as o,aa as P,d1 as H,b as f,M as Q,ae as $,$ as T,j as e,a0 as z,a1 as M,T as a,a2 as K,as as R,a3 as W,V as j,t as h,H as k,a9 as O,v,d as V,aM as S,an as G,a8 as p,W as x,D as c,u as J,r as w,bx as E,S as X,ab as Y}from"./main-CUJEGI8U.js";import{t as Z}from"./team-DYmDDGxN.js";import{F as ee}from"./image-selector-GLpYAkj6.js";import{D as se}from"./dialog-footer-jZcc-BBM.js";import{F as ae}from"./file-upload-provider-DWaB2xE4.js";import{B as te,u as re}from"./use-unban-users-CqpN6Ab_.js";import{C as D}from"./confirmation-dialog-DVMbD2S1.js";import{N as oe}from"./name-with-avatar-CpbvmPVO.js";import{C as ie}from"./chip-list-D0uDB84E.js";import{F as C}from"./formatted-date-DzIPJwiH.js";import{E as ne}from"./Edit-BRVJ8AkN.js";import{L as le}from"./Login-BYgB4hr5.js";import{P as N}from"./PersonOff-BFTGeYHz.js";import{d as l,F,u as me,a as de,G as ce,D as ue,b as pe,c as xe}from"./use-datatable-query-D9uebfzx.js";import{c as ge,u as je}from"./timestamp-filters-DydeeDDl.js";import{D as he}from"./data-table-export-csv-button-CXTyi45a.js";import{D as be}from"./data-table-add-item-button-_qDHIKil.js";import{D as ye}from"./datatable-filters-DFYg3QEK.js";import{a as fe,D as De,b as ve,c as Se}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as we}from"./table-CgoYghfp.js";import"./use-active-upload-BwzDBsep.js";import"./open-upload-window-CboR35vP.js";import"./uploaded-file-ksxfN_l-.js";import"./extension-from-filename-O0XMuZye.js";import"./AddAPhoto-y5pGVyq2.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./traditional-BcYcLesO.js";import"./date-picker-CE2IMMIh.js";import"./use-current-date-time-BhbL04rR.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./input-DAWJLQiY.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./switch-4KDjemPX.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./use-normalized-models-ClA2DWxP.js";import"./form-chip-field-ehb7ckkp.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./normalized-model-field-8T9JWy8W.js";import"./skeleton-BmWW5Jc-.js";import"./formatted-number-gsF1qEbc.js";import"./FileDownload-BeEtcFOa.js";import"./download-file-from-url-BVaKcxRP.js";import"./Add-B3RL66ee.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";function Ce(s){return b({mutationFn:t=>Fe(t),onSuccess:()=>{y(o("User created")),P.invalidateQueries({queryKey:H.users.invalidateKey})},onError:t=>q(t,s)})}function Fe(s){return s.roles&&(s.roles=s.roles.map(t=>t.id)),f.post("users",s).then(t=>t.data)}function Ie(){const s=Q(),t=Ce(s),r=$(),{close:i,formId:n}=T();return e.jsxs(z,{children:[e.jsx(M,{children:e.jsx(a,{message:"Create user"})}),e.jsx(K,{children:e.jsxs(R,{id:n,form:s,onSubmit:m=>{t.mutate(m,{onSuccess:g=>{i(),r(`${g.user.id}`,{replace:!0})}})},children:[e.jsx(ae,{children:e.jsx(ee,{className:"mb-24",name:"image",uploadType:W.avatars,label:e.jsx(a,{message:"Avatar"}),showRemoveButton:!0})}),e.jsx(j,{required:!0,className:"mb-24",name:"email",type:"email",label:e.jsx(a,{message:"Email"})}),e.jsx(j,{className:"mb-24",name:"name",label:e.jsx(a,{message:"Name"})}),e.jsx(j,{required:!0,name:"password",type:"password",label:e.jsx(a,{message:"Password"})})]})}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>i(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:n,disabled:t.isPending,children:e.jsx(a,{message:"Create"})})]})]})}function Ue(){return b({mutationFn:s=>Pe(s),onSuccess:async s=>{y(o(`Impersonating user "${s.user.name}"`)),window.location.href="/"},onError:s=>k(s)})}function Pe(s){return f.post(`admin/users/impersonate/${s.userId}`,s).then(t=>t.data)}function Te({user:s}){const t=Ue();return e.jsx(D,{title:e.jsx(a,{message:"Impersonate user"}),isLoading:t.isPending,body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(a,{message:"Are you sure you want to login as this user?"})}),e.jsx("p",{className:"mt-8",children:e.jsx(a,{message:"This will log you out of your current account and log you in as the user."})})]}),confirm:e.jsx(a,{message:"Login"}),onConfirm:()=>{t.mutate({userId:s.id})}})}const I=[{key:"name",allowsSorting:!0,sortingKey:"email",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(a,{message:"User"}),body:s=>e.jsx(oe,{image:s.image,label:s.name,description:s.email,alwaysShowAvatar:!0,avatarCircle:!0})},{key:"roles",header:()=>e.jsx(a,{message:"Roles"}),body:s=>{var t;return e.jsx(ie,{radius:"rounded",size:"xs",children:(t=s==null?void 0:s.roles)==null?void 0:t.map(r=>e.jsx(O,{selectable:!0,children:e.jsx(v,{className:V("capitalize"),target:"_blank",to:`/admin/roles/${r.id}/edit`,children:e.jsx(a,{message:r.name})})},r.id))})}},{key:"subscribed",header:()=>e.jsx(a,{message:"Subscribed"}),width:"w-96",body:s=>{var t;return(t=s.subscriptions)!=null&&t.filter(r=>r.valid).length?e.jsx(S,{className:"text-positive icon-md"}):e.jsx(G,{className:"text-danger icon-md"})}},{key:"banned_at",allowsSorting:!0,header:()=>e.jsx(a,{message:"Suspended"}),width:"w-96",body:s=>s.banned_at?e.jsx(S,{className:"text-danger icon-md"}):null},{key:"latest_user_session",width:"w-110",header:()=>e.jsx(a,{message:"Last active"}),body:s=>s.latest_user_session?e.jsx("time",{children:e.jsx(C,{date:s.latest_user_session.updated_at})}):"-"},{key:"created_at",allowsSorting:!0,width:"w-110",header:()=>e.jsx(a,{message:"Created at"}),body:s=>e.jsx("time",{children:e.jsx(C,{date:s.created_at})})},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),width:"w-128 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:s=>e.jsxs("div",{className:"text-muted",children:[e.jsx(v,{to:`${s.id}/details`,children:e.jsx(p,{label:e.jsx(a,{message:"Edit user"}),children:e.jsx(x,{size:"md",children:e.jsx(ne,{})})})}),s.banned_at?e.jsx(ke,{user:s}):e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Suspend user"}),children:e.jsx(x,{size:"md",children:e.jsx(N,{})})}),e.jsx(te,{userIds:[s.id]})]}),e.jsx(Ee,{user:s})]})}];function ke({user:s}){const t=re([s.id]);return e.jsxs(c,{type:"modal",onClose:r=>{r&&t.mutate()},children:[e.jsx(p,{label:e.jsx(a,{message:"Remove suspension"}),children:e.jsx(x,{size:"md",color:"danger",children:e.jsx(N,{})})}),e.jsx(D,{isDanger:!0,title:e.jsx(a,{message:"Suspend “:name“",values:{name:s.name}}),body:e.jsx(a,{message:"Are you sure you want to remove suspension from this user?"}),confirm:e.jsx(a,{message:"Unsuspend"})})]})}function Ee({user:s}){return e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Login as user"}),children:e.jsx(x,{size:"md",children:e.jsx(le,{})})}),e.jsx(Te,{user:s})]})}const U=[{key:"email_verified_at",label:o("Email"),description:o("Email verification status"),defaultOperator:l.ne,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is confirmed"),value:{value:null,operator:l.ne}},{key:"02",label:o("is not confirmed"),value:{value:null,operator:l.eq}}]}},ge({description:o("Date user registered or was created")}),je({description:o("Date user was last updated")}),{key:"subscriptions",label:o("Subscription"),description:o("Whether user is subscribed or not"),defaultOperator:l.eq,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is subscribed"),value:{value:"*",operator:l.has}},{key:"02",label:o("is not subscribed"),value:{value:"*",operator:l.doesntHave}}]}}];function Ms(){const{billing:s}=J(),[t,r]=w.useState([]),{searchParams:i,sortDescriptor:n,mergeIntoSearchParams:m,setSearchQuery:g,isFiltering:_}=me(Y),A=s!=null&&s.enable?I:I.filter(d=>d.key!=="subscribed"),u=de(E.users.index(i)),B=e.jsxs(c,{type:"modal",children:[e.jsx(h,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Ne,{selectedIds:t,onDelete:()=>r([])})]}),L=e.jsxs(w.Fragment,{children:[e.jsx(he,{endpoint:"users/csv/export"}),e.jsxs(c,{type:"modal",children:[e.jsx(be,{children:e.jsx(a,{message:"Add new user"})}),e.jsx(Ie,{})]})]});return e.jsxs(fe,{children:[e.jsx(ce,{query:u}),e.jsx(X,{children:e.jsx(a,{message:"Users"})}),e.jsx(De,{title:e.jsx(a,{message:"Users"}),showSidebarToggleButton:!0}),e.jsxs(ve,{children:[e.jsx(ue,{searchValue:i.query,onSearchChange:g,actions:L,selectedItems:t,selectedActions:B,filters:U}),e.jsx(ye,{filters:U}),e.jsxs(Se,{children:[e.jsx(we,{columns:A,data:u.items,sortDescriptor:n,onSortChange:m,enableSelection:!0,selectedRows:t,onSelectionChange:r}),u.isEmpty&&e.jsx(pe,{isFiltering:_,image:Z,title:e.jsx(a,{message:"No users have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching users"})}),e.jsx(xe,{query:u,onPageChange:d=>m({page:d}),onPerPageChange:d=>m({perPage:d})})]})]})]})}function Ne({selectedIds:s,onDelete:t}){const{close:r}=T(),i=b({mutationFn:()=>f.delete(`users/${s.join(",")}`),onSuccess:async()=>{await P.invalidateQueries({queryKey:E.users.invalidateKey}),y(o("Users deleted")),t(),r()},onError:n=>k(n)});return e.jsx(D,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete users"}),body:e.jsx(a,{message:"Are you sure you want to delete selected users?",values:{count:s.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{Ms as Component,Ne as DeleteUsersDialog};
