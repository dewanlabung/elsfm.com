import{al as h,ae as k,u as S,X as w,r as p,j as m,J as n,b as C}from"./main-CUJEGI8U.js";import{l as I}from"./index-U9JJOqTM.js";import{B as L}from"./billing-redirect-message-B2ni2sMt.js";import{C as x,a as P}from"./checkout-product-summary-CTRvQ4WZ.js";import"./TaskAlt-D7tFnO3X.js";import"./skeleton-BmWW5Jc-.js";import"./formatted-price-o7rYOnCC.js";import"./product-feature-list-h7uiYZPf.js";function D(){const{productId:s,priceId:e}=h(),r=k(),{billing:a}=S(),[o]=w(),c=o.get("payment_intent_client_secret")?"paymentIntent":"setupIntent",i=c==="paymentIntent"?o.get("payment_intent_client_secret"):o.get("setup_intent_client_secret"),f=o.get("subscriptionId"),[_,u]=p.useState(),d=p.useRef(!1);return p.useEffect(()=>{d.current||(I(a==null?void 0:a.stripe_public_key).then(async l=>{if(!l||!i||c==="setupIntent"&&!f){u(g());return}const y=async t=>{(t==null?void 0:t.status)==="succeeded"?(await R(c,t.id,f),u(g("succeeded",s,e)),window.location.href="/billing"):u(g(t==null?void 0:t.status,s,e))};c==="paymentIntent"?l.retrievePaymentIntent(i).then(({paymentIntent:t})=>y(t)):l.retrieveSetupIntent(i).then(({setupIntent:t})=>y(t))}),d.current=!0)},[a==null?void 0:a.stripe_public_key,i,e,s]),i?m.jsxs(x,{children:[m.jsx(L,{config:_}),m.jsx(P,{showBillingLine:!1})]}):(r("/"),null)}function g(s,e,r){switch(s){case"succeeded":return{message:n("Subscription successful!"),status:"success",buttonLabel:n("Return to site"),link:"/billing"};case"processing":return{message:n("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:n("Return to site"),link:"/billing"};case"requires_payment_method":return{message:n("Payment failed. Please try another payment method."),status:"error",buttonLabel:n("Go back"),link:b(e,r)};default:return{message:n("Something went wrong"),status:"error",buttonLabel:n("Go back"),link:b(e,r)}}}function b(s,e){return s&&e?`/checkout/${s}/${e}`:"/"}function R(s,e,r){return C.post("billing/stripe/store-subscription-details-locally",{intent_type:s,intent_id:e,subscription_id:r})}export{D as Component};
