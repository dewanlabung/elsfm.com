import{r as d,j as s,d as w,z,ct as H,J as v,G as R,H as E,I as F,aa as A,at as Q,b as _,e as B,$ as W,T as m,av as q,D as k,W as L,bz as K,co as $}from"./main-CUJEGI8U.js";import{A as G}from"./album-link-DwfnHHp7.js";import{T as P}from"./track-context-dialog-DU1dwrB2.js";import{a as h,T as J}from"./table-CgoYghfp.js";import{u as U,E as V,a as I,c as X}from"./share-media-button-Dw3JV4C-.js";import{u as C,b as M}from"./use-player-store-BWFGgN3k.js";import{P as Y}from"./play-arrow-filled-BrHo1wfG.js";import{P as Z}from"./Pause-B4fj-x54.js";import{T as ee}from"./entitiy-offline-indicator-icon-B5v2rY9X.js";import{T as se}from"./track-image-B3DSRXTB.js";import{S as l}from"./skeleton-BmWW5Jc-.js";import{L as te}from"./like-icon-button-ppQBH-Cs.js";import{M as ae}from"./MoreHoriz-RUUnngeG.js";import{M as re}from"./MoreVert-BiULonS7.js";import{F as ne}from"./formatted-duration-2_MIaPa4.js";import{S as ie}from"./Schedule-D2nn-qO3.js";import{T as oe}from"./TrendingUp-hWFiGDg8.js";function N({children:e,...t}){const{selectedRows:a,data:r}=d.useContext(h),n=d.useMemo(()=>a.map(i=>r.find(o=>o.id===i)).filter(i=>!!i),[a,r]);return s.jsx(P,{...t,tracks:n,children:e})}function T(e,t){return C(a=>{var r,n,i,o;return!((n=(r=a.cuedMedia)==null?void 0:r.meta)!=null&&n.id)||((i=a.cuedMedia.meta)==null?void 0:i.id)!==e?!1:!!(!((o=a.cuedMedia)!=null&&o.groupId)&&!t||t&&a.cuedMedia.groupId===t)})}function le(e,t){const a=T(e,t),r=C(n=>n.isPlaying);return a&&r}const de={};function p(){const{meta:e}=d.useContext(h);return e||de}function ue({track:e,rowIndex:t,isHovered:a}){const{queueGroupId:r}=p(),n=le(e.id,r),i=T(e.id,r);return s.jsx("div",{className:"h-24 w-24 text-center",children:a||n?s.jsx(ce,{track:e,trackIndex:t,isPlaying:n}):s.jsx("span",{className:w(i?"text-primary":"text-muted"),children:t+1})})}function ce({track:e,trackIndex:t,isPlaying:a}){const{trans:r}=z(),n=M(),{data:i}=d.useContext(h),{queueGroupId:o}=p(),[j,c]=d.useState(!1),y=H(),g=U(u=>u.offlinedTrackIds.has(e.id)),x=y&&!g;return a?s.jsx("button",{disabled:x,onPointerEnter:()=>c(!0),onPointerLeave:()=>c(!1),"aria-label":r(v("Pause :name",{values:{name:e.name}})),tabIndex:0,onClick:u=>{u.stopPropagation(),n.pause()},children:j?s.jsx(Z,{}):s.jsx(V,{})}):s.jsx("button",{disabled:x,"aria-label":r(v("Play :name",{values:{name:e.name}})),tabIndex:0,onClick:async u=>{u.stopPropagation();const b=await I(i,o);n.overrideQueueAndPlay(b,t)},children:s.jsx(Y,{})})}function me({track:e}){var n,i;const{hideTrackImage:t,queueGroupId:a}=p(),r=T(e.id,a);return s.jsxs("div",{className:"flex items-center gap-12",children:[!t&&s.jsx(se,{className:"h-40 w-40 flex-shrink-0 rounded object-cover",track:e}),s.jsxs("div",{className:"min-w-0 overflow-hidden",children:[s.jsx("div",{className:w("overflow-hidden overflow-ellipsis",r&&"text-primary","text-sm"),children:e.name}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted",children:[s.jsx(ee,{trackId:e.id}),(n=e.artists)!=null&&n.length?s.jsx("div",{className:"overflow-hidden overflow-ellipsis text-sm",children:(i=e.artists)==null?void 0:i.map(o=>o.name).join(", ")}):null]})]})]})}function xe(){const{hideTrackImage:e}=p();return s.jsxs("div",{className:"flex w-full max-w-4/5 items-center gap-12",children:[!e&&s.jsx(l,{size:"w-40 h-40",variant:"rect",radius:"rounded"}),s.jsxs("div",{className:"min-w-0 flex-auto",children:[s.jsx("div",{className:"leading-3",children:s.jsx(l,{})}),s.jsx("div",{className:"mt-4 max-w-[60%] leading-3 text-muted",children:s.jsx(l,{})})]})]})}function fe(){return R({mutationFn:e=>he(e),onSuccess:(e,{tracks:t})=>{F(v("Removed [one 1 track|other :count tracks] from playlist",{values:{count:t.length}})),A.invalidateQueries({queryKey:Q.playlists.show(e.playlist.id).invalidateKey})},onError:e=>E(e)})}function he(e){const t={ids:e.tracks.map(a=>a.id)};return _.post(`playlists/${e.playlistId}/tracks/remove`,t).then(a=>a.data)}function Ee({playlist:e,...t}){return s.jsx(N,{...t,children:a=>s.jsx(S,{playlist:e,tracks:a})})}function S({playlist:e,tracks:t}){const{user:a}=B(),r=fe(),{close:n}=W();return e.owner_id===(a==null?void 0:a.id)||e.collaborative?s.jsx(X,{onClick:()=>{r.isPending||(r.mutate({playlistId:e.id,tracks:t}),n())},children:s.jsx(m,{message:"Remove from this playlist"})}):null}function pe({track:e,isHovered:t}){const a=q(),{meta:r}=d.useContext(h);return s.jsxs(d.Fragment,{children:[s.jsxs(k,{type:"popover",mobileType:"tray",children:[s.jsx(L,{size:a?"sm":"md",className:w(a?"text-muted":"mr-8",!a&&!t&&"invisible"),children:a?s.jsx(re,{}):s.jsx(ae,{})}),s.jsx(P,{tracks:[e],children:n=>r.playlist?s.jsx(S,{playlist:r.playlist,tracks:n}):null})]}),!a&&s.jsx(te,{size:"xs",likeable:e})]})}const je=[{key:"index",header:()=>s.jsx("span",{children:"#"}),align:"center",width:"w-24 flex-shrink-0",body:(e,t)=>t.isPlaceholder?s.jsx(l,{size:"w-20 h-20",variant:"rect"}):s.jsx(ue,{track:e,rowIndex:t.index,isHovered:t.isHovered})},{key:"name",allowsSorting:!0,width:"flex-3 min-w-224",visibleInMode:"all",header:()=>s.jsx(m,{message:"Title"}),body:(e,t)=>t.isPlaceholder?s.jsx(xe,{}):s.jsx(me,{track:e})},{key:"album_id",allowsSorting:!0,width:"flex-2",header:()=>s.jsx(m,{message:"Album"}),body:(e,t)=>t.isPlaceholder?s.jsx(l,{className:"max-w-4/5 leading-3"}):e.album?s.jsx(G,{album:e.album}):null},{key:"added_at",sortingKey:"likes.created_at",allowsSorting:!0,maxWidth:"max-w-112",header:()=>s.jsx(m,{message:"Date added"}),body:(e,t)=>t.isPlaceholder?s.jsx(l,{className:"max-w-4/5 leading-3"}):s.jsx($,{date:e.added_at})},{key:"options",align:"end",width:"w-36 md:w-84",header:()=>s.jsx(m,{message:"Options"}),hideHeader:!0,visibleInMode:"all",body:(e,t)=>t.isPlaceholder?s.jsx("div",{className:"flex justify-end",children:s.jsx(l,{size:"w-20 h-20",variant:"rect"})}):s.jsx(pe,{track:e,isHovered:t.isHovered})},{key:"duration",allowsSorting:!0,className:"text-muted",maxWidth:"max-w-48",align:"end",header:()=>s.jsx(ie,{}),body:(e,t)=>t.isPlaceholder?s.jsx(l,{className:"leading-3"}):e.duration?s.jsx(ne,{ms:e.duration}):null},{key:"popularity",allowsSorting:!0,className:"text-muted",maxWidth:"max-w-54",header:()=>s.jsx(oe,{}),body:(e,t)=>t.isPlaceholder?s.jsx(l,{className:"leading-3"}):s.jsx("div",{className:"relative h-6 w-54 rounded-button bg-chip",children:s.jsx("div",{style:{width:`${e.popularity||50}%`},className:"absolute left-0 top-0 h-6 w-0 rounded-button bg-black/30 dark:bg-white/30"})})}];function Fe({tracks:e,hideAlbum:t=!1,hideHeaderRow:a=!1,hideTrackImage:r=!1,hidePopularity:n=!0,hideAddedAtColumn:i=!0,queueGroupId:o,renderRowAs:j,playlist:c,...y}){const g=M(),x=K();a=a||x;const u=d.useMemo(()=>je.filter(f=>!(f.key==="album_id"&&t||f.key==="popularity"&&n||f.key==="added_at"&&i)),[t,n,i]),b=d.useMemo(()=>({queueGroupId:o,hideTrackImage:r,playlist:c}),[o,r,c]);return s.jsx(J,{closeOnInteractOutside:!0,hideHeaderRow:a,selectionStyle:"highlight",selectRowOnContextMenu:!0,renderRowAs:j||ye,columns:u,data:e,meta:b,hideBorder:!0,hideHeaderBorder:a,cellHeight:"h-56",onAction:async(f,O)=>{const D=await I(e,o);g.overrideQueueAndPlay(D,O)},...y})}function ye({item:e,children:t,...a}){const r=s.jsx("div",{...a,children:t});return e.isPlaceholder?r:s.jsxs(k,{type:"popover",mobileType:"tray",triggerOnContextMenu:!0,placement:"bottom-start",children:[r,s.jsx(N,{})]})}export{Ee as P,Fe as T};
