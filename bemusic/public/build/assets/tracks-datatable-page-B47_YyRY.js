import{z as v,G as j,H as f,I as b,J as r,aa as D,b as k,M as C,$ as T,j as e,a0 as A,a1 as P,T as a,a2 as L,as as N,V as E,t as g,W as c,v as x,D as h,r as S,at as w,S as _,ab as B,u as q,ae as H,a8 as M}from"./main-CUJEGI8U.js";import{D as O}from"./dialog-footer-jZcc-BBM.js";import{F as z}from"./switch-4KDjemPX.js";import{T as R}from"./track-BCLqLBLk.js";import{D as W}from"./paginated-resources-BDxg6DLi.js";import{U as Q,C as V}from"./update-lyric-dialog-ChCRi6lM.js";import{S as G}from"./small-artist-image-BqXmK0zy.js";import{A as K}from"./artist-link-XkkvBaYk.js";import{T as $}from"./track-image-B3DSRXTB.js";import{T as U}from"./track-link-D8mIwI0F.js";import{F as J}from"./formatted-date-DzIPJwiH.js";import{F as X}from"./formatted-duration-2_MIaPa4.js";import{F as Y}from"./formatted-number-gsF1qEbc.js";import{B as Z}from"./BarChart-BpaNOmqn.js";import{C as ee}from"./ClosedCaption-CBUqO40I.js";import{E as te}from"./Edit-BRVJ8AkN.js";import{F as d,d as n,A as ae,u as se,a as re,G as oe,D as ie,b as le,c as ne}from"./use-datatable-query-D9uebfzx.js";import{A as me}from"./artist-C2fP4kQS.js";import{c as de,u as ce}from"./timestamp-filters-DydeeDDl.js";import{D as pe}from"./data-table-add-item-button-_qDHIKil.js";import{D as ue}from"./datatable-filters-DFYg3QEK.js";import{a as ge,D as xe,b as he,c as ye}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as je}from"./table-CgoYghfp.js";import{P as fe}from"./Publish-wob_XvAQ.js";import{C as be}from"./confirmation-dialog-DVMbD2S1.js";import{G as De}from"./music-Bh2SQVZ2.js";import"./normalized-model-field-8T9JWy8W.js";import"./use-normalized-models-ClA2DWxP.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./skeleton-BmWW5Jc-.js";import"./Mic-DAPkQZuC.js";import"./MusicNote-SjrQa4Nt.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./use-current-date-time-BhbL04rR.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./Add-B3RL66ee.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";function ke(){const{trans:t}=v();return j({mutationFn:s=>Te(s),onSuccess:()=>{b(t(r("Track imported"))),D.invalidateQueries({queryKey:W("tracks")})},onError:s=>f(s)})}function Te(t){return k.post("import-media/single-item",{modelType:R,spotifyId:t.spotifyId,importLyrics:t.importLyrics}).then(s=>s.data)}function Se(){const t=C({defaultValues:{importLyrics:!0}}),{formId:s,close:o}=T(),i=ke();return e.jsxs(A,{children:[e.jsx(P,{children:e.jsx(a,{message:"Import track"})}),e.jsx(L,{children:e.jsxs(N,{id:s,form:t,onSubmit:l=>{i.mutate(l,{onSuccess:p=>{o(p.track)}})},children:[e.jsx(E,{autoFocus:!0,required:!0,name:"spotifyId",minLength:22,maxLength:22,label:e.jsx(a,{message:"Spotify ID"}),className:"mb-24",description:e.jsx(a,{message:"This will also import all artists that collaborated on this track and album this track belongs to."})}),e.jsx(z,{name:"importLyrics",className:"mb-24",children:e.jsx(a,{message:"Import lyrics"})})]})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>o(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(g,{form:s,variant:"flat",color:"primary",type:"submit",disabled:i.isPending,children:e.jsx(a,{message:"Import"})})]})]})}const we=[{key:"name",allowsSorting:!0,header:()=>e.jsx(a,{message:"Track"}),width:"flex-3 min-w-200",visibleInMode:"all",body:t=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx($,{track:t,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),e.jsx(U,{track:t,target:"_blank"})]})},{key:"artist",allowsSorting:!1,header:()=>e.jsx(a,{message:"Artist"}),width:"flex-2",body:t=>{var s;return(s=t.artists)!=null&&s[0]?e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(G,{artist:t.artists[0],className:"flex-shrink-0 rounded",size:"w-34 h-34"}),e.jsx(K,{artist:t.artists[0]})]}):null}},{key:"duration",minWidth:"min-w-76",allowsSorting:!0,header:()=>e.jsx(a,{message:"Duration"}),body:t=>t.duration?e.jsx(X,{ms:t.duration}):null},{key:"plays",allowsSorting:!0,minWidth:"min-w-70",header:()=>e.jsx(a,{message:"Plays"}),body:t=>t.plays?e.jsx(Y,{value:t.plays}):null},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>t.updated_at?e.jsx(J,{date:t.updated_at}):""},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,align:"end",visibleInMode:"all",width:"w-128 flex-shrink-0",body:t=>e.jsxs("div",{className:"text-muted",children:[e.jsx(c,{size:"md",elementType:x,to:`${t.id}/insights`,children:e.jsx(Z,{})}),e.jsxs(h,{type:"modal",children:[e.jsx(c,{size:"md",children:e.jsx(ee,{})}),t.lyric?e.jsx(Q,{lyric:t.lyric}):e.jsx(V,{trackId:t.id})]}),e.jsx(c,{size:"md",elementType:x,to:`${t.id}/edit`,children:e.jsx(te,{})})]})}],y=[{key:"image",label:r("Artwork"),description:r("Whether track has any artwork uploaded"),defaultOperator:n.eq,control:{type:d.Select,defaultValue:"02",options:[{key:"01",label:r("Has artwork"),value:!1},{key:"02",label:r("Does not have artwork"),value:!0}]}},{key:"album_id",label:r("Album"),description:r("Whether track is part of an album"),defaultOperator:n.eq,control:{type:d.Select,defaultValue:"01",options:[{key:"01",label:r("Part of an album"),value:{operator:n.ne,value:null}},{key:"02",label:r("Single"),value:{operator:n.eq,value:null}}]}},{key:"plays",label:r("Plays count"),description:r("Number of times this track was played"),defaultOperator:n.gte,operators:ae,control:{type:d.Input,inputType:"number",defaultValue:100}},de({description:r("Date artist was created")}),ce({description:r("Date artist was last updated")}),{defaultOperator:n.has,key:"artists",label:r("Artist"),description:r("Artist this track belongs to"),control:{type:d.SelectModel,model:me}}];function Nt(){const[t,s]=S.useState([]),{searchParams:o,sortDescriptor:i,mergeIntoSearchParams:l,setSearchQuery:p,isFiltering:I}=se(B),m=re(w.tracks.index({...o,with:"artists,lyric"})),F=e.jsxs(h,{type:"modal",children:[e.jsx(g,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Fe,{selectedIds:t,onDelete:()=>s([])})]});return e.jsxs(ge,{children:[e.jsx(oe,{query:m}),e.jsx(_,{children:e.jsx(a,{message:"Tracks"})}),e.jsx(xe,{title:e.jsx(a,{message:"Tracks"}),showSidebarToggleButton:!0}),e.jsxs(he,{children:[e.jsx(ie,{searchValue:o.query,onSearchChange:p,actions:e.jsx(Ie,{}),selectedItems:t,selectedActions:F,filters:y}),e.jsx(ue,{filters:y}),e.jsxs(ye,{children:[e.jsx(je,{columns:we,data:m.items,sortDescriptor:i,onSortChange:l,enableSelection:!0,selectedRows:t,onSelectionChange:s}),m.isEmpty&&e.jsx(le,{isFiltering:I,image:De,title:e.jsx(a,{message:"No tracks have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching tracks"})}),e.jsx(ne,{query:m,onPageChange:u=>l({page:u}),onPerPageChange:u=>l({perPage:u})})]})]})]})}function Ie(){const{spotify_is_setup:t}=q(),s=H();return e.jsxs(S.Fragment,{children:[t&&e.jsxs(h,{type:"modal",onClose:o=>{o&&s(`/admin/tracks/${o.id}/edit`)},children:[e.jsx(M,{label:e.jsx(a,{message:"Import by spotify ID"}),children:e.jsx(c,{variant:"outline",color:"primary",className:"flex-shrink-0",size:"sm",children:e.jsx(fe,{})})}),e.jsx(Se,{})]}),e.jsx(pe,{elementType:x,to:"new",children:e.jsx(a,{message:"Add new track"})})]})}function Fe({selectedIds:t,onDelete:s}){const{close:o}=T(),i=j({mutationFn:()=>k.delete(`tracks/${t.join(",")}`),onSuccess:async()=>{await D.invalidateQueries({queryKey:w.tracks.invalidateKey}),b(r("Tracks deleted")),s(),o()},onError:l=>f(l)});return e.jsx(be,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete tracks"}),body:e.jsx(a,{message:"Are you sure you want to delete selected tracks?",values:{count:t.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{Nt as Component};
