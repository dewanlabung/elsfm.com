import{$ as N,r as h,z as P,j as e,a0 as A,a1 as R,T as t,a2 as F,ar as k,J as j,ao as q,t as g,ai as E,aj as Q,d as z,c1 as K,G as b,H as S,I as D,b as I,bx as f,D as C,aa as T,cY as M,y as V}from"./main-CUJEGI8U.js";import{b as U,u as $,a as H,G as L,D as G,c as B}from"./use-datatable-query-D9uebfzx.js";import{N as _}from"./name-with-avatar-CpbvmPVO.js";import{c as J}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{D as W}from"./paginated-resources-BDxg6DLi.js";import{u as Y}from"./use-required-params-Cp5Jywbp.js";import{T as O}from"./table-CgoYghfp.js";import{D as X}from"./dialog-footer-jZcc-BBM.js";import{t as v}from"./team-DYmDDGxN.js";import{u as Z}from"./use-normalized-models-ClA2DWxP.js";import{u as ee}from"./useSuspenseQuery-13TuSADp.js";import{F as se}from"./formatted-date-DzIPJwiH.js";import{C as re}from"./confirmation-dialog-DVMbD2S1.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-current-date-time-BhbL04rR.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./normalized-model-field-8T9JWy8W.js";import"./Edit-BRVJ8AkN.js";import"./skeleton-BmWW5Jc-.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";function ae({multiple:s=!1,endpoint:r="normalized-models/user"}){var y;const{close:a}=N(),[o,p]=h.useState(""),{trans:m}=P(),c=Z(r,{query:o,perPage:14}),u=((y=c.data)==null?void 0:y.results)||[],[i,n]=h.useState([]),w=e.jsx(E,{className:"pt-20",size:"sm",title:e.jsx(t,{message:"No matching users"}),description:e.jsx(t,{message:"Try another search query"}),image:e.jsx(Q,{src:v})});return e.jsxs(A,{size:"lg",children:[e.jsx(R,{children:s?e.jsx(t,{message:"Select users"}):e.jsx(t,{message:"Select a user"})}),e.jsxs(F,{children:[e.jsx(k,{autoFocus:!0,size:"sm",className:"mb-20",startAdornment:e.jsx(q,{}),placeholder:m(j("Search for user by name or email")),value:o,onChange:d=>{p(d.target.value)}}),!c.isLoading&&!u.length&&w,e.jsx("div",{className:"grid grid-cols-2 gap-x-10",children:u.map(d=>e.jsx(te,{isSelected:!!i.find(l=>l.id===d.id),user:d,onSelected:l=>{s?i.find(x=>x.id===l.id)?n(i.filter(x=>x.id!==l.id)):n([...i,l]):a(l)}},d.id))})]}),s&&e.jsxs(X,{children:[e.jsx(g,{onClick:()=>a(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>a(i),disabled:!i.length,children:e.jsx(t,{message:"Select"})})]})]})}function te({user:s,onSelected:r,isSelected:a}){return e.jsxs("div",{className:z("flex items-center gap-10 rounded-panel border-1 p-10 outline-none ring-offset-4 focus-visible:ring",a?"border-primary bg-primary/5 hover:bg-primary/10":"border-transparent hover:bg-hover"),role:"button",tabIndex:0,onClick:()=>{r(s)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),r(s))},children:[e.jsx(K,{src:s.image,label:s.name??"Visitor",circle:!0}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.name??e.jsx(t,{message:"Visitor"})}),e.jsx("div",{className:"overflow-hidden text-ellipsis text-muted",children:s.description})]})]},s.id)}function oe(s){return b({mutationFn:({userIds:r})=>ie({userIds:r,roleId:s.id}),onSuccess:(r,a)=>{D(j("Assigned [one 1 user|other :count users] to :role",{values:{count:a.userIds.length,role:s.name}}))},onError:r=>S(r)})}function ie({roleId:s,userIds:r}){return I.post(`roles/${s}/add-users`,{userIds:r}).then(a=>a.data)}function ne(s){return b({mutationFn:({userIds:r})=>le({userIds:r,roleId:s.id}),onSuccess:(r,a)=>{D(j("Removed [one 1 user|other :count users] from “{role}“",{values:{count:a.userIds.length,role:s.name}}))},onError:r=>S(r)})}function le({roleId:s,userIds:r}){return I.post(`roles/${s}/remove-users`,{userIds:r}).then(a=>a.data)}const me=[{key:"email",allowsSorting:!0,sortingKey:"email",visibleInMode:"all",header:()=>e.jsx(t,{message:"User"}),body:s=>e.jsx(_,{image:s.image,label:s.name??e.jsx(t,{message:"Visitor"}),description:s.email,alwaysShowAvatar:!0,avatarLabel:"Visitor"})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(t,{message:"Assigned at"}),body:s=>e.jsx(se,{date:s.created_at})}];function as(){const{roleId:s}=Y(["roleId"]),r=ee(f.roles.get(s));return r.data.role.guests||r.data.role.type==="workspace"?e.jsx("div",{className:"pb-10 pt-30",children:e.jsx(U,{image:v,title:e.jsx(t,{message:"Users can't be assigned to this role"})})}):e.jsx(de,{role:r.data.role})}function de({role:s}){const[r,a]=h.useState([]),{searchParams:o,sortDescriptor:p,mergeIntoSearchParams:m,setSearchQuery:c,isFiltering:u}=$(M),i=H({...f.users.index({...o,roleId:`${s.id}`}),placeholderData:V});return e.jsxs("div",{children:[e.jsx(L,{query:i}),e.jsx(G,{searchValue:o.query,onSearchChange:c,actions:e.jsx(ce,{role:s}),selectedItems:r,selectedActions:e.jsx(ue,{role:s,selectedIds:r})}),e.jsxs(J,{children:[e.jsx(O,{columns:me,data:i.items,sortDescriptor:p,onSortChange:m,enableSelection:!0,selectedRows:r,onSelectionChange:n=>a(n)}),i.isEmpty?e.jsx(U,{image:v,isFiltering:u,title:e.jsx(t,{message:"No users have been assigned to this role yet"}),filteringTitle:e.jsx(t,{message:"No matching users"})}):null,e.jsx(B,{query:i,onPageChange:n=>m({page:n}),onPerPageChange:n=>m({perPage:n})})]})]})}function ce({role:s}){const r=oe(s);return e.jsxs(C,{type:"modal",onClose:a=>{a&&r.mutate({userIds:[a.id]},{onSuccess:()=>{T.invalidateQueries({queryKey:W("users",{roleId:`${s.id}`})})}})},children:[e.jsx(g,{variant:"flat",color:"primary",disabled:r.isPending,children:e.jsx(t,{message:"Assign user"})}),e.jsx(ae,{})]})}function ue({role:s,selectedIds:r}){const a=ne(s);return e.jsxs(C,{type:"modal",onClose:o=>{o&&a.mutate({userIds:r},{onSuccess:()=>{T.invalidateQueries({queryKey:f.users.invalidateKey})}})},children:[e.jsx(g,{variant:"flat",color:"danger",disabled:a.isPending,children:e.jsx(t,{message:"Remove users"})}),e.jsx(re,{title:e.jsx(t,{message:"Remove users from role?"}),body:e.jsx(t,{message:"This will permanently remove the users from this role."}),confirm:e.jsx(t,{message:"Remove"}),isDanger:!0})]})}export{as as Component,ue as RemoveUsersAction};
