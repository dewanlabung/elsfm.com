import{r as b,j as f,z as le,d as I,A as ce,o as de,ca as _,cb as ue,c as fe,av as J,b_ as T,aP as Q,b8 as he,am as be}from"./main-CUJEGI8U.js";import{C as X}from"./checkbox-suk8vW77.js";import{S as xe}from"./skeleton-BmWW5Jc-.js";import{A as ge}from"./ArrowDownward-BHYKFIfy.js";import{$ as pe}from"./useInteractOutside-BFJZ3Z5N.js";import{i as G,a as me}from"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import{u as we}from"./use-pointer-events-DcvSqvAc.js";const S=b.createContext(null),ye={key:"checkbox",header:()=>f.jsx(ke,{}),align:"center",width:"w-24 flex-shrink-0",body:(e,t)=>t.isPlaceholder?f.jsx(xe,{size:"w-24 h-24",variant:"rect"}):f.jsx(ve,{item:e})};function ve({item:e}){const{selectedRows:t,toggleRow:r}=b.useContext(S);return f.jsx(X,{checked:t.includes(e.id),onChange:()=>r(e)})}function ke(){const{trans:e}=le(),{data:t,selectedRows:r,onSelectionChange:s}=b.useContext(S),n=!!t.length&&t.length===r.length,o=!n&&!!r.length;return f.jsx(X,{"aria-label":e({message:"Select all"}),isIndeterminate:o,checked:n,onChange:()=>{s(n?[]:t.map(d=>d.id))}})}function Y({index:e,isHeader:t}){const{columns:r,cellHeight:s="h-50",headerCellHeight:n="h-46",tableStyle:o}=b.useContext(S),d=e===0,h=r.length-1===e,i=r[e],a=t?n:s;return o==="flex"?je(i,a):Ce(i,d,h,a)}function Ce(e,t,r,s){let n=e==null?void 0:e.padding;return n||(t?n="pl-16 pr-12":r?n="pr-16 pl-12":n="px-12"),I("overflow-hidden whitespace-nowrap outline-none focus-visible:outline focus-visible:outline-offset-2 text-left",s,e==null?void 0:e.maxWidth,e==null?void 0:e.width,n,e==null?void 0:e.className)}function je(e,t){let r="justify-start";(e==null?void 0:e.align)==="center"?r="justify-center":(e==null?void 0:e.align)==="end"&&(r="justify-end");const s=e==null?void 0:e.padding;return I("flex items-center overflow-hidden whitespace-nowrap overflow-ellipsis outline-none focus-visible:outline focus-visible:outline-offset-2",t,(e==null?void 0:e.width)??"flex-1",e==null?void 0:e.maxWidth,e==null?void 0:e.minWidth,r,s,e==null?void 0:e.className)}function Pe({index:e}){const{columns:t,sortDescriptor:r,onSortChange:s,enableSorting:n,tableStyle:o}=b.useContext(S),d=t[e],h=Y({index:e,isHeader:!0}),[i,a]=b.useState(!1),m=d.sortingKey||d.key,u=d.allowsSorting&&n,{orderBy:C,orderDir:y}=r||{},v=u&&C===m;let g;v&&y==="asc"?g="ascending":v&&y==="desc"?g="descending":u&&(g="none");const p=()=>{if(!u)return;let w;v&&y==="desc"?w={orderDir:"asc",orderBy:m}:v&&y==="asc"?w={orderBy:void 0,orderDir:void 0}:w={orderDir:"desc",orderBy:m},s==null||s(w)},j=v||i,D={visible:{opacity:1,y:0},hidden:{opacity:0,y:"-25%"}},E=o==="html"?"th":"div";return f.jsxs(E,{role:"columnheader",tabIndex:-1,"aria-colindex":e+1,"aria-sort":g,className:I(h,"text-xs font-medium text-muted",u&&"cursor-pointer"),onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},onKeyDown:w=>{(w.key===" "||w.key==="Enter")&&(w.preventDefault(),p())},onClick:p,children:[d.hideHeader?f.jsx("div",{className:"opacity-0",children:d.header()}):d.header(),f.jsx(ce,{children:u&&f.jsx(de.span,{variants:D,animate:j?"visible":"hidden",initial:!1,transition:{type:"tween"},className:"-mt-2 ml-6 inline-block","data-testid":"table-sort-button","aria-hidden":!j,children:f.jsx(ge,{size:"xs",className:I("text-muted",y==="asc"&&C===m&&"rotate-180 transition-transform")})},"sort-icon")})]})}function Se(){const{columns:e,tableStyle:t,headerRowBg:r}=b.useContext(S),s=t==="html"?"thead":b.Fragment,n=t==="html"?"tr":"div";return f.jsx(s,{children:f.jsx(n,{role:"row","aria-rowindex":1,tabIndex:-1,className:I(t==="flex"&&"flex gap-x-16 px-16",r),children:e.map((o,d)=>f.jsx(Pe,{index:d},o.key))})})}function De(e){const{cellCount:t,rowCount:r}=e;return{onKeyDown:n=>{switch(n.key){case"ArrowLeft":P(n,{cell:{op:"decrement"}},e);break;case"ArrowRight":P(n,{cell:{op:"increment"}},e);break;case"ArrowUp":P(n,{row:{op:"decrement"}},e);break;case"ArrowDown":P(n,{row:{op:"increment"}},e);break;case"PageUp":P(n,{row:{op:"decrement",count:5}},e);break;case"PageDown":P(n,{row:{op:"increment",count:5}},e);break;case"Tab":Ee(n);break;case"Home":G(n)?P(n,{row:{op:"decrement",count:r},cell:{op:"decrement",count:t}},e):P(n,{cell:{op:"decrement",count:t}},e);break;case"End":G(n)?P(n,{row:{op:"increment",count:r},cell:{op:"increment",count:t}},e):P(n,{cell:{op:"increment",count:t}},e);break}}}}function P(e,t,{cellCount:r,rowCount:s}){var v,g,p,j,D,E,w;if(((v=document.activeElement)==null?void 0:v.tagName)==="input")return;e.preventDefault();const n=e.currentTarget,o=e.target.closest("[aria-colindex]");if(!o||!n)return;const d=o.closest("[aria-rowindex]");if(!d)return;let h=parseInt(d.getAttribute("aria-rowindex")),i=parseInt(o.getAttribute("aria-colindex"));if(Number.isNaN(h)||Number.isNaN(i))return;const a=((g=t.row)==null?void 0:g.count)??1;((p=t.row)==null?void 0:p.op)==="increment"?h=Math.min(s,h+a):((j=t.row)==null?void 0:j.op)==="decrement"&&(h=Math.max(1,h-a));const m=((D=t.cell)==null?void 0:D.count)??1;((E=t.cell)==null?void 0:E.op)==="increment"?i=Math.min(r,i+m):((w=t.cell)==null?void 0:w.op)==="decrement"&&(i=Math.max(1,i-m));const u=n.querySelector(`[aria-rowindex="${h}"] [aria-colindex="${i}"]`);if(!u)return;const y=_(u).nextNode()||u;o.setAttribute("tabindex","-1"),y.setAttribute("tabindex","0"),y.focus()}function Ee(e){const t=e.currentTarget;if(e.shiftKey)t.focus();else{const r=_(t,{tabbable:!0});let s,n;do n=r.lastChild(),n&&(s=n);while(n);s&&!s.contains(document.activeElement)&&ue(s)}}function $e({index:e,isSelected:t,isHeader:r}){const s=fe(),n=J(),{hideBorder:o,hideHeaderBorder:d,enableSelection:h,collapseOnMobile:i,onAction:a,isCollapsedMode:m,tableStyle:u}=b.useContext(S);return I(u==="flex"&&"flex gap-x-16","break-inside-avoid outline-none border border-transparent",m&&"rounded-panel",a&&"cursor-pointer",n&&i&&o?"mb-8 pl-8 pr-0 rounded":"px-16",!o&&"border-b-divider",!(d??o)&&e===0&&"border-t-divider",t&&!s&&"bg-primary/selected hover:bg-primary/focus focus-visible:bg-primary/focus",t&&s&&"bg-selected hover:bg-focus focus-visible:bg-focus",!t&&!r&&(h||a)&&"focus-visible:bg-focus hover:bg-hover")}function He({rowIndex:e,rowIsHovered:t,index:r,item:s,id:n}){const{columns:o,tableStyle:d}=b.useContext(S),h=o[r],i=b.useMemo(()=>({index:e,isHovered:t,isPlaceholder:s.isPlaceholder}),[e,t,s.isPlaceholder]),a=Y({index:r,isHeader:!1}),m=d==="html"?"td":"div";let u=h.body(s,i);return i.isPlaceholder||(u=f.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis",children:u})),f.jsx(m,{tabIndex:-1,role:"gridcell","aria-colindex":r+1,id:n,className:a,children:u})}const Ie=["button","a","input","select","textarea"];function Me({item:e,index:t,renderAs:r,className:s,style:n}){const{selectedRows:o,columns:d,toggleRow:h,selectRow:i,onAction:a,selectRowOnContextMenu:m,enableSelection:u,selectionStyle:C,hideHeaderRow:y,tableStyle:v}=b.useContext(S),g=b.useRef(!1),p=o.includes(e.id),[j,D]=b.useState(!1),E=l=>l.target.closest(Ie.join(",")),w=l=>{C==="highlight"&&a&&!g.current&&!E(l)&&(l.preventDefault(),l.stopPropagation(),a(e,t))},A=!!o.length,M=l=>{E(l)||(C==="checkbox"?u&&(A||!a)?h(e):a&&a(e,t):C==="highlight"&&(g.current?u&&A?h(e):a==null||a(e,t):u&&i(e,me(l))))},{domProps:O}=we({onPointerDown:l=>{g.current=l.pointerType==="touch"},onPress:M,onLongPress:u?()=>{g.current&&h(e)}:void 0}),F=l=>{u&&l.key===" "?(l.preventDefault(),l.stopPropagation(),C==="checkbox"?h(e):i(e)):l.key==="Enter"&&!o.length&&a&&(l.preventDefault(),l.stopPropagation(),a(e,t))},L=l=>{m&&u&&(o.includes(e.id)||i(e)),g.current&&(l.preventDefault(),l.stopPropagation())},V=$e({index:t,isSelected:p}),B=r||(v==="html"?"tr":"div");return f.jsx(B,{role:"row","aria-rowindex":t+1+(y?0:1),"aria-selected":p,tabIndex:-1,className:I(s,V),item:typeof B=="string"?void 0:e,onDoubleClick:T(w),onKeyDown:T(F),onContextMenu:T(L),onPointerEnter:T(()=>D(!0)),onPointerLeave:T(()=>D(!1)),style:n,...O,children:d.map((l,W)=>f.jsx(He,{rowIndex:t,rowIsHovered:j,index:W,item:e},`${e.id}-${l.key}`))})}function Le({className:e,columns:t,activeColumns:r,collapseOnMobile:s=!0,hideHeaderRow:n=!1,hideHeaderBorder:o=null,headerRowBg:d,hideBorder:h=!1,data:i,selectedRows:a,defaultSelectedRows:m,onSelectionChange:u,sortDescriptor:C,onSortChange:y,enableSorting:v=!0,onDelete:g,enableSelection:p=!0,selectionStyle:j="checkbox",ariaLabelledBy:D,selectRowOnContextMenu:E,onAction:w,renderRowAs:A,tableBody:M,meta:O,tableRef:F,closeOnInteractOutside:L=!1,cellHeight:V,headerCellHeight:B,tableStyle:l="flex",...W}){const z=J(),R=!!z&&s;R&&(n=!0,h=!0);const[x,H]=Q(a,m||[],u),[Z,ee]=Q(C,void 0,y),te=b.useCallback(c=>{const k=[...x];if(!k.includes(c.id))k.push(c.id);else{const $=k.indexOf(c.id);k.splice($,1)}H(k)},[x,H]),ne=b.useCallback((c,k)=>{let $=[];c&&($=k?[...x==null?void 0:x.filter(N=>N!==c.id),c.id]:[c.id]),H($)},[x,H]),K=b.useMemo(()=>{const c=t.filter($=>{if(r&&!r.includes($.key))return!1;const N=$.visibleInMode||"regular";if(N==="all"||N==="compact"&&R||N==="regular"&&!R)return!0});return r&&c.sort(($,N)=>{const ie=r.indexOf($.key),ae=r.indexOf(N.key);return ie-ae}),p&&j!=="highlight"&&!z&&c.unshift(ye),c},[z,t,p,j,R,r]),re={isCollapsedMode:R,cellHeight:V,headerCellHeight:B,hideHeaderBorder:o,headerRowBg:d,hideBorder:h,hideHeaderRow:n,selectedRows:x,onSelectionChange:H,enableSorting:v,enableSelection:p,selectionStyle:j,data:i,columns:K,sortDescriptor:Z,onSortChange:ee,toggleRow:te,selectRow:ne,onAction:w,selectRowOnContextMenu:E,meta:O,collapseOnMobile:s,tableStyle:l},se=De({cellCount:p?K.length+1:K.length,rowCount:i.length+1}),U={renderRowAs:A};M?M=b.cloneElement(M,U):M=f.jsx(Ne,{...U});const q=he(F);pe({ref:q,onInteractOutside:c=>{L&&p&&(x!=null&&x.length)&&!c.target.closest('[role="dialog"]')&&H([])}});const oe=l==="html"?"table":"div";return f.jsx(S.Provider,{value:re,children:f.jsxs(oe,{...be(W,se,{onKeyDown:c=>{c.key==="Escape"?(c.preventDefault(),c.stopPropagation(),x!=null&&x.length&&H([])):c.key==="Delete"?(c.preventDefault(),c.stopPropagation(),x!=null&&x.length&&(g==null||g(i.filter(k=>x==null?void 0:x.includes(k.id))))):G(c)&&c.key==="a"&&(c.preventDefault(),c.stopPropagation(),p&&H(i.map(k=>k.id)))}}),tabIndex:0,role:"grid","aria-rowcount":i.length+1,"aria-colcount":K.length+1,ref:q,"aria-multiselectable":p?!0:void 0,"aria-labelledby":D,className:I(e,"isolate w-full select-none text-sm outline-none focus-visible:ring-2"),children:[!n&&f.jsx(Se,{}),M]})})}function Ne({renderRowAs:e}){const{data:t,tableStyle:r}=b.useContext(S),s=r==="html"?"tbody":b.Fragment;return f.jsx(s,{children:t.map((n,o)=>f.jsx(Me,{item:n,index:o,renderAs:e},n.id))})}export{Le as T,S as a,Me as b};
