import{j as e,as as N,a3 as k,T as a,V as S,z as y,G as u,ag as G,I as p,J as l,aa as g,b as x,$ as f,M as C,a0 as w,a1 as v,a2 as P,t as m,H as T,u as q,r as I,at as _,S as Q,ab as H,D as b,W as B}from"./main-CUJEGI8U.js";import{D as E}from"./dialog-footer-jZcc-BBM.js";import{F as U}from"./image-selector-GLpYAkj6.js";import{F as K}from"./file-upload-provider-DWaB2xE4.js";import{D}from"./paginated-resources-BDxg6DLi.js";import{c as L,u as M}from"./timestamp-filters-DydeeDDl.js";import{G as W}from"./genre-B_3ZyEC1.js";import{G as R}from"./genre-link-DnbOgUf-.js";import{u as V,a as $,G as z,D as J,b as O,c as X}from"./use-datatable-query-D9uebfzx.js";import{N as Y}from"./name-with-avatar-CpbvmPVO.js";import{D as Z}from"./data-table-add-item-button-_qDHIKil.js";import{D as ee}from"./datatable-filters-DFYg3QEK.js";import{a as te,D as ae,b as se,c as re}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as ie}from"./table-CgoYghfp.js";import{F as oe}from"./formatted-date-DzIPJwiH.js";import{F as ne}from"./formatted-number-gsF1qEbc.js";import{E as me}from"./Edit-BRVJ8AkN.js";import{C as le}from"./confirmation-dialog-DVMbD2S1.js";import{G as de}from"./music-Bh2SQVZ2.js";import"./use-active-upload-BwzDBsep.js";import"./open-upload-window-CboR35vP.js";import"./uploaded-file-ksxfN_l-.js";import"./extension-from-filename-O0XMuZye.js";import"./AddAPhoto-y5pGVyq2.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./traditional-BcYcLesO.js";import"./normalized-model-field-8T9JWy8W.js";import"./use-normalized-models-ClA2DWxP.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./skeleton-BmWW5Jc-.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./input-DAWJLQiY.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-current-date-time-BhbL04rR.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./form-chip-field-ehb7ckkp.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./DateRange-Bhvye4F9.js";import"./Add-B3RL66ee.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";function A({form:t,onSubmit:s,formId:r}){return e.jsxs(N,{id:r,form:t,onSubmit:s,children:[e.jsx(K,{children:e.jsx(U,{name:"image",uploadType:k.artwork,variant:"input",label:e.jsx(a,{message:"Image"}),className:"mb-24"})}),e.jsx(S,{name:"name",label:e.jsx(a,{message:"Name"}),description:e.jsx(a,{message:"Unique genre identifier."}),className:"mb-24",required:!0,autoFocus:!0}),e.jsx(S,{name:"display_name",label:e.jsx(a,{message:"Display name"}),description:e.jsx(a,{message:"User friendly genre name."})})]})}function ce(t){const{trans:s}=y();return u({mutationFn:r=>ue(r),onSuccess:()=>{p(s(l("Genre created"))),g.invalidateQueries({queryKey:D("genres")})},onError:r=>G(r,t)})}function ue(t){return x.post("genres",t).then(s=>s.data)}function pe(){const{close:t,formId:s}=f(),r=C(),i=ce(r);return e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(a,{message:"Create new genre"})}),e.jsx(P,{children:e.jsx(A,{formId:s,form:r,onSubmit:o=>{i.mutate(o,{onSuccess:()=>t()})}})}),e.jsxs(E,{children:[e.jsx(m,{onClick:()=>t(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(m,{form:s,disabled:i.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(a,{message:"Create"})})]})]})}const F=[L({description:l("Date genre was created")}),M({description:l("Date genre was last updated")})];function ge(){const{trans:t}=y();return u({mutationFn:s=>xe(s),onSuccess:()=>{p(t(l("Artists imported"))),g.invalidateQueries({queryKey:D("genres")})},onError:s=>T(s)})}function xe(t){return x.post("import-media/single-item",{modelType:W,genreId:t.genre.id}).then(s=>s.data)}function je(t){const{trans:s}=y();return u({mutationFn:r=>he(r),onSuccess:()=>{p(s(l("Genre updated"))),g.invalidateQueries({queryKey:D("genres")})},onError:r=>G(r,t)})}function he({id:t,...s}){return x.put(`genres/${t}`,s).then(r=>r.data)}function ye({genre:t}){const{spotify_is_setup:s,spotify_use_deprecated_api:r}=q(),{close:i,formId:o}=f(),d=C({defaultValues:{id:t.id,name:t.name,display_name:t.display_name,image:t.image??""}}),c=je(d),n=ge();return e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(a,{message:"Update “:name“ genre",values:{name:t.name}})}),e.jsx(P,{children:e.jsx(A,{formId:o,form:d,onSubmit:j=>{c.mutate(j,{onSuccess:()=>{i()}})}})}),e.jsxs(E,{startAction:s&&r&&e.jsx(m,{variant:"outline",onClick:()=>n.mutate({genre:t},{onSuccess:()=>i()}),disabled:n.isPending,children:e.jsx(a,{message:"Import artists"})}),children:[e.jsx(m,{onClick:()=>i(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(m,{form:o,disabled:c.isPending,variant:"flat",color:"primary",type:"submit",children:e.jsx(a,{message:"Save"})})]})]})}const fe=[{key:"name",allowsSorting:!0,visibleInMode:"all",width:"flex-3 min-w-200",header:()=>e.jsx(a,{message:"Genre"}),body:t=>e.jsx(Y,{image:t.image,label:e.jsx(R,{genre:t})})},{key:"display_name",allowsSorting:!0,header:()=>e.jsx(a,{message:"Display name"}),body:t=>t.display_name||t.name},{key:"artists_count",allowsSorting:!0,header:()=>e.jsx(a,{message:"Number of artists"}),body:t=>t.artists_count?e.jsx(ne,{value:t.artists_count}):null},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>e.jsx(oe,{date:t.updated_at})},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,align:"end",visibleInMode:"all",width:"w-42 flex-shrink-0",body:t=>e.jsxs(b,{type:"modal",children:[e.jsx(B,{size:"md",className:"text-muted",children:e.jsx(me,{})}),e.jsx(ye,{genre:t})]})}];function vt(){const[t,s]=I.useState([]),{searchParams:r,sortDescriptor:i,mergeIntoSearchParams:o,setSearchQuery:d,isFiltering:c}=V(H),n=$(_.genres.index({...r,withCount:"artists"})),j=e.jsxs(b,{type:"modal",children:[e.jsx(m,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(De,{selectedIds:t,onDelete:()=>s([])})]});return e.jsxs(te,{children:[e.jsx(z,{query:n}),e.jsx(Q,{children:e.jsx(a,{message:"Genres"})}),e.jsx(ae,{title:e.jsx(a,{message:"Genres"}),showSidebarToggleButton:!0}),e.jsxs(se,{children:[e.jsx(J,{searchValue:r.query,onSearchChange:d,actions:e.jsx(be,{}),selectedItems:t,selectedActions:j,filters:F}),e.jsx(ee,{filters:F}),e.jsxs(re,{children:[e.jsx(ie,{columns:fe,data:n.items,sortDescriptor:i,onSortChange:o,enableSelection:!0,selectedRows:t,onSelectionChange:s}),n.isEmpty&&e.jsx(O,{isFiltering:c,image:de,title:e.jsx(a,{message:"No genres have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching genres"})}),e.jsx(X,{query:n,onPageChange:h=>o({page:h}),onPerPageChange:h=>o({perPage:h})})]})]})]})}function be(){return e.jsx(I.Fragment,{children:e.jsxs(b,{type:"modal",children:[e.jsx(Z,{children:e.jsx(a,{message:"Add new genre"})}),e.jsx(pe,{})]})})}function De({selectedIds:t,onDelete:s}){const{close:r}=f(),i=u({mutationFn:()=>x.delete(`genres/${t.join(",")}`),onSuccess:async()=>{await g.invalidateQueries({queryKey:_.genres.invalidateKey}),p(l("Genres deleted")),s(),r()},onError:o=>T(o)});return e.jsx(le,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete genres"}),body:e.jsx(a,{message:"Are you sure you want to delete selected genres?",values:{count:t.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{vt as Component};
