import{M as z,j as e,T as n,t as _,P as M,r as d,Q as j,G as oe,H as ce,b as W,I as E,J as b,V as h,d as le,ak as de,ax as ue,aF as H,c$ as me,bU as I,d0 as X,z as Y,as as Z,a9 as V,ag as pe,u as $,a as xe,E as he,v as ge,_ as je,X as fe}from"./main-CUJEGI8U.js";import{a as P}from"./admin-config-DTFkVWJm.js";import{S as D}from"./settings-error-group-DuMk4d-9.js";import{A as U,B as ee}from"./settings-layout-KPbHCtKd.js";import{D as R}from"./settings-links-6v3CjZ6H.js";import{S as q}from"./settings-panel-CAOxmD0t.js";import{u as y}from"./use-admin-settings-CWPhg6hD.js";import{S as se}from"./section-helper-Dtpb8UEn.js";import{F as L}from"./select-Z9R0wV6S.js";import{C as ve}from"./check-circle-filled-BwqtgJPU.js";import{D as te}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{O as B}from"./OpenInNew-BW4EtK-8.js";import{E as be}from"./external-link-jlnQ3iTs.js";import{B as _e}from"./BrowserUpdated-DI02lxXN.js";import{u as ye}from"./uc-first-pSl3nM3z.js";import{T as Se,a as we,b as ke}from"./tabs-BVjOaE7L.js";import"./Album-pwm22nnR.js";import"./Comment-vFUyF-gf.js";import"./FileUpload-CTBOdaGq.js";import"./Mic-DAPkQZuC.js";import"./PlaylistPlay-DcgxbGJx.js";import"./QueueMusic-CiX-EN5z.js";import"./Sell-D56iqjs7.js";import"./middleware-BLXTWOs6.js";import"./use-admin-settings-page-nav-config-C00ols9x.js";import"./file-upload-provider-DWaB2xE4.js";import"./uploaded-file-ksxfN_l-.js";import"./extension-from-filename-O0XMuZye.js";import"./pretty-bytes-bO14ePu9.js";import"./traditional-BcYcLesO.js";import"./confirmation-dialog-DVMbD2S1.js";import"./dialog-footer-jZcc-BBM.js";import"./useSuspenseQuery-13TuSADp.js";import"./combobox-end-adornment-B0xReOuL.js";import"./dashboard-layout-context-DeTNv3yG.js";function Ne({tabs:s,title:t}){const{data:r}=y(),a=z({defaultValues:{server:{cache_store:r.server.cache_store??"file",memcached_host:r.server.memcached_host??"",memcached_port:r.server.memcached_port??""}}});return e.jsxs(U,{form:a,title:t,tabs:s,children:[e.jsx(Pe,{}),e.jsx(Ce,{})]})}function Pe(){return e.jsxs(q,{className:"mb-24",title:e.jsx(n,{message:"Cache Provider"}),description:e.jsx(n,{message:"Configure which method should be used for storing and retrieving cached items."}),link:P.settings.cache?e.jsx(R,{link:P.settings.cache}):void 0,children:[e.jsx(qe,{}),e.jsx(se,{size:"sm",color:"warning",className:"mt-12",description:e.jsx(n,{message:'"File" is a good default, but other providers can provide better peformance, however they require extra setup on the server.'})})]})}function Ce(){const s=Te();return e.jsx(q,{title:e.jsx(n,{message:"Clear Cache"}),description:e.jsx(n,{message:"Clear application cache if you're experiencing issues with stale data."}),children:e.jsx(_,{type:"button",variant:"outline",size:"xs",color:"primary",disabled:s.isPending,onClick:()=>s.mutate(),children:e.jsx(n,{message:"Clear cache"})})})}function qe(){const{watch:s,clearErrors:t}=M(),r=s("server.cache_store");let a=null;return r==="memcached"&&(a=Fe),e.jsx(D,{separatorTop:!1,separatorBottom:!1,name:"cache_group",children:i=>e.jsxs(d.Fragment,{children:[e.jsxs(L,{size:"sm",invalid:i,onSelectionChange:()=>t(),selectionMode:"single",name:"server.cache_store",children:[e.jsx(j,{value:"file",children:e.jsx(n,{message:"File (Default)"})}),e.jsx(j,{value:"array",children:e.jsx(n,{message:"None"})}),e.jsx(j,{value:"apc",children:"APC"}),e.jsx(j,{value:"memcached",children:"Memcached"}),e.jsx(j,{value:"redis",children:"Redis"})]}),a&&e.jsx("div",{className:"mt-20",children:e.jsx(a,{isInvalid:i})})]})})}function Fe({isInvalid:s}){return e.jsxs(d.Fragment,{children:[e.jsx(h,{size:"sm",invalid:s,className:"mb-20",name:"server.memcached_host",label:e.jsx(n,{message:"Memcached host"}),required:!0}),e.jsx(h,{size:"sm",invalid:s,type:"number",name:"server.memcached_port",label:e.jsx(n,{message:"Memcached port"}),required:!0})]})}function Te(){return oe({mutationFn:()=>W.post("cache/flush").then(s=>s.data),onSuccess:()=>{E(b("Cache cleared"))},onError:s=>ce(s)})}const f={Preparing:"preparing",Downloading:"downloading",Extracting:"extracting",MovingNewFiles:"moving_new_files",Finalizing:"finalizing"},ze={[f.Preparing]:"Preparing to update",[f.Downloading]:"Downloading update",[f.Extracting]:"Extracting update",[f.MovingNewFiles]:"Copying new files",[f.Finalizing]:"Finalizing update"},w={Active:"active",Completed:"completed",Failed:"failed"};function re({event:s}){var t;return e.jsxs("div",{className:le(s.status===w.Completed&&"opacity-50"),children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(Ae,{event:s}),e.jsx("div",{children:s.message})]}),(t=s.context)!=null&&t.error?e.jsxs("div",{className:"mt-2 break-words text-sm text-danger",children:[e.jsx(n,{message:"Update failed:"})," ",s.context.error]}):null]})}function Ae({event:s}){var t,r;switch(s.status){case w.Active:return e.jsx(ue,{isIndeterminate:!((t=s.context)!=null&&t.progressPercentage),size:"w-24 h-24",value:(r=s.context)==null?void 0:r.progressPercentage});case w.Completed:return e.jsx(ve,{className:"text-positive"});case w.Failed:return e.jsx(de,{className:"text-danger"})}}function Ie(s,t,r){const a={...me(),Accept:"text/event-stream","Content-Type":"application/json","X-CSRF-TOKEN":H().csrf_token};return fetch(`${H().settings.base_url}/api/v1/${s}`,{method:"POST",headers:a,body:t?JSON.stringify(t):void 0,signal:r})}class G extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function Q(s){}function Ee(s){if(typeof s=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Q,onError:r=Q,onRetry:a=Q,onComment:i}=s;let c="",o=!0,u,p="",v="";function k(l){const x=o?l.replace(/^\xEF\xBB\xBF/,""):l,[S,T]=Me(`${c}${x}`);for(const O of S)N(O);c=T,o=!1}function N(l){if(l===""){C();return}if(l.startsWith(":")){i&&i(l.slice(l.startsWith(": ")?2:1));return}const x=l.indexOf(":");if(x!==-1){const S=l.slice(0,x),T=l[x+1]===" "?2:1,O=l.slice(x+T);F(S,O,l);return}F(l,"",l)}function F(l,x,S){switch(l){case"event":v=x;break;case"data":p=`${p}${x}
`;break;case"id":u=x.includes("\0")?void 0:x;break;case"retry":/^\d+$/.test(x)?a(parseInt(x,10)):r(new G(`Invalid \`retry\` value: "${x}"`,{type:"invalid-retry",value:x,line:S}));break;default:r(new G(`Unknown field "${l.length>20?`${l.slice(0,20)}â€¦`:l}"`,{type:"unknown-field",field:l,value:x,line:S}));break}}function C(){p.length>0&&t({id:u,event:v||void 0,data:p.endsWith(`
`)?p.slice(0,-1):p}),u=void 0,p="",v=""}function g(l={}){c&&l.consume&&N(c),o=!0,u=void 0,p="",v="",c=""}return{feed:k,reset:g}}function Me(s){const t=[];let r="",a=0;for(;a<s.length;){const i=s.indexOf("\r",a),c=s.indexOf(`
`,a);let o=-1;if(i!==-1&&c!==-1?o=Math.min(i,c):i!==-1?i===s.length-1?o=-1:o=i:c!==-1&&(o=c),o===-1){r=s.slice(a);break}else{const u=s.slice(a,o);t.push(u),a=o+1,s[a-1]==="\r"&&s[a]===`
`&&a++}}return[t,r]}class De extends TransformStream{constructor({onError:t,onRetry:r,onComment:a}={}){let i;super({start(c){i=Ee({onEvent:o=>{c.enqueue(o)},onError(o){t==="terminate"?c.error(o):typeof t=="function"&&t(o)},onRetry:r,onComment:a})},transform(c){i.feed(c)}})}}const Ue="An unknown error occurred during update",Re=[[f.Preparing],[f.Downloading],[f.Extracting],[f.MovingNewFiles],[f.Finalizing]];let m=[];const J=()=>m.some(s=>s.status===w.Failed),A=d.createContext(null);function ae({children:s}){const{data:t}=y(),r=Object.entries((t==null?void 0:t.modules)??{}).filter(([,g])=>!g.built_in&&g.installed&&g.envato_purchase_code).map(([g])=>g),[a,i]=d.useState(!1),[c,o]=d.useState(!1),[u,p]=d.useState([]),[v,k]=d.useState(null),N=async g=>{i(!0),o(!0),k(g);const l=await C(g);return I.flushSync(()=>o(!1)),l},F=async()=>{i(!0),o(!0);const g=["app",...r];for(const l of g)if(k(l),!await C(l))return I.flushSync(()=>o(!1)),!1;return I.flushSync(()=>o(!1)),!0},C=async g=>{m=[],p([]);for(const l of Re){if(J())break;await Le({steps:l,moduleName:g,onEvent:()=>p(m)})}return!J()};return e.jsx(A.Provider,{value:{updateInProgress:c,updateStarted:a,setUpdateStarted:i,events:u,updateOrInstallModule:N,updateAppAndModules:F,moduleNames:r,activeModuleName:v},children:s})}async function Le({steps:s,moduleName:t,onEvent:r}){var i,c;const a=new AbortController;m.push({type:"event",step:s[0],status:w.Active,message:ze[s[0]]}),r();try{const o=await Ie("update",{steps:s,moduleName:t},a==null?void 0:a.signal);(!o.ok||!(o!=null&&o.body))&&X();for await(const u of Be(o,a))if(m=((i=m.at(-1))==null?void 0:i.step)===u.step?[...m.slice(0,-1),u]:[...m,u],r(),(c=u.context)!=null&&c.error)break}catch{K(!0)}K()}async function*Be(s,t){if(!s.ok||!s.body)return X();const r=s.body.pipeThrough(new TextDecoderStream).pipeThrough(new De).getReader();for(r.closed.then(()=>t.abort()),t.signal.addEventListener("abort",()=>r.cancel());!t.signal.aborted;){const{done:a,value:i}=await r.read();if(a){t.abort();break}if(!i||!i.event)continue;const c=JSON.parse(i.data);if(c.type==="endStream"){t.abort();break}yield c}}function K(s=!1){var r;if(!s&&m.length&&((r=m.at(-1))==null?void 0:r.status)===w.Completed)return m;m!=null&&m.length||(m=[{type:"event",step:f.Preparing,status:w.Failed,message:"Preparing to update"}]);const t=m.length-1;return m[t].status=w.Failed,m[t].context||(m[t].context={}),m[t].context.error=m[t].context.error||Ue,m}function Oe({tabs:s,title:t,rightContent:r}){return e.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel flex h-full flex-col",children:[e.jsx(te,{title:t,border:"border-none",showSidebarToggleButton:!0,rightContent:r}),s,e.jsx("div",{className:"overflow-y-auto",children:e.jsxs("div",{className:"mx-auto p-12 @container/settings-form md:p-24 lg:max-w-[1440px]",children:[e.jsx(Qe,{}),e.jsx(We,{})]})})]})}function Qe(){var p;const{trans:s}=Y(),{data:t}=y(),[r,a]=d.useState(((p=t.license)==null?void 0:p.purchase_code)??""),i=z({defaultValues:{purchase_code:r??""}}),[c,o]=d.useState(!1),u=async v=>{var N;o(!0);const k=await ne({code:v.purchase_code,form:i,itemId:((N=t.license)==null?void 0:N.item_id)??0});o(!1),k&&(E(b("Purchase code activated")),a(k))};return e.jsx(q,{title:e.jsx(n,{message:"Envato purchase code"}),description:e.jsx(n,{message:"Activate your license to enable automatic updates and other functionality."}),link:e.jsx(_,{variant:"link",color:"primary",size:"sm",href:P.settings.purchaseCode,target:"_blank",children:e.jsx(n,{message:"Where is my purchase code?"})}),children:e.jsxs(Z,{form:i,disableNativeValidation:!0,onSubmit:v=>u(v),children:[e.jsx(h,{name:"purchase_code",label:e.jsx(n,{message:"Envato purchase code"}),labelDisplay:"hidden",placeholder:s(b("Example: :code",{values:{code:"91939276-b234-49d1-ac42-6c7xe5t7a128"}})),endAdornment:e.jsx(V,{size:"xs",color:r?"positive":"danger",className:"mr-12",children:r?e.jsx(n,{message:"ACTIVATED"}):e.jsx(n,{message:"NOT ACTIVATED"})}),required:!0}),e.jsx(_,{variant:"flat",color:"primary",type:"submit",disabled:c,className:"mt-24",children:e.jsx(n,{message:"Activate purchase code"})})]})})}function We(){const{data:s}=y();return!s.modules||!Object.keys(s.modules).length?null:e.jsxs("div",{children:[e.jsx("h2",{className:"mb-12 mt-44 text-lg font-semibold",children:e.jsx(n,{message:"Addon purchase codes"})}),e.jsx("div",{className:"space-y-12",children:Object.entries(s.modules).filter(([,t])=>!t.built_in).map(([t,r])=>e.jsx(ae,{children:e.jsx(Ve,{name:t,config:r})},t))})]})}function Ve({config:s,name:t}){var l,x;const{trans:r}=Y(),{data:a}=y(),i=(x=(l=a.modules)==null?void 0:l[t])==null?void 0:x.envato_item_id,{updateOrInstallModule:c}=d.use(A),[o,u]=d.useState(s.installed),[p,v]=d.useState(s.envato_purchase_code),k=z({defaultValues:{purchase_code:p??""}}),N=async()=>{await c(t)?(I.flushSync(()=>{C(!1),u(!0)}),setTimeout(()=>{window.location.reload()},1e3)):E.danger(b("Failed to install module"))},[F,C]=d.useState(!1),g=async S=>{C(!0);const T=await ne({code:S.purchase_code,form:k,itemId:s.envato_item_id??0,moduleName:t});T&&(v(T),o?E(b("Purchase code activated")):N()),C(!1)};return e.jsxs(q,{id:`module-${t}`,title:s.label,description:e.jsx(n,{message:"Enter purchase code to install this addon."}),link:e.jsx(_,{variant:"link",color:"primary",size:"sm",href:`https://codecanyon.net/item/i/${i}`,target:"_blank",endIcon:e.jsx(B,{}),children:e.jsx(n,{message:"Get this addon"})}),children:[F?e.jsx(ee,{shouldBlock:!0}):null,e.jsxs(Z,{form:k,onSubmit:S=>g(S),children:[e.jsx(h,{required:!0,size:"sm",name:"purchase_code",label:e.jsx(n,{message:"Envato purchase code"}),labelDisplay:"hidden",placeholder:r(b("Example: :code",{values:{code:"91939276-b234-49d1-ac42-6c7xe5t7a128"}})),endAdornment:e.jsx(V,{size:"xs",color:p?"positive":"danger",className:"mr-12",children:p?e.jsx(n,{message:"ACTIVATED"}):e.jsx(n,{message:"NOT ACTIVATED"})})}),e.jsx(_,{variant:"flat",color:"primary",type:"submit",className:"mt-16",size:"xs",disabled:F,children:o?e.jsx(n,{message:"Activate"}):e.jsx(n,{message:"Activate and install"})})]}),e.jsx($e,{onRetry:()=>N(),className:"mt-24 rounded-panel border p-16"})]})}function $e({onRetry:s,className:t}){var c;const{events:r,updateInProgress:a}=d.use(A),i=r.at(-1);return!r.length&&!a?null:e.jsxs("div",{className:t,children:[e.jsx("div",{className:"space-y-18",children:r.map((o,u)=>e.jsx(re,{event:o},u))}),(c=i==null?void 0:i.context)!=null&&c.error?e.jsxs("div",{className:"mt-24 flex items-center gap-12",children:[e.jsx(_,{variant:"flat",color:"primary",onClick:()=>s(),children:e.jsx(n,{message:"Retry"})}),e.jsx(_,{variant:"outline",color:"primary",endIcon:e.jsx(B,{}),children:e.jsx(n,{message:"Update manually"})})]}):null,(i==null?void 0:i.step)===f.Finalizing&&(i==null?void 0:i.status)===w.Completed?e.jsx("div",{className:"mt-24 text-muted",children:e.jsx(n,{message:"Module installed successfully! Reloading the page..."})}):null]})}async function ne({code:s,form:t,itemId:r,moduleName:a}){try{return(await W.post("license/register-purchase-code",{purchase_code:s,item_id:r,module:a})).data.purchase_code}catch(i){pe(i,t)}}function He({tabs:s,title:t}){const{data:r}=y(),a=z({defaultValues:{server:{sentry_dsn:r.server.sentry_dsn??""}}});return e.jsx(U,{form:a,title:t,tabs:s,children:e.jsx(Ge,{})})}function Ge(){const{clearErrors:s}=M();return e.jsx(q,{title:e.jsx(n,{message:"Sentry Integration"}),description:e.jsx(n,{values:{a:t=>e.jsx(be,{href:"https://sentry.io",children:t})},message:"<a>Sentry</a> integration provides real-time error tracking and helps identify and fix issues when site is in production."}),link:P.settings.logging?e.jsx(R,{link:P.settings.logging}):null,children:e.jsx(D,{separatorTop:!1,separatorBottom:!1,name:"logging_group",children:t=>e.jsx(h,{size:"sm",onChange:()=>s(),invalid:t,name:"server.sentry_dsn",type:"url",minLength:30,label:e.jsx(n,{message:"Sentry DSN"})})})})}function Je(){const{site:s}=$();return xe({queryKey:["queue-stats"],queryFn:()=>s.demo?Promise.resolve({status:"running"}):Ke(),refetchInterval:5e3})}function Ke(){return W.get("horizon/api/stats").then(s=>s.data)}function Xe({tabs:s,title:t}){const{data:r}=y(),a=z({defaultValues:{server:{queue_connection:r.server.queue_connection??"sync",aws_access_key_id:r.server.aws_access_key_id??"",aws_secret_access_key:r.server.aws_secret_access_key??"",sqs_prefix:r.server.sqs_prefix??"",sqs_queue:r.server.sqs_queue??"",aws_default_region:r.server.aws_default_region??""}}}),i=a.watch("server.queue_connection");return e.jsxs(U,{form:a,title:t,tabs:s,children:[e.jsx(Ye,{}),i!=="sync"&&e.jsx(Ze,{})]})}function Ye(){const{watch:s,clearErrors:t}=M(),r=s("server.queue_connection");let a=null;return r==="sqs"&&(a=ss),e.jsx(q,{className:"mb-24",title:e.jsx(n,{message:"Queue Method"}),description:e.jsx(n,{message:"Queues allow deferring time-consuming tasks, such as sending emails, until a later time."}),link:P.settings.queue?e.jsx(R,{link:P.settings.queue}):void 0,children:e.jsx(D,{separatorTop:!1,separatorBottom:!1,name:"queue_group",children:i=>e.jsxs(d.Fragment,{children:[e.jsxs(L,{size:"sm",invalid:i,onSelectionChange:()=>{t()},selectionMode:"single",name:"server.queue_connection",required:!0,children:[e.jsx(j,{value:"sync",children:e.jsx(n,{message:"None (Default)"})}),e.jsx(j,{value:"beanstalkd",children:"Beanstalkd"}),e.jsx(j,{value:"database",children:e.jsx(n,{message:"Database"})}),e.jsx(j,{value:"sqs",children:e.jsx(n,{message:"SQS (Amazon simple queue service)"})}),e.jsx(j,{value:"redis",children:"Redis"})]}),a&&e.jsx("div",{className:"mt-20",children:e.jsx(a,{isInvalid:i})})]})})})}function Ze(){const{base_url:s}=$(),{data:t,status:r}=Je(),a=r!=="pending"&&(t==null?void 0:t.status)==="running";return e.jsx(q,{title:e.jsx(n,{message:"Queue Status"}),description:e.jsx(n,{message:"Monitor the current status of your queue and access the queue dashboard."}),children:e.jsx("div",{className:"flex items-center gap-14",children:a?e.jsxs(d.Fragment,{children:[e.jsxs("div",{className:"min-w-108 flex w-max items-center gap-8 rounded-button bg-positive-lighter px-10 py-4 text-sm capitalize",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-positive"}),e.jsx(n,{message:"Worker is running"})]}),e.jsx(_,{variant:"outline",size:"xs",elementType:"a",href:`${s}/horizon`,target:"_blank",endIcon:e.jsx(B,{}),children:e.jsx(n,{message:"Monitor"})})]}):e.jsx(es,{})})})}function es(){return e.jsx(se,{leadingIcon:e.jsx(he,{size:"xs",className:"text-danger"}),title:e.jsx(n,{message:"Queue worker is inactive"}),description:e.jsx(n,{message:"The queue worker is not running. Please start the worker or set queue driver to 'none', otherwise some features will not work properly."}),color:"danger"})}function ss({isInvalid:s}){return e.jsxs(d.Fragment,{children:[e.jsx(h,{size:"sm",invalid:s,className:"mb-20",name:"server.aws_access_key_id",label:e.jsx(n,{message:"SQS queue key"}),required:!0}),e.jsx(h,{size:"sm",invalid:s,className:"mb-20",name:"server.aws_secret_access_key",label:e.jsx(n,{message:"SQS queue secret"}),required:!0}),e.jsx(h,{size:"sm",invalid:s,className:"mb-20",name:"server.sqs_prefix",label:e.jsx(n,{message:"SQS queue prefix"}),required:!0}),e.jsx(h,{size:"sm",invalid:s,className:"mb-20",name:"server.sqs_queue",label:e.jsx(n,{message:"SQS queue name"}),required:!0}),e.jsx(h,{size:"sm",invalid:s,name:"server.aws_default_region",label:e.jsx(n,{message:"SQS queue region"}),required:!0})]})}function ts(s){return e.jsx(ae,{children:e.jsx(rs,{...s})})}function rs({tabs:s,title:t,rightContent:r}){const{updateStarted:a}=d.use(A),i=a?e.jsx(ns,{}):e.jsx(as,{});return e.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel flex h-full flex-col",children:[e.jsx(te,{title:t,showSidebarToggleButton:!0,border:"border-none",rightContent:r}),s,e.jsx("div",{className:"overflow-y-auto",children:e.jsx("div",{className:"mx-auto p-12 @container/settings-form md:p-24 lg:max-w-[1440px]",children:i})})]})}function ie({children:s}){const{data:t}=y(),r=!(t!=null&&t.update_available);return e.jsxs("div",{className:"rounded-panel border p-24 shadow-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{size:"lg"}),e.jsx("h1",{className:"mb-4 mt-12 text-xl font-semibold",children:r?e.jsx(n,{message:"You already have the latest version installed"}):e.jsx(n,{message:"System update"})}),e.jsx("p",{className:"text-muted",children:e.jsx(n,{message:"Update your system to the latest version. This will download and install updates automatically, please do not close this page while update is in progress."})})]}),e.jsx("div",{className:"mt-24",children:s})]})}function as(){var a;const{updateAppAndModules:s}=d.use(A),{data:t}=y(),r=!(t!=null&&t.update_available);return e.jsx(ie,{children:e.jsx("div",{className:"w-full text-center",children:e.jsx(_,{variant:"flat",color:"primary",onClick:async()=>{await s()&&setTimeout(()=>{window.location.href="/admin/settings"},1e3)},children:r?e.jsx(n,{message:"Re-install version :version",values:{version:(a=t==null?void 0:t.server)==null?void 0:a.app_version}}):e.jsx(n,{message:"Start Update"})})})})}function ns(){var o;const{events:s,updateInProgress:t,updateAppAndModules:r,moduleNames:a,activeModuleName:i}=d.use(A),c=s.at(-1);return e.jsxs("div",{children:[e.jsx(ee,{shouldBlock:t}),e.jsx(ie,{children:e.jsxs("div",{className:"border-t border-t-divider-lighter pt-24",children:[a!=null&&a.length&&i?e.jsxs("div",{className:"mb-20 font-semibold",children:[e.jsx(n,{message:"Updating"}),":"," ",e.jsx(is,{name:i})]}):null,e.jsx("div",{className:"space-y-18",children:s.map((u,p)=>e.jsx(re,{event:u},p))}),(o=c==null?void 0:c.context)!=null&&o.error?e.jsxs("div",{className:"mt-24 flex items-center gap-12",children:[e.jsx(_,{variant:"flat",color:"primary",onClick:()=>r(),children:e.jsx(n,{message:"Retry"})}),e.jsx(_,{variant:"outline",color:"primary",href:P.manualUpdate,target:"_blank",endIcon:e.jsx(B,{}),children:e.jsx(n,{message:"Update manually"})})]}):null,(c==null?void 0:c.step)===f.Finalizing&&(c==null?void 0:c.status)===w.Completed?e.jsxs("div",{className:"mt-24",children:[e.jsx("div",{className:"mb-12 text-muted",children:e.jsx(n,{message:"Update completed successfully! Reloading the page..."})}),e.jsx(_,{variant:"flat",color:"primary",elementType:ge,to:"/admin",children:e.jsx(n,{message:"Return to admin area"})})]}):null]})})]})}function is({name:s}){var r,a;const{data:t}=y();return s==="app"?e.jsx(n,{message:"Application"}):e.jsx("span",{children:((a=(r=t.modules)==null?void 0:r[s])==null?void 0:a.label)??ye(s)})}function os({tabs:s,title:t}){const{data:r}=y(),a=z({defaultValues:{server:{broadcast_connection:r.server.broadcast_connection??"null",pusher_app_id:r.server.pusher_app_id??"",pusher_app_key:r.server.pusher_app_key??"",pusher_app_secret:r.server.pusher_app_secret??"",pusher_app_cluster:r.server.pusher_app_cluster??"",reverb_app_id:r.server.reverb_app_id??"",reverb_app_key:r.server.reverb_app_key??"",reverb_app_secret:r.server.reverb_app_secret??"",reverb_host:r.server.reverb_host??"",reverb_port:r.server.reverb_port??"",reverb_scheme:r.server.reverb_scheme??"https",ably_key:r.server.ably_key??""}}});return e.jsx(U,{form:a,title:t,tabs:s,children:e.jsx(cs,{})})}function cs(){const{clearErrors:s,control:t}=M(),r=je({control:t,name:"server.broadcast_connection"});let a=null;return r==="pusher"?a=ls:r==="ably"?a=ds:r==="reverb"&&(a=us),e.jsx(q,{className:"mb-24",title:e.jsx(n,{message:"Websockets Provider"}),description:e.jsx(n,{message:"Configure websockets provider responsible for all realtime functionality on the site."}),link:P.settings.websockets?e.jsx(R,{link:P.settings.websockets,children:e.jsx(n,{message:"What are websockets?"})}):null,children:e.jsx(D,{separatorTop:!1,separatorBottom:!1,name:"websockets_group",children:i=>e.jsxs(d.Fragment,{children:[e.jsxs(L,{size:"sm",invalid:i,onSelectionChange:()=>s(),selectionMode:"single",name:"server.broadcast_connection",required:!0,children:[e.jsx(j,{value:"null",children:e.jsx(n,{message:"None (Disabled)"})}),e.jsx(j,{value:"reverb",children:"Local (Laravel Reverb)"}),e.jsx(j,{value:"pusher",children:"Pusher"}),e.jsx(j,{value:"ably",children:e.jsx(n,{message:"Ably"})})]}),a&&e.jsx("div",{className:"mt-30",children:e.jsx(a,{isInvalid:i})})]})})})}function ls({isInvalid:s}){return e.jsxs(d.Fragment,{children:[e.jsx(h,{size:"sm",name:"server.pusher_app_id",label:e.jsx(n,{message:"Pusher app ID"}),className:"mb-20",required:!0}),e.jsx(h,{size:"sm",name:"server.pusher_app_key",label:e.jsx(n,{message:"Pusher app key"}),className:"mb-20",required:!0}),e.jsx(h,{size:"sm",name:"server.pusher_app_secret",label:e.jsx(n,{message:"Pusher app secret"}),className:"mb-20",required:!0}),e.jsx(h,{size:"sm",name:"server.pusher_app_cluster",label:e.jsx(n,{message:"Pusher app cluster"}),className:"mb-20",placeholder:"mt1",required:!0})]})}function ds({isInvalid:s}){return e.jsx(d.Fragment,{children:e.jsx(h,{size:"sm",name:"server.ably_key",label:e.jsx(n,{message:"Ably API key"}),className:"mb-20",required:!0})})}function us({isInvalid:s}){return e.jsxs(d.Fragment,{children:[e.jsx(h,{size:"sm",name:"server.reverb_host",label:e.jsx(n,{message:"Reverb host"}),className:"mb-20",required:!0}),e.jsx(h,{size:"sm",name:"server.reverb_port",label:e.jsx(n,{message:"Reverb port"}),className:"mb-20",required:!0}),e.jsxs(L,{size:"sm",name:"server.reverb_scheme",label:e.jsx(n,{message:"Reverb scheme"}),className:"mb-20",required:!0,children:[e.jsx(j,{value:"http",children:"HTTP"}),e.jsx(j,{value:"https",children:"HTTPS"})]})]})}const ms=[{name:"license",label:b("License")},{name:"updates",label:b("Updates")},{name:"cache",label:b("Cache")},{name:"queue",label:b("Queue")},{name:"logging",label:b("Logging")},{name:"websockets",label:b("Websockets")}];function Js(){const{websockets:s}=$(),[t,r]=fe(),a=d.useMemo(()=>ms.filter(o=>o.name!=="websockets"||(s==null?void 0:s.integrated)),[s]),i=t.get("tab")??"license",c=a.findIndex(o=>o.name===i)??0;return e.jsx(d.Fragment,{children:e.jsx(ps,{tabName:i,tabs:e.jsx(Se,{selectedTab:c,onTabChange:o=>{const u=a[o];r({tab:u.name},{replace:!0})},children:e.jsx(we,{className:"mx-24",children:a.map(o=>e.jsx(ke,{children:e.jsx(n,{...o.label})},o.name))})})})})}function ps({tabName:s,tabs:t}){const{data:r}=y(),a=e.jsx(n,{message:"System"}),i=e.jsx(V,{size:"sm",fontWeight:"font-semibold",children:r.server.app_version});switch(s){case"cache":return e.jsx(Ne,{tabs:t,title:a});case"queue":return e.jsx(Xe,{tabs:t,title:a});case"logging":return e.jsx(He,{tabs:t,title:a});case"websockets":return e.jsx(os,{tabs:t,title:a});case"license":return e.jsx(Oe,{tabs:t,title:a,rightContent:i});case"updates":return e.jsx(ts,{tabs:t,title:a,rightContent:i})}}export{Js as Component};
