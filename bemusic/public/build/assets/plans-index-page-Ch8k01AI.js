import{J as r,z as x,G as h,H as b,I as j,aa as y,bx as p,b as f,ae as C,j as e,T as s,ab as T,r as D,a8 as P,W as d,v,D as w}from"./main-CUJEGI8U.js";import{a as c}from"./admin-config-DTFkVWJm.js";import{D as k}from"./settings-links-6v3CjZ6H.js";import{d as m,F as A,u as I,a as E,G as H,D as N,b as W,c as q}from"./use-datatable-query-D9uebfzx.js";import{D as B}from"./datatable-filters-DFYg3QEK.js";import{a as z,D as L,b as Q,c as K}from"./datatable-page-with-header-layout-C4e5sJMc.js";import{T as M}from"./table-CgoYghfp.js";import{F as u}from"./formatted-date-DzIPJwiH.js";import{D as _}from"./Delete-BwrOLlzK.js";import{E as G}from"./Edit-BRVJ8AkN.js";import{S as $}from"./Sync-BMaQFguO.js";import{C as O}from"./confirmation-dialog-DVMbD2S1.js";import{F as V}from"./formatted-price-o7rYOnCC.js";import{N as J}from"./name-with-avatar-CpbvmPVO.js";import{D as R}from"./data-table-add-item-button-_qDHIKil.js";import{s as U}from"./software-engineer-BiXKysY-.js";import{c as X,u as Y}from"./timestamp-filters-DydeeDDl.js";import"./Album-pwm22nnR.js";import"./Comment-vFUyF-gf.js";import"./FileUpload-CTBOdaGq.js";import"./Mic-DAPkQZuC.js";import"./PlaylistPlay-DcgxbGJx.js";import"./QueueMusic-CiX-EN5z.js";import"./Sell-D56iqjs7.js";import"./external-link-jlnQ3iTs.js";import"./FilterAlt-Cw-mRuQp.js";import"./form-normalized-model-chip-field-R33Z1aXc.js";import"./use-normalized-models-ClA2DWxP.js";import"./form-chip-field-ehb7ckkp.js";import"./input-DAWJLQiY.js";import"./chip-list-D0uDB84E.js";import"./accordion-BALGWyw-.js";import"./checkbox-suk8vW77.js";import"./CheckBoxOutlineBlank-BgWeDdny.js";import"./ArrowRightAlt-iO8zeT1U.js";import"./DateRange-Bhvye4F9.js";import"./use-base-date-picker-state-DaWG2IMs.js";import"./use-date-formatter-m8TmZzOM.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-CjTKdvdU.js";import"./use-date-range-picker-state-CSWp3d1-.js";import"./list-C96mDrnJ.js";import"./switch-4KDjemPX.js";import"./dialog-footer-jZcc-BBM.js";import"./is-tablet-media-query-DhMPnSWn.js";import"./use-current-date-time-BhbL04rR.js";import"./select-Z9R0wV6S.js";import"./combobox-end-adornment-B0xReOuL.js";import"./normalized-model-field-8T9JWy8W.js";import"./skeleton-BmWW5Jc-.js";import"./dashboard-layout-context-DeTNv3yG.js";import"./ArrowDownward-BHYKFIfy.js";import"./useInteractOutside-BFJZ3Z5N.js";import"./useEffectEvent-pADbdn7r.js";import"./is-ctrl-or-shift-pressed-Bx-mqgCW.js";import"./use-pointer-events-DcvSqvAc.js";import"./useGlobalListeners-BeXr-yG1.js";import"./Add-B3RL66ee.js";import"./formatted-number-gsF1qEbc.js";const g=[{key:"subscriptions",label:r("Subscriptions"),description:r("Whether plan has any active subscriptions"),defaultOperator:m.eq,control:{type:A.Select,defaultValue:"01",options:[{key:"01",label:r("Has active subscriptions"),value:{value:"*",operator:m.has}},{key:"02",label:r("Does not have active subscriptions"),value:{value:"*",operator:m.doesntHave}}]}},X({description:r("Date plan was created")}),Y({description:r("Date plan was last updated")})],Z=t=>`billing/products/${t}`;function ee(){const{trans:t}=x();return h({mutationFn:a=>te(a),onSuccess:()=>{j(t(r("Plan deleted"))),y.invalidateQueries({queryKey:p.products.invalidateKey})},onError:a=>b(a)})}function te({productId:t}){return f.delete(Z(t)).then(a=>a.data)}function ae(){const{trans:t}=x();return h({mutationFn:()=>se(),onSuccess:()=>{j(t(r("Plans synced"))),y.invalidateQueries({queryKey:p.products.invalidateKey})},onError:a=>b(a,r("Could not sync plans"))})}function se(){return f.post("billing/products/sync").then(t=>t.data)}const re=[{key:"name",allowsSorting:!0,visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:t=>{const a=t.prices[0];return e.jsx(J,{label:t.name,description:t.free?e.jsx(s,{message:"Free"}):e.jsx(V,{price:a})})}},{key:"created_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Created"}),body:t=>e.jsx(u,{date:t.created_at})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Last updated"}),body:t=>e.jsx(u,{date:t.updated_at})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),visibleInMode:"all",hideHeader:!0,align:"end",maxWidth:"max-w-84",body:t=>e.jsxs(D.Fragment,{children:[e.jsx(d,{size:"md",className:"text-muted",elementType:v,to:`/admin/plans/${t.id}/edit`,children:e.jsx(G,{})}),e.jsx(oe,{product:t})]})}];function ct(){const t=C(),{searchParams:a,sortDescriptor:n,mergeIntoSearchParams:l,setSearchQuery:S,isFiltering:F}=I(T),i=E(p.products.index(a));return e.jsxs(z,{children:[e.jsx(H,{query:i}),e.jsx(L,{title:e.jsx(s,{message:"Subscription plans"}),showSidebarToggleButton:!0,rightContent:c.pages.subscriptions?e.jsx(k,{variant:"button",link:c.pages.subscriptions,size:"xs"}):null}),e.jsxs(Q,{children:[e.jsx(N,{searchValue:a.query,onSearchChange:S,actions:e.jsx(ie,{}),filters:g}),e.jsx(B,{filters:g}),e.jsxs(K,{children:[e.jsx(M,{columns:re,data:i.items,sortDescriptor:n,onSortChange:l,enableSelection:!1,cellHeight:"h-64",onAction:o=>{t(`/admin/plans/${o.id}/edit`)}}),i.isEmpty&&e.jsx(W,{className:"mt-50",isFiltering:F,image:U,title:e.jsx(s,{message:"No plans have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching plans"})}),e.jsx(q,{query:i,onPageChange:o=>l({page:o}),onPerPageChange:o=>l({perPage:o})})]})]})]})}function oe({product:t}){const a=ee();return e.jsxs(w,{type:"modal",onClose:n=>{n&&a.mutate({productId:t.id})},children:[e.jsx(P,{label:e.jsx(s,{message:"Delete plan"}),children:e.jsx(d,{size:"md",className:"text-muted",disabled:a.isPending,children:e.jsx(_,{})})}),e.jsx(O,{title:e.jsx(s,{message:"Delete plan"}),body:e.jsx(s,{message:"Are you sure you want to delete this plan?"}),confirm:e.jsx(s,{message:"Delete"})})]})}function ie(){const t=ae();return e.jsxs(D.Fragment,{children:[e.jsx(P,{label:e.jsx(s,{message:"Sync plans with Stripe & PayPal"}),children:e.jsx(d,{color:"primary",variant:"outline",size:"sm",disabled:t.isPending,onClick:()=>{t.mutate()},children:e.jsx($,{})})}),e.jsx(R,{elementType:v,to:"/admin/plans/new",children:e.jsx(s,{message:"Add new plan"})})]})}export{ct as Component};
