import{J as d,j as s,T as j,r as i,u as fe,aT as me,aE as he,aU as be,aV as xe,aW as Z,aX as L,aY as N,aZ as U,a_ as Y,aF as ge,$ as ye,t as q,a0 as De,a2 as ke,A as $e,o as je,aP as Re,a$ as T,b0 as w,b1 as p,b2 as J,b3 as Ve}from"./main-CUJEGI8U.js";import{L as ee,a as te}from"./list-C96mDrnJ.js";import{S as pe}from"./switch-4KDjemPX.js";import{D as Ce}from"./formatted-date-DzIPJwiH.js";import{u as ve}from"./use-date-formatter-m8TmZzOM.js";import{A as Pe}from"./ArrowRightAlt-iO8zeT1U.js";import{D as Se}from"./dialog-footer-jZcc-BBM.js";import{u as Te}from"./is-tablet-media-query-DhMPnSWn.js";import{C as we,D as Ie,a as Q,u as ze,t as C}from"./use-base-date-picker-state-DaWG2IMs.js";import{g as Fe,u as Le}from"./use-current-date-time-BhbL04rR.js";const Ne=[{key:0,label:d("Preceding period"),getRangeValue:e=>{const t=e.start,c=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:c}),end:t}}},{key:1,label:d("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:d("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function Ae({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(ee,{children:Ne.map(n=>s.jsx(te,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const c=n.getRangeValue(e);t(c)},children:s.jsx(j,{...n.label})},n.key))})}const Ee=i.memo(({start:e,end:t,options:a,preset:n,timezone:c})=>{const{dates:u}=fe(),D=me(),b=c||(a==null?void 0:a.timeZone)||D,o=ve(a||Ce[n||(u==null?void 0:u.format)||"short"]);if(!e||!t)return null;let k;try{k=o.formatRange(W(e,b),W(t,b))}catch{k=""}return s.jsx(i.Fragment,{children:k})},he);function W(e,t){return typeof e=="string"?be(e,t).toDate():"toDate"in e?e.toDate(t):e}function g(e){return e.set({hour:23,minute:59,second:59,millisecond:999})}function ae(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}const l=ae(Fe());var G,K;const I=((K=(G=ge())==null?void 0:G.i18n)==null?void 0:K.active)||"en",Me=[{key:0,label:d("Today"),getRangeValue:()=>({preset:0,start:l,end:g(l)})},{key:1,label:d("Yesterday"),getRangeValue:()=>({preset:1,start:l.subtract({days:1}),end:g(l).subtract({days:1})})},{key:2,label:d("This week"),getRangeValue:()=>({preset:2,start:Z(l,I),end:xe(g(l),I)})},{key:3,label:d("Last week"),getRangeValue:()=>{const e=Z(l,I).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:d("Last 7 days"),getRangeValue:()=>({preset:4,start:l.subtract({days:7}),end:g(l)})},{key:5,label:d("Last 30 days"),getRangeValue:()=>({preset:5,start:l.subtract({days:30}),end:g(l)})},{key:6,label:d("Last 3 months"),getRangeValue:()=>({preset:6,start:l.subtract({months:3}),end:g(l)})},{key:7,label:d("Last 12 months"),getRangeValue:()=>({preset:7,start:l.subtract({months:12}),end:g(l)})},{key:8,label:d("This month"),getRangeValue:()=>({preset:8,start:N(l),end:L(g(l))})},{key:9,label:d("This year"),getRangeValue:()=>({preset:9,start:Y(l),end:U(g(l))})},{key:10,label:d("Last year"),getRangeValue:()=>({preset:10,start:Y(l).subtract({years:1}),end:U(g(l)).subtract({years:1})})}];function Oe({onPresetSelected:e,selectedValue:t}){return s.jsx(ee,{children:Me.map(a=>s.jsx(te,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(j,{...a.label})},a.key))})}function Ge({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const c=Te(),{close:u}=ye(),D=i.useRef(e),b=e.isPlaceholder.start||e.isPlaceholder.end,[o,k]=i.useState(n),x=s.jsxs(Se,{dividerTop:!0,startAction:!b&&!c?s.jsx("div",{className:"text-xs",children:s.jsx(Ee,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(q,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(D.current.selectedValue),e.setIsPlaceholder(D.current.isPlaceholder),u()},children:s.jsx(j,{message:"Cancel"})}),s.jsx(q,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const h=e.selectedValue;t&&o&&(h.compareStart=t.selectedValue.start,h.compareEnd=t.selectedValue.end),u(h)},children:s.jsx(j,{message:"Select"})})]});return s.jsxs(De,{size:"auto",children:[s.jsxs(ke,{className:"flex",padding:"p-0",children:[!c&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(Oe,{selectedValue:e.selectedValue,onPresetSelected:h=>{e.setSelectedValue(h),e.closeDialogOnSelection&&u(h)}}),!!t&&s.jsxs(i.Fragment,{children:[s.jsx(pe,{className:"mx-20 mb-10 mt-14",checked:o,onChange:h=>k(h.target.checked),children:s.jsx(j,{message:"Compare"})}),o&&s.jsx(Ae,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:h=>{t.setSelectedValue(h)}})]})]}),s.jsx($e,{initial:!1,children:s.jsx(Be,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:o})})]}),!e.closeDialogOnSelection&&x]})}function Be({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(je.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(X,{state:e}),!!t&&n&&s.jsx(X,{state:t,label:s.jsx(j,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(we,{state:e,visibleMonths:2})})]})}function X({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(Ie,{className:"mb-20 mt-10",label:t,children:[s.jsx(Q,{state:e,value:a.start,onChange:c=>{n({...a,start:c})}}),s.jsx(Pe,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(Q,{state:e,value:a.end,onChange:c=>{n({...a,end:c})}})]})}function Ke(e){var B,H;const t=Le(),[a,n]=i.useState({start:(!e.value||!e.value.start)&&!((B=e.defaultValue)!=null&&B.start),end:(!e.value||!e.value.end)&&!((H=e.defaultValue)!=null&&H.end)}),c=e.onChange,[u,D]=Re(e.value?F(e.value,t):void 0,e.value?void 0:F(e.defaultValue,t),r=>{n({start:!1,end:!1}),c==null||c(r)}),{min:b,max:o,granularity:k,timezone:x,calendarIsOpen:h,setCalendarIsOpen:$,closeDialogOnSelection:v}=ze(u.start,e),se=i.useCallback(()=>{n({start:!0,end:!0}),D(F(null,t)),c==null||c(null),$(!1)},[t,D,c,$]),[P,A]=i.useState(null),[R,E]=i.useState(!1),[y,S]=i.useState(u),[ne,M]=i.useState(()=>_(u,o)),O=i.useCallback(r=>{let f=r.start,m=r.end;b&&(f=T(f,b));const de=o?w(o,m):m;f=w(f,de);const ue=b?T(b,f):f;return m=T(m,ue),o&&(m=w(m,o)),{start:C(f,x),end:C(m,x)}},[b,o,x]),V=i.useCallback(r=>{const f={...O(r),preset:r.preset};D(f),S(f),M(_(f,o)),n({start:!1,end:!1})},[D,O,o]),re=i.useCallback(r=>!a.start&&p(r,y.start)||!a.end&&p(r,y.end),[y,a]),le=i.useCallback(r=>(R||!a.start&&!a.end)&&r.compare(y.start)>=0&&r.compare(y.end)<=0,[y,a,R]),ce=i.useCallback(r=>p(r,y.start),[y]),ie=i.useCallback(r=>p(r,y.end),[y]),oe=i.useCallback((r,f)=>({onPointerEnter:()=>{R&&f&&S(z({start:P,end:r,timezone:x}))},onClick:()=>{if(!R)E(!0),A(r),S(z({start:r,end:r,timezone:x}));else{const m=z({start:P,end:r,timezone:x});m.start=ae(m.start),m.end=g(m.end),E(!1),A(null),V==null||V(m),v&&($==null||$(!1))}}}),[P,R,V,$,v,x]);return{selectedValue:u,setSelectedValue:V,calendarIsOpen:h,setCalendarIsOpen:$,dayIsActive:re,dayIsHighlighted:le,dayIsRangeStart:ce,dayIsRangeEnd:ie,getCellProps:oe,calendarDates:ne,setIsPlaceholder:n,isPlaceholder:a,clear:se,setCalendarDates:M,min:b,max:o,granularity:k,timezone:x,closeDialogOnSelection:v}}function _(e,t){let a=J(N(e.start)),n=J(L(e.end));return Ve(a,n)&&(n=L(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=N(a.subtract({months:1}))),[a,n]}function z(e){const t=C(e.start,e.timezone),a=C(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function F(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}export{Me as D,Ee as F,Ne as a,Ge as b,Ke as u};
